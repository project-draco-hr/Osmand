{
  refreshProgressDistance(ctx);
  RouteRegion[] regions=ctx.reverseMap.keySet().toArray(new BinaryMapRouteReaderAdapter.RouteRegion[ctx.reverseMap.size()]);
  RouteSegmentResult[] res=ctx.nativeLib.runNativeRouting(ctx.startX,ctx.startY,ctx.targetX,ctx.targetY,ctx.config,regions,ctx.calculationProgress,ctx.precalculatedRouteDirection,ctx.calculationMode == RouteCalculationMode.BASE);
  ArrayList<RouteSegmentResult> result=new ArrayList<RouteSegmentResult>(Arrays.asList(res));
  ctx.routingTime=ctx.calculationProgress.routingCalculatedTime;
  ctx.visitedSegments=ctx.calculationProgress.visitedSegments;
  ctx.loadedTiles=ctx.calculationProgress.loadedTiles;
  return new RouteResultPreparation().prepareResult(ctx,result);
}
