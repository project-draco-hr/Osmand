{
  Point popupMenuPoint=map.getPopupMenuPoint();
  double fy=(popupMenuPoint.y - map.getCenterPointY()) / map.getTileSize();
  double fx=(popupMenuPoint.x - map.getCenterPointX()) / map.getTileSize();
  final double latitude=MapUtils.getLatitudeFromTile(map.getZoom(),map.getYTile() + fy);
  final double longitude=MapUtils.getLongitudeFromTile(map.getZoom(),map.getXTile() + fx);
  final ClusteringContext clusterCtx=new ClusteringContext();
  new Thread(new Runnable(){
    @Override public void run(){
      try {
        final DataTileManager<Way> points=new DataTileManager<Way>(11);
        List<RouteSegment> ways=clustering(clusterCtx,latitude,longitude,points);
        for (        RouteSegment s : ways) {
          Way w=new Way(-1);
          for (int i=0; i < s.getRoad().getPointsLength(); i++) {
            double lat=MapUtils.get31LatitudeY(s.getRoad().getPoint31YTile(i));
            double lon=MapUtils.get31LongitudeX(s.getRoad().getPoint31XTile(i));
            w.addNode(new Node(lat,lon,-1));
          }
          LatLon n=w.getLatLon();
          points.registerObject(n.getLatitude(),n.getLongitude(),w);
        }
        map.setPoints(points);
        map.repaint();
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
  }
).start();
}
