{
  View row=convertView;
  if (row == null) {
    LayoutInflater inflater=getLayoutInflater();
    row=inflater.inflate(R.layout.search_history_list_item,parent,false);
  }
  TextView label=(TextView)row.findViewById(R.id.label);
  TextView distanceLabel=(TextView)row.findViewById(R.id.distance_label);
  ImageButton icon=(ImageButton)row.findViewById(R.id.remove);
  final HistoryEntry model=getItem(position);
  if (location != null) {
    int dist=(int)(MapUtils.getDistance(location,model.lat,model.lon));
    distanceLabel.setText(OsmAndFormatter.getFormattedDistance(dist,SearchHistoryActivity.this));
  }
 else {
    distanceLabel.setText("");
  }
  label.setText(model.name);
  icon.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      helper.remove(model,SearchHistoryActivity.this);
      setListAdapter(new HistoryAdapter(helper.getHistoryEntries(SearchHistoryActivity.this)));
    }
  }
);
  View.OnClickListener clickListener=new View.OnClickListener(){
    @Override public void onClick(    View v){
      selectModel(model);
    }
  }
;
  View.OnLongClickListener longClickListener=new View.OnLongClickListener(){
    @Override public boolean onLongClick(    View v){
      return onItemLongClick(position);
    }
  }
;
  distanceLabel.setOnLongClickListener(longClickListener);
  label.setOnLongClickListener(longClickListener);
  distanceLabel.setOnClickListener(clickListener);
  label.setOnClickListener(clickListener);
  return row;
}
