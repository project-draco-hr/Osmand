{
  super.onResume();
  Intent intent=getIntent();
  if (intent != null) {
    double lat=intent.getDoubleExtra(SEARCH_LAT,0);
    double lon=intent.getDoubleExtra(SEARCH_LON,0);
    if (lat != 0 || lon != 0) {
      location=new LatLon(lat,lon);
    }
  }
  if (location == null && getParent() instanceof SearchActivity) {
    location=((SearchActivity)getParent()).getSearchPoint();
  }
  if (location == null) {
    location=OsmandApplication.getSettings().getLastKnownMapLocation();
  }
  List<HistoryEntry> historyEntries=helper.getHistoryEntries(this);
  getListView().removeFooterView(clearButton);
  if (!historyEntries.isEmpty()) {
    getListView().addFooterView(clearButton);
  }
  setListAdapter(new HistoryAdapter(historyEntries));
}
