{
  if (!isRouteAnimating()) {
    Builder builder=new AlertDialog.Builder(ma);
    builder.setTitle(R.string.animate_route);
    final View view=ma.getLayoutInflater().inflate(R.layout.animate_route,null);
    final View gpxView=((LinearLayout)view.findViewById(R.id.layout_animate_gpx));
    final RadioButton radioGPX=(RadioButton)view.findViewById(R.id.radio_gpx);
    radioGPX.setOnCheckedChangeListener(new OnCheckedChangeListener(){
      @Override public void onCheckedChanged(      CompoundButton buttonView,      boolean isChecked){
        gpxView.setVisibility(isChecked ? View.VISIBLE : View.GONE);
      }
    }
);
    ((TextView)view.findViewById(R.id.MinSpeedup)).setText("1");
    ((TextView)view.findViewById(R.id.MaxSpeedup)).setText("4");
    final SeekBar speedup=(SeekBar)view.findViewById(R.id.Speedup);
    final CheckBox ch=(CheckBox)view.findViewById(R.id.AnnounceGPXWpt);
    speedup.setMax(3);
    builder.setView(view);
    builder.setPositiveButton(R.string.default_buttons_yes,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        boolean gpxNavigation=radioGPX.isChecked();
        if (gpxNavigation) {
          GpxUiHelper.selectGPXFile(ma,false,false,new CallbackWithObject<GPXUtilities.GPXFile>(){
            @Override public boolean processResult(            GPXUtilities.GPXFile result){
              GPXRouteParamsBuilder builder=new GPXRouteParamsBuilder(result,app.getSettings());
              if (ch.isChecked()) {
                builder.setAnnounceWaypoints(true);
              }
              startAnimationThread(app.getRoutingHelper(),ma,builder.getPoints(),true,speedup.getProgress() + 1);
              return true;
            }
          }
);
        }
 else {
          List<Location> currentRoute=app.getRoutingHelper().getCurrentCalculatedRoute();
          if (currentRoute.isEmpty()) {
            AccessibleToast.makeText(app,R.string.animate_routing_route_not_calculated,Toast.LENGTH_LONG).show();
          }
 else {
            startAnimationThread(app.getRoutingHelper(),ma,new ArrayList<Location>(currentRoute),false,1);
          }
        }
      }
    }
);
    builder.setNegativeButton(R.string.default_buttons_no,null);
    builder.show();
  }
 else {
    stop();
  }
}
