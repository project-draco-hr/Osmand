{
  broadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      if (settings.SAVE_GLOBAL_TRACK_TO_GPX.get()) {
        settings.SAVE_GLOBAL_TRACK_TO_GPX.set(false);
      }
      OsMoPlugin plugin=OsmandPlugin.getEnabledPlugin(OsMoPlugin.class);
      if (plugin != null) {
        if (plugin.getTracker().isEnabledTracker()) {
          plugin.getTracker().disableTracker();
        }
      }
      NavigationService.this.stopSelf();
    }
  }
;
  registerReceiver(broadcastReceiver,new IntentFilter(OSMAND_STOP_SERVICE_ACTION));
  saveBroadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      final OsmandMonitoringPlugin plugin=OsmandPlugin.getEnabledPlugin(OsmandMonitoringPlugin.class);
      plugin.saveCurrentTrack();
    }
  }
;
  registerReceiver(saveBroadcastReceiver,new IntentFilter(OSMAND_SAVE_SERVICE_ACTION));
  int soi=settings.SERVICE_OFF_INTERVAL.get();
  String nt=getString(R.string.service_stop_background_service) + ". " + getString(R.string.gps_wake_up_timer)+ ": ";
  if (soi == 0) {
    nt=nt + getString(R.string.int_continuosly);
  }
 else   if (soi <= 90000) {
    nt=nt + Integer.toString(soi / 1000) + " "+ getString(R.string.int_seconds);
  }
 else {
    nt=nt + Integer.toString(soi / 1000 / 60) + " "+ getString(R.string.int_min);
  }
  String stop=getResources().getString(R.string.shared_string_control_stop);
  Intent stopIntent=new Intent(OSMAND_STOP_SERVICE_ACTION);
  PendingIntent stopPendingIntent=PendingIntent.getBroadcast(this,0,stopIntent,PendingIntent.FLAG_UPDATE_CURRENT);
  String pause=getResources().getString(R.string.shared_string_save);
  Intent saveIntent=new Intent(OSMAND_SAVE_SERVICE_ACTION);
  PendingIntent savePendingIntent=PendingIntent.getBroadcast(this,0,saveIntent,PendingIntent.FLAG_UPDATE_CURRENT);
  Intent contentIntent=new Intent(this,MapActivity.class);
  PendingIntent contentPendingIntent=PendingIntent.getActivity(this,0,contentIntent,PendingIntent.FLAG_UPDATE_CURRENT);
  final Builder notificationBuilder=new NotificationCompat.Builder(this).setContentTitle(Version.getAppName(cl)).setContentText(getString(R.string.osmand_service)).setSmallIcon(R.drawable.bgs_icon).setContentIntent(contentPendingIntent).setOngoing(true).addAction(R.drawable.ic_action_rec_stop,stop,stopPendingIntent).addAction(R.drawable.ic_action_save,pause,savePendingIntent);
  startForeground(NOTIFICATION_SERVICE_ID,notificationBuilder.build());
}
