{
  super.onCreate();
  setForeground(true);
  handler=new Handler();
  settings=OsmandSettings.getOsmandSettings(this);
  serviceOffInterval=settings.SERVICE_OFF_INTERVAL.get();
  serviceOffProvider=settings.SERVICE_OFF_PROVIDER.get();
  serviceError=settings.SERVICE_OFF_WAIT_INTERVAL.get();
  savingTrackHelper=new SavingTrackHelper(this);
  liveMonitoringHelper=new LiveMonitoringHelper(this);
  routingHelper=((OsmandApplication)getApplication()).getRoutingHelper();
  ((OsmandApplication)getApplication()).setNavigationService(this);
  if (isContinuous()) {
    LocationManager locationManager=(LocationManager)getSystemService(LOCATION_SERVICE);
    locationManager.requestLocationUpdates(serviceOffProvider,0,0,NavigationService.this);
  }
 else {
    AlarmManager alarmManager=(AlarmManager)getSystemService(ALARM_SERVICE);
    pendingIntent=PendingIntent.getBroadcast(this,0,new Intent(this,OnNavigationServiceAlarmReceiver.class),PendingIntent.FLAG_UPDATE_CURRENT);
    alarmManager.setRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP,SystemClock.elapsedRealtime() + 500,serviceOffInterval,pendingIntent);
  }
  broadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      NavigationService.this.stopSelf();
    }
  }
;
  registerReceiver(broadcastReceiver,new IntentFilter(OSMAND_STOP_SERVICE_ACTION));
  Intent notificationIntent=new Intent(OSMAND_STOP_SERVICE_ACTION);
  Notification notification=new Notification(R.drawable.icon,"",System.currentTimeMillis());
  notification.flags=Notification.FLAG_NO_CLEAR;
  notification.setLatestEventInfo(this,Version.getAppName(this),getString(R.string.service_stop_background_service),PendingIntent.getBroadcast(this,0,notificationIntent,PendingIntent.FLAG_UPDATE_CURRENT));
  NotificationManager mNotificationManager=(NotificationManager)getSystemService(NOTIFICATION_SERVICE);
  mNotificationManager.notify(NOTIFICATION_SERVICE_ID,notification);
}
