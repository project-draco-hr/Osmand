{
  final List<PoiLegacyFilter> userDefined=new ArrayList<PoiLegacyFilter>();
  OsmandApplication app=(OsmandApplication)getApplication();
  final PoiFiltersHelper poiFilters=app.getPoiFilters();
  final ContextMenuAdapter adapter=new ContextMenuAdapter(activity);
  final List<PoiLegacyFilter> list=new ArrayList<PoiLegacyFilter>();
  for (  PoiLegacyFilter f : poiFilters.getTopDefinedPoiFilters()) {
    if (PoiLegacyFilter.BY_NAME_FILTER_ID.equals(f.getFilterId()) || PoiLegacyFilter.NAME_FINDER_FILTER_ID.equals(f.getFilterId())) {
      continue;
    }
    list.add(f);
    Item it=adapter.item(f.getName());
    if (RenderingIcons.containsBigIcon(f.getSimplifiedId())) {
      it.icon(RenderingIcons.getBigIconResourceId(f.getSimplifiedId()));
    }
 else {
      it.icon(RenderingIcons.getBigIconResourceId("user_defined"));
    }
    it.reg();
    userDefined.add(f);
  }
  Builder builder=new AlertDialog.Builder(activity);
  ListAdapter listAdapter=adapter.createListAdapter(activity,app.getSettings().isLightContent());
  builder.setAdapter(listAdapter,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      PoiLegacyFilter pf=list.get(which);
      String filterId=pf.getFilterId();
      if (filterId.equals(PoiLegacyFilter.CUSTOM_FILTER_ID)) {
        getApplication().getSettings().setPoiFilterForMap(filterId);
        Intent newIntent=new Intent(activity,EditPOIFilterActivity.class);
        newIntent.putExtra(EditPOIFilterActivity.AMENITY_FILTER,filterId);
        newIntent.putExtra(EditPOIFilterActivity.SEARCH_LAT,mapView.getLatitude());
        newIntent.putExtra(EditPOIFilterActivity.SEARCH_LON,mapView.getLongitude());
        activity.startActivity(newIntent);
      }
 else {
        getApplication().getSettings().setPoiFilterForMap(filterId);
        pf=poiFilters.getFilterById(filterId);
        if (pf != null && pf.isStandardFilter()) {
          pf.clearNameFilter();
        }
        poiMapLayer.setFilter(pf);
        mapView.refreshMap();
        if (selected != null && selected.length > 0) {
          selected[0]=pf;
        }
      }
    }
  }
);
  builder.setNegativeButton(R.string.shared_string_cancel,null);
  return builder.show();
}
