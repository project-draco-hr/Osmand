{
  final OsmandSettings settings=getApplication().getSettings();
  final LinkedHashMap<String,String> entriesMap=new LinkedHashMap<String,String>();
  final String layerOsmVector="LAYER_OSM_VECTOR";
  final String layerInstallMore="LAYER_INSTALL_MORE";
  entriesMap.put(layerOsmVector,getString(R.string.vector_data));
  entriesMap.putAll(settings.getTileSourceEntries());
  entriesMap.put(layerInstallMore,getString(R.string.install_more));
  final List<Entry<String,String>> entriesMapList=new ArrayList<Entry<String,String>>(entriesMap.entrySet());
  Builder builder=new AlertDialog.Builder(activity);
  String selectedTileSourceKey=settings.MAP_TILE_SOURCES.get();
  int selectedItem=-1;
  if (settings.MAP_VECTOR_DATA.get()) {
    selectedItem=0;
  }
 else {
    Entry<String,String> selectedEntry=null;
    for (    Entry<String,String> entry : entriesMap.entrySet()) {
      if (entry.getKey().equals(selectedTileSourceKey)) {
        selectedEntry=entry;
        break;
      }
    }
    if (selectedEntry != null) {
      selectedItem=0;
      entriesMapList.remove(selectedEntry);
      entriesMapList.add(0,selectedEntry);
    }
  }
  final String[] items=new String[entriesMapList.size()];
  int i=0;
  for (  Entry<String,String> entry : entriesMapList) {
    items[i++]=entry.getValue();
  }
  builder.setSingleChoiceItems(items,selectedItem,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      String layerKey=entriesMapList.get(which).getKey();
      if (layerKey.equals(layerOsmVector)) {
        MapRenderRepositories r=((OsmandApplication)getApplication()).getResourceManager().getRenderer();
        if (r.isEmpty()) {
          Toast.makeText(activity,getString(R.string.no_vector_map_loaded),Toast.LENGTH_LONG).show();
          return;
        }
 else {
          settings.MAP_VECTOR_DATA.set(true);
        }
        updateMapSource(mapView,null);
      }
 else       if (layerKey.equals(layerInstallMore)) {
        SettingsActivity.installMapLayers(activity,new DialogInterface.OnClickListener(){
          @Override public void onClick(          DialogInterface dialog,          int which){
            openLayerSelectionDialog(mapView);
          }
        }
);
      }
 else {
        settings.MAP_TILE_SOURCES.set(layerKey);
        settings.MAP_VECTOR_DATA.set(false);
        updateMapSource(mapView,settings.MAP_TILE_SOURCES);
      }
      dialog.dismiss();
    }
  }
);
  builder.show();
}
