{
  OsmandApplication app=getApplication();
  final PoiFiltersHelper poiFilters=app.getPoiFilters();
  final ContextMenuAdapter adapter=new ContextMenuAdapter();
  final List<PoiUIFilter> list=new ArrayList<>();
  list.add(poiFilters.getCustomPOIFilter());
  for (  PoiUIFilter f : poiFilters.getTopDefinedPoiFilters()) {
    addFilterToList(adapter,list,f);
  }
  for (  PoiUIFilter f : poiFilters.getSearchPoiFilters()) {
    addFilterToList(adapter,list,f);
  }
  AlertDialog.Builder builder=new AlertDialog.Builder(activity);
  final ArrayAdapter<ContextMenuItem> listAdapter=adapter.createListAdapter(activity,app.getSettings().isLightContent());
  final ListView listView=new ListView(activity);
  listView.setDivider(null);
  listView.setAdapter(listAdapter);
  listView.setOnItemClickListener(new ListView.OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      ContextMenuItem item=listAdapter.getItem(position);
      PoiUIFilter filter=list.get(position);
      boolean isChecked=getApplication().getPoiFilters().isPoiFilterSelected(filter);
      item.getItemClickListener().onContextMenuClick(listAdapter,position,position,!isChecked);
      listAdapter.notifyDataSetChanged();
    }
  }
);
  builder.setView(listView);
  builder.setTitle(R.string.show_poi_over_map).setPositiveButton(R.string.shared_string_ok,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      mapView.refreshMap();
      listener.confirm();
    }
  }
).setNegativeButton(R.string.shared_string_cancel,null).setNeutralButton("",null);
  builder.show();
}
