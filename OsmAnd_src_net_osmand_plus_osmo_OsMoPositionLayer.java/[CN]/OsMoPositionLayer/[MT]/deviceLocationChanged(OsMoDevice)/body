{
  boolean sameDestId=Algorithms.objectEquals(followDestinationId,device.trackerId);
  Location l=device.getLastLocation();
  if (sameDestId && l != null) {
    TargetPointsHelper targets=map.getMyApplication().getTargetPointsHelper();
    final TargetPoint pn=targets.getPointToNavigate();
    LatLon lt=new LatLon(l.getLatitude(),l.getLongitude());
    boolean cancelDestinationId=false;
    if (followTargetLocation != null) {
      if (pn == null || pn.point == null || !pn.point.equals(lt)) {
        cancelDestinationId=true;
      }
    }
    if (cancelDestinationId) {
      followTargetLocation=null;
      followDestinationId=null;
    }
 else {
      RoutingHelper rh=map.getMyApplication().getRoutingHelper();
      double dist=1;
      if (rh.isRouteBeingCalculated()) {
        dist=100;
      }
 else       if (rh.isRouteCalculated()) {
        dist=30;
      }
      if (pn == null || MapUtils.getDistance(pn.point,lt) > dist) {
        followTargetLocation=lt;
        targets.navigateToPoint(lt,true,-1);
      }
    }
  }
  boolean sameId=Algorithms.objectEquals(followTrackerId,device.trackerId);
  if (sameId && !schedule && l != null) {
    ContextMenuLayer cl=map.getMapLayers().getContextMenuLayer();
    final boolean sameObject;
    if (cl.getFirstSelectedObject() instanceof OsMoDevice && cl.isVisible()) {
      sameObject=Algorithms.objectEquals(device.trackerId,((OsMoDevice)cl.getFirstSelectedObject()).trackerId);
    }
 else {
      sameObject=false;
    }
    LatLon mapLoc=new LatLon(map.getMapView().getLatitude(),map.getMapView().getLongitude());
    final boolean centered=Algorithms.objectEquals(followMapLocation,mapLoc);
    if (sameObject || centered) {
      final LatLon loc;
      if (centered) {
        loc=new LatLon(l.getLatitude(),l.getLongitude());
      }
 else       if (!map.getMapView().getAnimatedDraggingThread().isAnimating()) {
        loc=null;
      }
 else {
        loc=followMapLocation;
      }
      followMapLocation=loc;
      schedule=true;
      uiHandler.postDelayed(new Runnable(){
        @Override public void run(){
          schedule=false;
          if (sameObject) {
            ContextMenuLayer cl=map.getMapLayers().getContextMenuLayer();
            Location l=device.getLastLocation();
            cl.setLocation(new LatLon(l.getLatitude(),l.getLongitude()),getObjectDescription(device));
            cl.setSelectedObject(device);
          }
          if (centered) {
            map.getMapView().setLatLon(loc.getLatitude(),loc.getLongitude());
          }
          map.getMapView().refreshMap();
        }
      }
,150);
    }
 else {
      followTrackerId=null;
    }
  }
}
