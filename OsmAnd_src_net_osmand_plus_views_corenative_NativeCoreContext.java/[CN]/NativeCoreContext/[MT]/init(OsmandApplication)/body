{
  if (!init && NativeCore.isAvailable()) {
    if (!NativeCore.isLoaded())     NativeCore.load(CoreResourcesFromAndroidAssetsCustom.loadFromCurrentApplication(app));
    if (NativeCore.isLoaded()) {
      File directory=app.getAppPath("");
      Logger.get().addLogSink(QIODeviceLogSink.createFileLogSink(directory.getAbsolutePath() + "osmandcore.log"));
      WindowManager mgr=(WindowManager)app.getSystemService(Context.WINDOW_SERVICE);
      DisplayMetrics dm=new DisplayMetrics();
      mgr.getDefaultDisplay().getMetrics(dm);
      DisplayMetrics displayMetrics=app.getResources().getDisplayMetrics();
      float scaleCoefficient=displayMetrics.density;
      if (Math.min(dm.widthPixels / (dm.density * 160),dm.heightPixels / (dm.density * 160)) > 2.5f) {
        scaleCoefficient*=1.5f;
      }
      float displayDensityFactor=scaleCoefficient;
      _obfsCollection=new ObfsCollection();
      _obfsCollection.addDirectory(directory.getAbsolutePath(),false);
      _mapStylesCollection=new MapStylesCollection();
      _mapRendererContext=new MapRendererContext();
      _mapRendererContext.setDisplayDensityFactor(displayDensityFactor);
      _mapRendererContext.setupObfMap(_mapStylesCollection.getResolvedStyleByName("default"),_obfsCollection);
      init=true;
    }
  }
}
