{
  final int ld=ViewCompat.getLayoutDirection(this);
  final int absGrav=GravityCompat.getAbsoluteGravity(gravity,ld);
  final int hGrav=absGrav & Gravity.HORIZONTAL_GRAVITY_MASK;
switch (hGrav) {
case Gravity.LEFT:
case Gravity.RIGHT:
case Gravity.CENTER_HORIZONTAL:
    return hGrav;
default :
  return ld == ViewCompat.LAYOUT_DIRECTION_RTL ? Gravity.RIGHT : Gravity.LEFT;
}
}
