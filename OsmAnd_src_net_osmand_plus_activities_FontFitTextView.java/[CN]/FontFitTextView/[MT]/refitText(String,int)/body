{
  if (textWidth > 0) {
    Drawable left=getCompoundDrawables()[0];
    Drawable right=getCompoundDrawables()[2];
    float availableWidth=textWidth - this.getPaddingLeft() - this.getPaddingRight()- this.getCompoundDrawablePadding()- (left != null ? left.getMinimumWidth() : 0)- (right != null ? right.getMinimumWidth() : 0);
    setTextScaleX(1f);
    TextPaint tp=getPaint();
    float size=tp.measureText(text);
    if (size > availableWidth)     setTextScaleX(availableWidth / size);
  }
}
