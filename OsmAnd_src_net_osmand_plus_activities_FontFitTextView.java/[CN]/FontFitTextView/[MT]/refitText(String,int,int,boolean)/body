{
  if (textWidth > 0) {
    float availableWidth=textWidth;
    TextPaint tp=new TextPaint();
    tp.setTextSize(MAX_TEXT_SIZE);
    int lines=text.length() / 25 + 1;
    Rect rect=new Rect();
    tp.getTextBounds(text,0,text.length(),rect);
    while ((rect.width() > (availableWidth + 5) * lines || rect.height() * lines > textHeight) && tp.getTextSize() > 8) {
      tp.setTextSize(tp.getTextSize() - 1);
      tp.getTextBounds(text,0,text.length(),rect);
    }
    if (tv.getLineCount() != lines) {
      if (lines == 1) {
        setGravity(Gravity.CENTER_VERTICAL);
      }
 else {
        setGravity(Gravity.TOP);
      }
      tv.setLines(lines);
      tv.setMaxLines(lines);
    }
    if (tv.getTextSize() != tp.getTextSize()) {
      tv.setTextSize(TypedValue.COMPLEX_UNIT_PX,tp.getTextSize());
      tv.requestLayout();
    }
  }
}
