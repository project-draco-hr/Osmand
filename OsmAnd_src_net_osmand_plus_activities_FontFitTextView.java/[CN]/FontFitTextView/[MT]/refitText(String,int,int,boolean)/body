{
  if (textWidth > 0) {
    float availableWidth=textWidth;
    TextPaint tp=getPaint();
    tp.setTextSize(MAX_TEXT_SIZE);
    int lines=text.length() / 25 + 1;
    Rect rect=new Rect();
    tp.getTextBounds(text,0,text.length(),rect);
    while (rect.width() > (availableWidth + 5) * lines || rect.height() * lines > textHeight) {
      tp.setTextSize(tp.getTextSize() - 1);
      tp.getTextBounds(text,0,text.length(),rect);
    }
    if (getLineCount() != lines) {
      if (lines == 1) {
        setGravity(Gravity.CENTER_VERTICAL);
      }
 else {
        setGravity(Gravity.TOP);
      }
      setLines(lines);
      setMaxLines(lines);
      requestLayout();
    }
    if (getTextSize() != tp.getTextSize()) {
      setTextSize(TypedValue.COMPLEX_UNIT_PX,tp.getTextSize());
    }
  }
}
