{
  File file=checkFile(fileName);
  long now=System.currentTimeMillis();
  try {
    Class.forName("org.sqlite.JDBC");
  }
 catch (  ClassNotFoundException e) {
    log.error("Illegal configuration",e);
    throw new IllegalStateException(e);
  }
  Connection conn=DriverManager.getConnection("jdbc:sqlite:" + file.getAbsolutePath());
  try {
    createPoiIndexStructure(conn);
    PreparedStatement prep=createStatementAmenityInsert(conn);
    Map<PreparedStatement,Integer> map=new LinkedHashMap<PreparedStatement,Integer>();
    map.put(prep,0);
    conn.setAutoCommit(false);
    for (    Amenity a : region.getAmenityManager().getAllObjects()) {
      insertAmenityIntoPoi(prep,map,a,BATCH_SIZE);
    }
    if (map.get(prep) > 0) {
      prep.executeBatch();
    }
    prep.close();
    conn.setAutoCommit(true);
  }
  finally {
    conn.close();
    log.info(String.format("Indexing poi done in %s ms.",System.currentTimeMillis() - now));
  }
  if (date != null) {
    file.setLastModified(date);
  }
  return this;
}
