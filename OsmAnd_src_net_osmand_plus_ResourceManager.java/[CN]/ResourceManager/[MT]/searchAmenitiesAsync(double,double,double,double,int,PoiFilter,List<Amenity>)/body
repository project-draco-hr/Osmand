{
  if (filter instanceof NameFinderPoiFilter) {
    List<Amenity> amenities=((NameFinderPoiFilter)filter).getSearchedAmenities();
    for (    Amenity a : amenities) {
      LatLon l=a.getLocation();
      if (l != null && l.getLatitude() <= topLatitude && l.getLatitude() >= bottomLatitude && l.getLongitude() >= leftLongitude && l.getLongitude() <= rightLongitude) {
        toFill.add(a);
      }
    }
  }
 else {
    String filterId=filter == null ? null : filter.getFilterId();
    List<AmenityIndexRepository> repos=new ArrayList<AmenityIndexRepository>();
    for (    AmenityIndexRepository index : amenityRepositories) {
      if (index.checkContains(topLatitude,leftLongitude,bottomLatitude,rightLongitude)) {
        if (!index.checkCachedAmenities(topLatitude,leftLongitude,bottomLatitude,rightLongitude,zoom,filterId,toFill,true)) {
          repos.add(index);
        }
      }
    }
    if (!repos.isEmpty()) {
      AmenityLoadRequest req=asyncLoadingThread.new AmenityLoadRequest(repos,zoom,filter);
      req.setBoundaries(topLatitude,leftLongitude,bottomLatitude,rightLongitude);
      asyncLoadingThread.requestToLoadAmenities(req);
    }
  }
}
