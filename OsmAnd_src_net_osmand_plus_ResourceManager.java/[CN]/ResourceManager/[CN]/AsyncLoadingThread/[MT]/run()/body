{
  while (true) {
    try {
      boolean update=false;
      boolean amenityLoaded=false;
      boolean transportLoaded=false;
      boolean mapLoaded=false;
      int progress=0;
      if (downloader.isSomethingBeingDownloaded()) {
        progress=BusyIndicator.STATUS_GREEN;
      }
synchronized (ResourceManager.this) {
        if (busyIndicator != null) {
          if (context.getRoutingHelper().isRouteBeingCalculated()) {
            progress=BusyIndicator.STATUS_BLUE;
          }
 else           if (!requests.isEmpty()) {
            progress=BusyIndicator.STATUS_BLACK;
            ;
          }
          busyIndicator.updateStatus(progress);
        }
      }
      while (!requests.isEmpty()) {
        Object req=requests.pop();
        if (req instanceof TileLoadDownloadRequest) {
          TileLoadDownloadRequest r=(TileLoadDownloadRequest)req;
          if (cacheOfImages.get(r.tileId) == null) {
            update|=getRequestedImageTile(r) != null;
          }
        }
 else         if (req instanceof AmenityLoadRequest) {
          if (!amenityLoaded) {
            AmenityLoadRequest r=(AmenityLoadRequest)req;
            r.repository.evaluateCachedAmenities(r.topLatitude,r.leftLongitude,r.bottomLatitude,r.rightLongitude,r.zoom,POIMapLayer.LIMIT_POI,r.filter,null);
            amenityLoaded=true;
          }
        }
 else         if (req instanceof TransportLoadRequest) {
          if (!transportLoaded) {
            TransportLoadRequest r=(TransportLoadRequest)req;
            r.repository.evaluateCachedTransportStops(r.topLatitude,r.leftLongitude,r.bottomLatitude,r.rightLongitude,r.zoom,LIMIT_TRANSPORT,null);
            transportLoaded=true;
          }
        }
 else         if (req instanceof MapLoadRequest) {
          if (!mapLoaded) {
            MapLoadRequest r=(MapLoadRequest)req;
            renderer.loadMap(r.tileBox,downloader.getDownloaderCallbacks());
            mapLoaded=true;
          }
        }
      }
      if (update || amenityLoaded || transportLoaded|| mapLoaded) {
        for (        IMapDownloaderCallback c : downloader.getDownloaderCallbacks()) {
          c.tileDownloaded(null);
        }
      }
      boolean routeBeingCalculated=context.getRoutingHelper().isRouteBeingCalculated();
      if (progress != 0 || routeBeingCalculated || downloader.isSomethingBeingDownloaded()) {
synchronized (ResourceManager.this) {
          if (busyIndicator != null) {
            if (routeBeingCalculated) {
              progress=BusyIndicator.STATUS_BLUE;
            }
 else             if (downloader.isSomethingBeingDownloaded()) {
              progress=BusyIndicator.STATUS_GREEN;
            }
 else {
              progress=0;
            }
            busyIndicator.updateStatus(progress);
          }
        }
      }
      sleep(750);
    }
 catch (    InterruptedException e) {
      log.error(e,e);
    }
catch (    RuntimeException e) {
      log.error(e,e);
    }
  }
}
