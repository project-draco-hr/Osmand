{
  if (currentDirection != router.currentDirectionInfo) {
    currentDirection=router.currentDirectionInfo;
    currentStatus=0;
  }
  RouteDirectionInfo next=router.getNextRouteDirectionInfo();
  int dist=router.getDistanceToNextRouteDirection();
  if (next == null && currentDirection > 0) {
    if (currentStatus == 0) {
      CommandBuilder play=getNewCommandPlayerToPlay();
      if (play != null) {
        play.goAhead(router.getLeftDistance()).andArriveAtDestination().play();
      }
      currentStatus=1;
    }
    return;
  }
  if (dist == 0) {
    return;
  }
  RouteDirectionInfo nextNext=router.getNextNextRouteDirectionInfo();
  if (currentStatus == 0) {
    if (dist > PREPARE_DISTANCE) {
      CommandBuilder play=getNewCommandPlayerToPlay();
      if (play != null) {
        play.goAhead(dist).play();
      }
    }
 else     if (dist < TURN_IN_DISTANCE) {
      currentStatus=3;
    }
    currentStatus=1;
  }
  if (currentStatus <= 3 && dist <= TURN_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      boolean isplay=true;
      if (tParam != null) {
        play.turn(tParam);
      }
 else       if (next.turnType.isRoundAbout()) {
        play.roundAbout(next.turnType.getTurnAngle(),next.turnType.getExitOut());
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.makeUT();
      }
 else       if (next.turnType.getValue().equals(TurnType.C)) {
        play.goAhead();
      }
 else {
        isplay=false;
      }
      if (nextNext != null && next.distance <= TURN_IN_DISTANCE) {
        isplay=true;
        String t2Param=getTurnType(nextNext.turnType);
        if (t2Param != null) {
          play.then().turn(t2Param,next.distance);
        }
 else         if (nextNext.turnType.isRoundAbout()) {
          play.then().roundAbout(next.distance,next.turnType.getTurnAngle(),next.turnType.getExitOut());
        }
 else         if (nextNext.turnType.getValue().equals(TurnType.TU)) {
          play.then().makeUT(next.distance);
        }
      }
      if (isplay) {
        play.play();
      }
    }
    currentStatus=4;
  }
 else   if (currentStatus <= 2 && dist <= TURN_IN_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      boolean isPlay=true;
      if (tParam != null) {
        play.turn(tParam,dist);
      }
 else       if (next.turnType.isRoundAbout()) {
        play.roundAbout(dist,next.turnType.getTurnAngle(),next.turnType.getExitOut());
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.makeUT(dist);
      }
 else {
        isPlay=false;
      }
      if (nextNext != null && next.distance <= TURN_DISTANCE) {
        TurnType t=nextNext.turnType;
        isPlay=true;
        if (next.turnType.getValue().equals(TurnType.C)) {
          play.goAhead(dist);
        }
        if (TurnType.TL.equals(t.getValue()) || TurnType.TSHL.equals(t.getValue()) || TurnType.TSLL.equals(t.getValue())|| TurnType.TU.equals(t.getValue())) {
          play.then().bearLeft();
        }
 else         if (TurnType.TR.equals(t.getValue()) || TurnType.TSHR.equals(t.getValue()) || TurnType.TSLR.equals(t.getValue())) {
          play.then().bearRight();
        }
      }
      if (isPlay) {
        play.play();
      }
    }
    currentStatus=3;
  }
 else   if (currentStatus <= 1 && dist <= PREPARE_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      if (tParam != null) {
        play.prepareTurn(tParam,dist).play();
      }
 else       if (next.turnType.isRoundAbout()) {
        play.prepareRoundAbout(dist).play();
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.prepareMakeUT(dist).play();
      }
    }
    currentStatus=2;
  }
}
