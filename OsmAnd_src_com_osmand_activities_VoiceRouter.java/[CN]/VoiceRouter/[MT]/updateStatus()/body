{
  if (currentDirection != router.currentDirectionInfo) {
    currentDirection=router.currentDirectionInfo;
    currentStatus=STATUS_UNKNOWN;
  }
  RouteDirectionInfo next=router.getNextRouteDirectionInfo();
  int dist=router.getDistanceToNextRouteDirection();
  if (next == null || next.distance == 0) {
    if (currentStatus == STATUS_UNKNOWN && currentDirection > 0) {
      CommandBuilder play=getNewCommandPlayerToPlay();
      if (play != null) {
        play.goAhead(router.getLeftDistance()).andArriveAtDestination().play();
      }
      currentStatus=STATUS_TOLD;
    }
    return;
  }
  if (dist == 0) {
    return;
  }
  RouteDirectionInfo nextNext=router.getNextNextRouteDirectionInfo();
  if (currentStatus == STATUS_UNKNOWN) {
    if (dist > PREPARE_DISTANCE) {
      CommandBuilder play=getNewCommandPlayerToPlay();
      if (play != null) {
        play.goAhead(dist).play();
      }
      currentStatus=STATUS_3000_PREPARE;
    }
 else     if (dist < TURN_IN_DISTANCE) {
      currentStatus=STATUS_TOLD;
    }
  }
  if (currentStatus <= STATUS_TURN && dist <= TURN_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      boolean isplay=true;
      if (tParam != null) {
        play.turn(tParam);
      }
 else       if (next.turnType.isRoundAbout()) {
        play.roundAbout(next.turnType.getTurnAngle(),next.turnType.getExitOut());
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.makeUT();
      }
 else {
        isplay=false;
      }
      if (nextNext != null && next.distance <= TURN_IN_DISTANCE) {
        String t2Param=getTurnType(nextNext.turnType);
        if (t2Param != null) {
          if (isplay) {
            play.then();
          }
          play.turn(t2Param,next.distance);
        }
 else         if (nextNext.turnType.isRoundAbout()) {
          if (isplay) {
            play.then();
          }
          play.roundAbout(next.distance,nextNext.turnType.getTurnAngle(),nextNext.turnType.getExitOut());
        }
 else         if (nextNext.turnType.getValue().equals(TurnType.TU)) {
          if (isplay) {
            play.then();
          }
          play.makeUT(next.distance);
        }
        isplay=true;
      }
      if (isplay) {
        play.play();
      }
    }
    currentStatus=STATUS_TOLD;
  }
 else   if (currentStatus <= STATUS_200_TURN && dist <= TURN_IN_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      boolean isPlay=true;
      if (tParam != null) {
        play.turn(tParam,dist);
      }
 else       if (next.turnType.isRoundAbout()) {
        play.roundAbout(dist,next.turnType.getTurnAngle(),next.turnType.getExitOut());
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.makeUT(dist);
      }
 else {
        isPlay=false;
      }
      if (nextNext != null && next.distance <= TURN_DISTANCE) {
        TurnType t=nextNext.turnType;
        isPlay=true;
        if (next.turnType.getValue().equals(TurnType.C) && !TurnType.C.equals(t.getValue())) {
          play.goAhead(dist);
        }
        if (TurnType.TL.equals(t.getValue()) || TurnType.TSHL.equals(t.getValue()) || TurnType.TSLL.equals(t.getValue())|| TurnType.TU.equals(t.getValue())) {
          play.then().bearLeft();
        }
 else         if (TurnType.TR.equals(t.getValue()) || TurnType.TSHR.equals(t.getValue()) || TurnType.TSLR.equals(t.getValue())) {
          play.then().bearRight();
        }
      }
      if (isPlay) {
        play.play();
      }
    }
    currentStatus=STATUS_TURN;
  }
 else   if (currentStatus <= STATUS_800_PREPARE && dist <= PREPARE_DISTANCE) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      if (tParam != null) {
        play.prepareTurn(tParam,dist).play();
      }
 else       if (next.turnType.isRoundAbout()) {
        play.prepareRoundAbout(dist).play();
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.prepareMakeUT(dist).play();
      }
    }
    currentStatus=STATUS_200_TURN;
  }
 else   if ((currentStatus <= STATUS_800_PREPARE && dist <= PREPARE_DISTANCE) || (currentStatus <= STATUS_3000_PREPARE && dist <= PREPARE_LONG_DISTANCE_END && dist >= PREPARE_LONG_DISTANCE_ST)) {
    CommandBuilder play=getNewCommandPlayerToPlay();
    if (play != null) {
      String tParam=getTurnType(next.turnType);
      if (tParam != null) {
        play.prepareTurn(tParam,dist).play();
      }
 else       if (next.turnType.isRoundAbout()) {
        play.prepareRoundAbout(dist).play();
      }
 else       if (next.turnType.getValue().equals(TurnType.TU)) {
        play.prepareMakeUT(dist).play();
      }
    }
    currentStatus=currentStatus <= STATUS_3000_PREPARE ? STATUS_800_PREPARE : STATUS_200_TURN;
  }
}
