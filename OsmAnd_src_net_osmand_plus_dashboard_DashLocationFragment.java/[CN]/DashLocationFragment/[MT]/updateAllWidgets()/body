{
  DashboardOnMap d=dashboard;
  if (d == null) {
    return;
  }
  float head=d.getHeading();
  float mapRotation=d.getMapRotation();
  LatLon mw=d.getMapViewLocation();
  Location l=d.getMyLocation();
  boolean mapLinked=d.isMapLinkedToLocation() && l != null;
  LatLon myLoc=l == null ? null : new LatLon(l.getLatitude(),l.getLongitude());
  for (  DashLocationView lv : distances) {
    boolean useCenter=!mapLinked && !lv.useOnlyMyLocation;
    LatLon loc=(useCenter ? mw : myLoc);
    float h=useCenter ? -mapRotation : head;
    float[] mes=new float[2];
    if (loc != null) {
      Location.distanceBetween(lv.loc.getLatitude(),lv.loc.getLongitude(),loc.getLatitude(),loc.getLongitude(),mes);
    }
    if (lv.arrow != null) {
      if (!(lv.arrow.getDrawable() instanceof DirectionDrawable)) {
        DirectionDrawable dd=new DirectionDrawable(getActivity(),10,10);
        lv.arrow.setImageDrawable(dd);
      }
      DirectionDrawable dd=(DirectionDrawable)lv.arrow.getDrawable();
      dd.setImage(R.drawable.ic_destination_arrow_white,useCenter ? R.color.color_distance : R.color.color_myloc_distance);
      if (loc == null) {
        dd.setAngle(0);
      }
 else {
        dd.setAngle(mes[1] - h + 180 + screenOrientation);
      }
      lv.arrow.invalidate();
    }
    if (loc != null) {
      lv.txt.setTextColor(getActivity().getResources().getColor(useCenter ? R.color.color_distance : R.color.color_myloc_distance));
      lv.txt.setText(OsmAndFormatter.getFormattedDistance(mes[0],dashboard.getMyApplication()));
    }
 else {
      lv.txt.setText("");
    }
  }
}
