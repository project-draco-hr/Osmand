{
  super.onCreate(savedInstanceState);
  Intent intent=getIntent();
  if (intent == null || !intent.hasExtra(EXTRA_PLUGIN_ID)) {
    Log.e(TAG,"Required extra '" + EXTRA_PLUGIN_ID + "' is missing");
    finish();
    return;
  }
  String pluginId=intent.getStringExtra(EXTRA_PLUGIN_ID);
  if (pluginId == null) {
    Log.e(TAG,"Extra '" + EXTRA_PLUGIN_ID + "' is null");
    finish();
    return;
  }
  for (  OsmandPlugin plugin : OsmandPlugin.getAvailablePlugins()) {
    if (!plugin.getId().equals(pluginId))     continue;
    this.plugin=plugin;
    break;
  }
  if (plugin == null) {
    Log.e(TAG,"Plugin '" + EXTRA_PLUGIN_ID + "' not found");
    finish();
    return;
  }
  boolean isEnabled=OsmandPlugin.getEnabledPlugins().contains(plugin);
  setContentView(R.layout.plugin);
  getSupportActionBar().setTitle(plugin.getName());
  TextView descriptionView=(TextView)findViewById(R.id.plugin_description);
  descriptionView.setText(plugin.getDescription());
  final Class<? extends Activity> settingsActivity=plugin.getSettingsActivity();
  final Button settingsButton=(Button)findViewById(R.id.plugin_settings);
  if (settingsActivity == null) {
    settingsButton.setVisibility(View.GONE);
  }
 else {
    settingsButton.setEnabled(isEnabled);
    settingsButton.setVisibility(View.VISIBLE);
    settingsButton.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View view){
        startActivity(new Intent(PluginActivity.this,settingsActivity));
      }
    }
);
  }
  CompoundButton enableDisableButton=(CompoundButton)findViewById(R.id.plugin_enable_disable);
  enableDisableButton.setChecked(isEnabled);
  enableDisableButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener(){
    @Override public void onCheckedChanged(    CompoundButton buttonView,    boolean isChecked){
      boolean isEnabled=OsmandPlugin.getEnabledPlugins().contains(plugin);
      if (isEnabled == isChecked) {
        return;
      }
      boolean ok=OsmandPlugin.enablePlugin((OsmandApplication)getApplication(),plugin,isChecked);
      settingsButton.setEnabled(isChecked && ok);
    }
  }
);
}
