{
  boolean currentShowingAngle=settings.SHOW_VIEW_ANGLE.get();
  int currentMapRotation=settings.ROTATE_MAP.get();
  boolean registerCompassListener=overruleRegister || (currentShowingAngle && location != null) || (currentMapRotation == OsmandSettings.ROTATE_MAP_COMPASS && !routePlanningMode);
  if (sensorRegistered != registerCompassListener) {
    app.getLocationProvider().registerOrUnregisterCompassListener(registerCompassListener);
  }
}
