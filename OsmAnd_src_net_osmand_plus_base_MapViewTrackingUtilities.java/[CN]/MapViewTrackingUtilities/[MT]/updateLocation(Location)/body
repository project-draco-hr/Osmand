{
  showViewAngle=false;
  if (mapView != null) {
    if (isMapLinkedToLocation() && location != null) {
      if (settings.AUTO_ZOOM_MAP.get() != AutoZoomMap.NONE) {
        autozoom(location);
      }
      int currentMapRotation=settings.ROTATE_MAP.get();
      boolean smallSpeed=!location.hasSpeed() || location.getSpeed() < 0.5;
      showViewAngle=(!location.hasBearing() || smallSpeed);
      if (currentMapRotation == OsmandSettings.ROTATE_MAP_BEARING) {
        if (location.hasBearing() && !smallSpeed) {
          if (location.getBearing() != 0f) {
            mapView.setRotate(-location.getBearing());
          }
        }
      }
 else       if (currentMapRotation == OsmandSettings.ROTATE_MAP_COMPASS) {
        showViewAngle=routePlanningMode;
      }
      registerUnregisterSensor(location);
      mapView.setLatLon(location.getLatitude(),location.getLongitude());
    }
    RoutingHelper routingHelper=app.getRoutingHelper();
    followingMode=routingHelper.isFollowingMode();
    if (routePlanningMode != routingHelper.isRoutePlanningMode()) {
      switchToRoutePlanningMode();
    }
    mapView.refreshMap();
  }
}
