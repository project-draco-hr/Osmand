{
  final ContextMenuAdapter adapter=new ContextMenuAdapter(mapActivity);
  if (!mapActivity.getRoutingHelper().isFollowingMode() && !mapActivity.getRoutingHelper().isRoutePlanningMode()) {
    adapter.item(R.string.context_menu_item_directions_to).iconColor(R.drawable.ic_action_gdirections_dark).reg();
    adapter.item(R.string.context_menu_item_directions_from).iconColor(R.drawable.ic_action_gdirections_dark).reg();
  }
  final TargetPointsHelper targets=getMyApplication().getTargetPointsHelper();
  if (targets.getPointToNavigate() != null) {
    adapter.item(R.string.context_menu_item_destination_point).iconColor(R.drawable.ic_action_flag_dark).reg();
    adapter.item(R.string.context_menu_item_intermediate_point).iconColor(R.drawable.ic_action_flage_dark).reg();
  }
 else {
    adapter.item(R.string.context_menu_item_destination_point).iconColor(R.drawable.ic_action_flag_dark).reg();
  }
  getMyApplication().getAppCustomization().prepareLocationMenu(mapActivity,adapter);
  final AlertDialog.Builder builder=new AlertDialog.Builder(mapActivity);
  builder.setTitle(R.string.get_directions);
  final ArrayAdapter<?> listAdapter=adapter.createListAdapter(mapActivity,getMyApplication().getSettings().isLightContent());
  builder.setAdapter(listAdapter,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      int standardId=adapter.getElementId(which);
      OnContextMenuClick click=adapter.getClickAdapter(which);
      if (click != null) {
        click.onContextMenuClick(listAdapter,standardId,which,false);
      }
 else       if (standardId == R.string.context_menu_item_directions_to) {
        targets.navigateToPoint(new LatLon(latitude,longitude),true,-1,null);
        enterRoutePlanningMode(null,null,false);
      }
 else       if (standardId == R.string.context_menu_item_directions_from) {
        enterRoutePlanningMode(new LatLon(latitude,longitude),mapActivity.getContextMenu().getPointDescription(),false);
      }
 else       if (standardId == R.string.context_menu_item_intermediate_point || standardId == R.string.context_menu_item_destination_point) {
        boolean dest=standardId == R.string.context_menu_item_destination_point;
        targets.navigateToPoint(new LatLon(latitude,longitude),true,dest ? -1 : targets.getIntermediatePoints().size(),mapActivity.getContextMenu().getPointDescription());
        if (targets.getIntermediatePoints().size() > 0) {
          openIntermediatePointsDialog();
        }
      }
    }
  }
);
  builder.create().show();
}
