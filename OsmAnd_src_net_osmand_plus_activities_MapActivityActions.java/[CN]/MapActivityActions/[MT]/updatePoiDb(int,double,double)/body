{
  if (zoom < 15) {
    AccessibleToast.makeText(mapActivity,getString(R.string.update_poi_is_not_available_for_zoom),Toast.LENGTH_SHORT).show();
    return;
  }
  final AmenityIndexRepositoryOdb repo=((OsmandApplication)mapActivity.getApplication()).getResourceManager().getUpdatablePoiDb();
  if (repo == null) {
    AccessibleToast.makeText(mapActivity,getString(R.string.update_poi_no_offline_poi_index),Toast.LENGTH_LONG).show();
    return;
  }
 else {
    AccessibleToast.makeText(mapActivity,getString(R.string.update_poi_does_not_change_indexes),Toast.LENGTH_LONG).show();
  }
  final OsmandMapTileView mapView=mapActivity.getMapView();
  Rect pixRect=new Rect(-mapView.getWidth() / 2,-mapView.getHeight() / 2,3 * mapView.getWidth() / 2,3 * mapView.getHeight() / 2);
  RectF tileRect=new RectF();
  mapView.calculateTileRectangle(pixRect,mapView.getCenterPointX(),mapView.getCenterPointY(),mapView.getXTile(),mapView.getYTile(),tileRect);
  final double leftLon=MapUtils.getLongitudeFromTile(zoom,tileRect.left);
  final double topLat=MapUtils.getLatitudeFromTile(zoom,tileRect.top);
  final double rightLon=MapUtils.getLongitudeFromTile(zoom,tileRect.right);
  final double bottomLat=MapUtils.getLatitudeFromTile(zoom,tileRect.bottom);
  ProgressDialog progressDlg=ProgressDialog.show(mapActivity,getString(R.string.loading),getString(R.string.loading_data));
  mapActivity.setProgressDlg(progressDlg);
  new Thread(new Runnable(){
    @Override public void run(){
      try {
        List<Amenity> amenities=new ArrayList<Amenity>();
        boolean loadingPOIs=AmenityIndexRepositoryOdb.loadingPOIs(amenities,leftLon,topLat,rightLon,bottomLat);
        if (!loadingPOIs) {
          showToast(getString(R.string.update_poi_error_loading));
        }
 else {
          repo.updateAmenities(amenities,leftLon,topLat,rightLon,bottomLat);
          showToast(MessageFormat.format(getString(R.string.update_poi_success),amenities.size()));
          mapView.refreshMap();
        }
      }
 catch (      Exception e) {
        Log.e(PlatformUtil.TAG,"Error updating local data",e);
        showToast(getString(R.string.update_poi_error_local));
      }
 finally {
        Dialog prog=mapActivity.getProgressDlg();
        if (prog != null) {
          prog.dismiss();
          mapActivity.setProgressDlg(prog);
        }
      }
    }
  }
,"LoadingPOI").start();
}
