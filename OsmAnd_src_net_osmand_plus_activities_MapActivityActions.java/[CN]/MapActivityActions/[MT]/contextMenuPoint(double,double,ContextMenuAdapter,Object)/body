{
  final ContextMenuAdapter adapter=iadapter == null ? new ContextMenuAdapter(mapActivity) : iadapter;
  Builder builder=new AlertDialog.Builder(mapActivity);
  final OsmandMapTileView mapView=mapActivity.getMapView();
  adapter.registerItem(R.string.context_menu_item_navigate_point);
  adapter.registerItem(R.string.context_menu_item_search);
  adapter.registerItem(R.string.context_menu_item_directions);
  adapter.registerItem(R.string.context_menu_item_show_route);
  adapter.registerItem(R.string.context_menu_item_add_favorite);
  adapter.registerItem(R.string.context_menu_item_share_location);
  OsmandPlugin.registerMapContextMenu(mapActivity,latitude,longitude,adapter,selectedObj);
  builder.setItems(adapter.getItemNames(),new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      int standardId=adapter.getItemId(which);
      OnContextMenuClick click=adapter.getClickAdapter(which);
      if (click != null) {
        click.onContextMenuClick(standardId,which,false,dialog);
      }
 else       if (standardId == R.string.context_menu_item_navigate_point) {
        mapActivity.navigateToPoint(new LatLon(latitude,longitude));
      }
 else       if (standardId == R.string.context_menu_item_show_route) {
        if (checkPointToNavigate()) {
          getDirections(latitude,longitude,false);
        }
      }
 else       if (standardId == R.string.context_menu_item_directions) {
        Location loc=mapActivity.getLastKnownLocation();
        if (loc != null) {
          mapActivity.navigateToPoint(new LatLon(latitude,longitude));
          getDirections(loc.getLatitude(),loc.getLongitude(),true);
        }
 else {
          AccessibleToast.makeText(mapActivity,R.string.unknown_from_location,Toast.LENGTH_LONG).show();
        }
      }
 else       if (standardId == R.string.context_menu_item_search) {
        Intent intent=new Intent(mapActivity,OsmandIntents.getSearchActivity());
        intent.putExtra(SearchActivity.SEARCH_LAT,latitude);
        intent.putExtra(SearchActivity.SEARCH_LON,longitude);
        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
        mapActivity.startActivity(intent);
      }
 else       if (standardId == R.string.context_menu_item_add_favorite) {
        addFavouritePoint(latitude,longitude);
      }
 else       if (standardId == R.string.context_menu_item_share_location) {
        shareLocation(latitude,longitude,mapView.getZoom());
      }
    }
  }
);
  builder.create().show();
}
