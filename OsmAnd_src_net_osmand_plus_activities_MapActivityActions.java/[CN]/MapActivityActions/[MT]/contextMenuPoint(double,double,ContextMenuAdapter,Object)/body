{
  final ContextMenuAdapter adapter=iadapter == null ? new ContextMenuAdapter(mapActivity) : iadapter;
  Builder builder=new AlertDialog.Builder(mapActivity);
  final OsmandMapTileView mapView=mapActivity.getMapView();
  adapter.registerItem(R.string.context_menu_item_navigate_point,R.drawable.list_view_set_destination);
  adapter.registerItem(R.string.context_menu_item_directions,R.drawable.list_view_directions_to_here);
  adapter.registerItem(R.string.context_menu_item_show_route,R.drawable.list_view_show_route_from_here);
  adapter.registerItem(R.string.context_menu_item_search,R.drawable.list_view_search_near_here);
  adapter.registerItem(R.string.context_menu_item_share_location,R.drawable.list_view_share_location);
  adapter.registerItem(R.string.context_menu_item_add_favorite,R.drawable.list_activities_favorites);
  OsmandPlugin.registerMapContextMenu(mapActivity,latitude,longitude,adapter,selectedObj);
  ListAdapter listadapter=new ArrayAdapter<String>(mapActivity,R.layout.layers_list_activity_item,R.id.title,adapter.getItemNames()){
    @Override public View getView(    int position,    View convertView,    ViewGroup parent){
      View v=super.getView(position,convertView,parent);
      TextView tv=(TextView)v.findViewById(R.id.title);
      tv.setText(adapter.getItemName(position));
      if (adapter.getImageId(position) != 0) {
        tv.setCompoundDrawablesWithIntrinsicBounds(adapter.getImageId(position),0,0,0);
      }
 else {
        tv.setCompoundDrawablesWithIntrinsicBounds(R.drawable.list_activities_transparent,0,0,0);
      }
      final CheckBox ch=((CheckBox)v.findViewById(R.id.check_item));
      ch.setVisibility(View.GONE);
      return v;
    }
  }
;
  builder.setAdapter(listadapter,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      int standardId=adapter.getItemId(which);
      OnContextMenuClick click=adapter.getClickAdapter(which);
      if (click != null) {
        click.onContextMenuClick(standardId,which,false,dialog);
      }
 else       if (standardId == R.string.context_menu_item_search) {
        Intent intent=new Intent(mapActivity,OsmandIntents.getSearchActivity());
        intent.putExtra(SearchActivity.SEARCH_LAT,latitude);
        intent.putExtra(SearchActivity.SEARCH_LON,longitude);
        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
        mapActivity.startActivity(intent);
      }
 else       if (standardId == R.string.context_menu_item_navigate_point) {
        mapActivity.navigateToPoint(new LatLon(latitude,longitude));
      }
 else       if (standardId == R.string.context_menu_item_directions) {
        Location loc=mapActivity.getLastKnownLocation();
        if (loc != null) {
          mapActivity.navigateToPoint(new LatLon(latitude,longitude));
          getDirections(loc.getLatitude(),loc.getLongitude(),true);
        }
 else {
          AccessibleToast.makeText(mapActivity,R.string.unknown_from_location,Toast.LENGTH_LONG).show();
        }
      }
 else       if (standardId == R.string.context_menu_item_show_route) {
        if (checkPointToNavigate()) {
          getDirections(latitude,longitude,false);
        }
      }
 else       if (standardId == R.string.context_menu_item_share_location) {
        shareLocation(latitude,longitude,mapView.getZoom());
      }
 else       if (standardId == R.string.context_menu_item_add_favorite) {
        addFavouritePoint(latitude,longitude);
      }
    }
  }
);
  builder.create().show();
}
