{
  if (log.isDebugEnabled()) {
    log.debug("Start downloading tile : " + request.url);
  }
  if (request != null && request.fileToSave != null && request.url != null) {
    currentlyDownloaded.add(request.fileToSave);
    try {
      request.fileToSave.getParentFile().mkdirs();
      URL url=new URL(request.url);
      URLConnection connection=url.openConnection();
      connection.setRequestProperty("User-Agent",DefaultLauncherConstants.APP_NAME + "/" + DefaultLauncherConstants.APP_VERSION);
      BufferedInputStream inputStream=new BufferedInputStream(connection.getInputStream(),8 * 1024);
      FileOutputStream stream=null;
      try {
        stream=new FileOutputStream(request.fileToSave);
        Algoritms.streamCopy(inputStream,stream);
        stream.flush();
      }
  finally {
        Algoritms.closeStream(inputStream);
        Algoritms.closeStream(stream);
      }
      if (log.isDebugEnabled()) {
        log.debug("Downloading tile : " + request.url + " successfull "+ (System.currentTimeMillis() - time)+ " ms");
      }
    }
 catch (    UnknownHostException e) {
      currentErrors++;
      log.error("UnknownHostException, cannot download tile " + request.url,e);
    }
catch (    IOException e) {
      currentErrors++;
      log.warn("Cannot download tile : " + request.url,e);
    }
 finally {
      currentlyDownloaded.remove(request.fileToSave);
    }
    if (callback != null) {
      callback.tileDownloaded(request);
    }
  }
}
