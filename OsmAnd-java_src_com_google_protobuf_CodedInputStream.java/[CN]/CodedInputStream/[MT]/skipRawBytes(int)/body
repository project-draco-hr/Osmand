{
  if (size < 0) {
    throw InvalidProtocolBufferException.negativeSize();
  }
  if (totalBytesRetired + bufferPos + size > currentLimit) {
    skipRawBytes(currentLimit - totalBytesRetired - bufferPos);
    throw InvalidProtocolBufferException.truncatedMessage();
  }
  if (size <= bufferSize - bufferPos) {
    bufferPos+=size;
  }
 else {
    int pos=bufferSize - bufferPos;
    totalBytesRetired+=pos;
    bufferPos=0;
    bufferSize=0;
    while (pos < size) {
      final int n=(input == null) ? -1 : (int)input.skip(size - pos);
      if (n <= 0) {
        throw InvalidProtocolBufferException.truncatedMessage();
      }
      pos+=n;
      totalBytesRetired+=n;
    }
  }
}
