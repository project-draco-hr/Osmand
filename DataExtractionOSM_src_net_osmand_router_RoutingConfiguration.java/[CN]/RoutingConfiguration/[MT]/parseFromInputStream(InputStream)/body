{
  try {
    final SAXParser parser=SAXParserFactory.newInstance().newSAXParser();
    final RoutingConfiguration.Builder config=new RoutingConfiguration.Builder();
    DefaultHandler handler=new DefaultHandler(){
      String currentSelectedRouter=null;
      GeneralRouter currentRouter=null;
      @Override public void startElement(      String uri,      String localName,      String qName,      Attributes attributes) throws SAXException {
        String name=parser.isNamespaceAware() ? localName : qName;
        if ("osmand_routing_config".equals(name)) {
          config.defaultRouter=attributes.getValue("defaultProfile");
        }
 else         if ("attribute".equals(name)) {
          String key=attributes.getValue("name");
          if (currentSelectedRouter != null) {
            key=currentSelectedRouter + "$" + key;
          }
          config.attributes.put(key,attributes.getValue("value"));
        }
 else         if ("routingProfile".equals(name)) {
          currentSelectedRouter=attributes.getValue("name");
          Map<String,String> attrs=new LinkedHashMap<String,String>();
          for (int i=0; i < attributes.getLength(); i++) {
            attrs.put(parser.isNamespaceAware() ? attributes.getLocalName(i) : attributes.getQName(i),attributes.getValue(i));
          }
          currentRouter=new GeneralRouter(GeneralRouterProfile.valueOf(attributes.getValue("baseProfile").toUpperCase()),attrs);
          config.routers.put(currentSelectedRouter,currentRouter);
        }
 else         if ("road".equals(name)) {
          String key=attributes.getValue("tag") + "$" + attributes.getValue("value");
          currentRouter.highwayPriorities.put(key,parseSilentDouble(attributes.getValue("priority"),1));
          currentRouter.highwayFuturePriorities.put(key,parseSilentDouble(attributes.getValue("dynamicPriority"),1));
          currentRouter.highwaySpeed.put(key,parseSilentDouble(attributes.getValue("speed"),10));
        }
 else         if ("obstacle".equals(name)) {
          String key=attributes.getValue("tag") + "$" + attributes.getValue("value");
          currentRouter.obstacles.put(key,parseSilentDouble(attributes.getValue("penalty"),0));
        }
 else         if ("avoid".equals(name)) {
          String key=attributes.getValue("tag") + "$" + attributes.getValue("value");
          double priority=parseSilentDouble(attributes.getValue("decreasedPriority"),0);
          if (priority == 0) {
            currentRouter.avoid.put(key,priority);
          }
 else {
            currentRouter.highwayPriorities.put(key,priority);
          }
        }
      }
    }
;
    parser.parse(is,handler);
    return config;
  }
 catch (  ParserConfigurationException e) {
    throw new SAXException(e);
  }
}
