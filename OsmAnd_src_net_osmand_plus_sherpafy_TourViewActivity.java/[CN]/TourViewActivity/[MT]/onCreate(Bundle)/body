{
  customization=(SherpafyCustomization)getMyApplication().getAppCustomization();
  setTheme(R.style.OsmandLightTheme);
  ((OsmandApplication)getApplication()).setLanguage(this);
  super.onCreate(savedInstanceState);
  if (getIntent() != null) {
    Intent intent=getIntent();
    if (intent.getExtras() != null && intent.getExtras().containsKey(APP_EXIT_KEY)) {
      getMyApplication().closeApplication(this);
      return;
    }
  }
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
    getWindow().setUiOptions(ActivityInfo.UIOPTION_SPLIT_ACTION_BAR_WHEN_NARROW);
  }
  getSupportActionBar().setTitle(R.string.sherpafy_app_name);
  setContentView(R.layout.sherpafy_browse_tour);
  mDrawerLayout=(DrawerLayout)findViewById(R.id.drawer_layout);
  mDrawerList=(ListView)findViewById(R.id.left_drawer);
  mDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow,GravityCompat.START);
  mDrawerLayout.setDrawerTitle(GravityCompat.START,getString(R.string.sherpafy_app_name));
  drawerAdapter=setupAdapter();
  mDrawerList.setAdapter(drawerAdapter);
  mDrawerList.setOnItemClickListener(new OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      selectMenu(drawerAdapter.getItem(position));
    }
  }
);
  mDrawerToggle=new ActionBarDrawerToggle(this,mDrawerLayout,R.drawable.ic_navigation_drawer_light,R.string.default_buttons_other_actions,R.string.close);
  if (getMyApplication().isApplicationInitializing()) {
    FragmentManager fragmentManager=getSupportFragmentManager();
    fragmentManager.beginTransaction().replace(R.id.content_frame,new SherpafyLoadingFragment()).commit();
  }
 else   if (state == viewState.STATE_DETAILED_INSTRUCTIONS) {
    TourInformation tour=(TourInformation)selectedItem;
    showDetailedInstructions(getString(R.string.sherpafy_instructions),tour.getInstructions());
  }
 else   if (state == viewState.STATE_DETAILED_OVERVIEW) {
    TourInformation tour=(TourInformation)selectedItem;
    showDetailedInstructions(getString(R.string.sherpafy_overview),tour.getFulldescription());
  }
 else {
    showSelectedItem();
  }
}
