{
  String f=filter;
  boolean change=false;
  if (endingText.length() > 0) {
    while (!f.endsWith(endingText) && endingText.length() > 0) {
      endingText=endingText.substring(1);
      change=true;
    }
    f=f.substring(0,f.length() - endingText.length());
  }
  if (!currentFilter.equals(f) || !initFilter) {
    currentFilter=f;
    initFilter=true;
    progress.setVisibility(View.VISIBLE);
    namesFilter.cancelPreviousFilter(f);
    namesFilter.filter(f);
  }
  if (change) {
    if (previousSpan != null) {
      searchText.getText().removeSpan(previousSpan);
    }
    if (endingText.length() > 0) {
      previousSpan=new StyleSpan(Typeface.BOLD_ITALIC);
      searchText.getText().setSpan(previousSpan,currentFilter.length(),currentFilter.length() + endingText.length(),Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
    }
  }
}
