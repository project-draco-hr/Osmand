{
  String currentFilter=SearchByNameAbstractActivity.this.currentFilter;
  if (msg.what == MESSAGE_CLEAR_LIST) {
    minimalIndex=Integer.MAX_VALUE;
    minimalText=null;
    getListAdapter().clear();
    if (currentFilter.length() == 0) {
      endingMap.clear();
    }
    updateTextBox(currentFilter,"",null,true);
  }
 else   if (msg.what == MESSAGE_ADD_ENTITY) {
    getListAdapter().add((T)msg.obj);
    if (currentFilter.length() > 0) {
      String shortText=getShortText((T)msg.obj);
      int entries=!endingMap.containsKey(shortText) ? 0 : endingMap.get(shortText);
      if (entries < minimalIndex) {
        if (minimalText != null) {
          endingMap.put(minimalText,endingMap.get(minimalText) - 1);
        }
        minimalIndex=entries;
        minimalText=shortText;
        endingMap.put(shortText,entries + 1);
        String locEndingText;
        if (shortText.toLowerCase().startsWith(currentFilter.toLowerCase())) {
          locEndingText=shortText.substring(currentFilter.length());
        }
 else {
          locEndingText=" - " + shortText;
        }
        if (locEndingText.length() > MAX_VISIBLE_NAME) {
          locEndingText=locEndingText.substring(0,MAX_VISIBLE_NAME) + "..";
        }
        updateTextBox(currentFilter,locEndingText,(T)msg.obj,true);
      }
    }
  }
}
