{
  DataInputStream datinput=new DataInputStream(input);
  int headersize=datinput.readInt();
  if (headersize > MAX_HEADER_SIZE) {
    throw new FileFormatException("Unexpectedly long header " + MAX_HEADER_SIZE + " bytes. Possibly corrupt file.");
  }
  byte buf[]=new byte[headersize];
  datinput.readFully(buf);
  Fileformat.BlockHeader header=Fileformat.BlockHeader.parseFrom(buf);
  FileBlockHead fileblock=new FileBlockHead(header.getType(),header.getIndexdata());
  fileblock.datasize=header.getDatasize();
  if (header.getDatasize() > MAX_BODY_SIZE) {
    throw new FileFormatException("Unexpectedly long body " + MAX_BODY_SIZE + " bytes. Possibly corrupt file.");
  }
  fileblock.input=input;
  if (input instanceof FileInputStream)   fileblock.data_offset=((FileInputStream)input).getChannel().position();
  return fileblock;
}
