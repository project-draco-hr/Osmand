{
  super.onCreate(savedInstanceState);
  addPreferencesFromResource(R.xml.settings_pref);
  PreferenceScreen screen=getPreferenceScreen();
  for (  BooleanPreference b : booleanPreferences) {
    CheckBoxPreference p=(CheckBoxPreference)screen.findPreference(b.getId());
    p.setOnPreferenceChangeListener(this);
    b.setPref(p);
  }
  useInternetToDownload=(CheckBoxPreference)screen.findPreference(OsmandSettings.USE_INTERNET_TO_DOWNLOAD_TILES);
  useInternetToDownload.setOnPreferenceChangeListener(this);
  reloadIndexes=(Preference)screen.findPreference(OsmandSettings.RELOAD_INDEXES);
  reloadIndexes.setOnPreferenceClickListener(this);
  downloadIndexes=(Preference)screen.findPreference(OsmandSettings.DOWNLOAD_INDEXES);
  downloadIndexes.setOnPreferenceClickListener(this);
  saveCurrentTrack=(Preference)screen.findPreference(OsmandSettings.SAVE_CURRENT_TRACK);
  saveCurrentTrack.setOnPreferenceClickListener(this);
  userName=(EditTextPreference)screen.findPreference(OsmandSettings.USER_NAME);
  userName.setOnPreferenceChangeListener(this);
  userPassword=(EditTextPreference)screen.findPreference(OsmandSettings.USER_PASSWORD);
  userPassword.setOnPreferenceChangeListener(this);
  applicationMode=(ListPreference)screen.findPreference(OsmandSettings.APPLICATION_MODE);
  applicationMode.setOnPreferenceChangeListener(this);
  rotateMap=(ListPreference)screen.findPreference(OsmandSettings.ROTATE_MAP);
  rotateMap.setOnPreferenceChangeListener(this);
  saveTrackInterval=(ListPreference)screen.findPreference(OsmandSettings.SAVE_TRACK_INTERVAL);
  saveTrackInterval.setOnPreferenceChangeListener(this);
  positionOnMap=(ListPreference)screen.findPreference(OsmandSettings.POSITION_ON_MAP);
  positionOnMap.setOnPreferenceChangeListener(this);
  mapScreenOrientation=(ListPreference)screen.findPreference(OsmandSettings.MAP_SCREEN_ORIENTATION);
  mapScreenOrientation.setOnPreferenceChangeListener(this);
  maxLevelToDownload=(ListPreference)screen.findPreference(OsmandSettings.MAX_LEVEL_TO_DOWNLOAD_TILE);
  maxLevelToDownload.setOnPreferenceChangeListener(this);
  tileSourcePreference=(ListPreference)screen.findPreference(OsmandSettings.MAP_TILE_SOURCES);
  tileSourcePreference.setOnPreferenceChangeListener(this);
  routerPreference=(ListPreference)screen.findPreference(OsmandSettings.ROUTER_SERVICE);
  routerPreference.setOnPreferenceChangeListener(this);
  voicePreference=(ListPreference)screen.findPreference(OsmandSettings.VOICE_PROVIDER);
  voicePreference.setOnPreferenceChangeListener(this);
  rendererPreference=(ListPreference)screen.findPreference(OsmandSettings.RENDERER);
  rendererPreference.setOnPreferenceChangeListener(this);
  routeServiceInterval=(ListPreference)screen.findPreference(OsmandSettings.SERVICE_OFF_INTERVAL);
  routeServiceInterval.setOnPreferenceChangeListener(this);
  routeServiceWaitInterval=(ListPreference)screen.findPreference(OsmandSettings.SERVICE_OFF_WAIT_INTERVAL);
  routeServiceWaitInterval.setOnPreferenceChangeListener(this);
  routeServiceProvider=(ListPreference)screen.findPreference(OsmandSettings.SERVICE_OFF_PROVIDER);
  routeServiceProvider.setOnPreferenceChangeListener(this);
  routeServiceEnabled=(CheckBoxPreference)screen.findPreference(OsmandSettings.SERVICE_OFF_ENABLED);
  routeServiceEnabled.setOnPreferenceChangeListener(this);
  broadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      routeServiceEnabled.setChecked(false);
    }
  }
;
  registerReceiver(broadcastReceiver,new IntentFilter(NavigationService.OSMAND_STOP_SERVICE_ACTION));
}
