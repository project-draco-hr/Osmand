{
  final List<LocationPointWrapper> deletedPoints=new ArrayList<WaypointHelper.LocationPointWrapper>();
  final FragmentActivity ctx=getActivity();
  final AlertDialog[] srcDialog=new AlertDialog[1];
  points.add(0,new LocationPointWrapper());
  final ArrayAdapter<LocationPointWrapper> listAdapter=new ArrayAdapter<LocationPointWrapper>(ctx,R.layout.waypoint_reached,R.id.title,points){
    @Override public View getView(    final int position,    View convertView,    ViewGroup parent){
      View v=convertView;
      if (position == 0) {
        return createDialogHeader(ctx,edit,true,srcDialog[0]);
      }
      if (v == null || v.findViewById(R.id.waypoint_icon) == null) {
        v=ctx.getLayoutInflater().inflate(R.layout.waypoint_reached,null);
      }
      updatePointInfoView(app,(MapActivity)ctx,v,getItem(position),WaypointDialogFragment.this);
      View remove=v.findViewById(R.id.info_close);
      if (!edit) {
        remove.setVisibility(View.GONE);
      }
 else {
        remove.setVisibility(View.VISIBLE);
        ((ImageButton)remove).setImageDrawable(app.getIconsCache().getContentIcon(R.drawable.ic_action_gremove_dark));
        remove.setOnClickListener(new View.OnClickListener(){
          @Override public void onClick(          View view){
            LocationPointWrapper point=points.get(position);
            remove(point);
            deletedPoints.add(point);
            notifyDataSetChanged();
          }
        }
);
      }
      return v;
    }
  }
;
  ListView listView=new ListView(ctx);
  listView.setAdapter(listAdapter);
  listView.setOnItemClickListener(new AdapterView.OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> adapterView,    View view,    int i,    long l){
      LocationPointWrapper ps=listAdapter.getItem(i);
      showOnMap(app,ctx,ps.getPoint(),WaypointDialogFragment.this);
    }
  }
);
  AlertDialog.Builder builder=new AlertDialog.Builder(ctx);
  builder.setView(listView);
  builder.setPositiveButton(R.string.shared_string_ok,new OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      waypointHelper.removeVisibleLocationPoint(deletedPoints);
    }
  }
);
  if (edit) {
    builder.setNegativeButton(ctx.getString(R.string.shared_string_cancel),null);
  }
  AlertDialog dlg=builder.create();
  srcDialog[0]=dlg;
  return dlg;
}
