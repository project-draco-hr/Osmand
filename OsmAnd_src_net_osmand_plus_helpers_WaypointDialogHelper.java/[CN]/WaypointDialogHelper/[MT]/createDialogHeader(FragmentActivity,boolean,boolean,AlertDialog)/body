{
  View v;
  v=a.getLayoutInflater().inflate(R.layout.waypoint_title,null);
  ImageView iBack=(ImageView)v.findViewById(R.id.back);
  if (dlg != null) {
    iBack.setVisibility(View.GONE);
  }
 else {
    iBack.setVisibility(View.VISIBLE);
    iBack.setImageResource(app.getSettings().isLightContent() ? R.drawable.ic_back_drawer_white : R.drawable.ic_back_drawer_dark);
  }
  ImageButton edit=(ImageButton)v.findViewById(R.id.edit);
  ImageButton sort=(ImageButton)v.findViewById(R.id.sort);
  ImageButton all=(ImageButton)v.findViewById(R.id.all);
  edit.setImageResource(app.getSettings().isLightContent() ? R.drawable.ic_action_gedit_light : R.drawable.ic_action_gedit_dark);
  edit.setVisibility(editF ? View.GONE : View.VISIBLE);
  edit.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (flat) {
        showWaypointsDialogFlat(a,true);
      }
 else {
        showWaypointsDialog(a,true);
      }
      if (dlg != null) {
        dlg.dismiss();
      }
 else       if (a instanceof MapActivity) {
        ((MapActivity)a).getMapActions().prepareStartOptionsMenu();
        ((MapActivity)a).getMapActions().toggleDrawer();
      }
    }
  }
);
  if (app.getTargetPointsHelper().getIntermediatePoints().size() > 0) {
    sort.setVisibility(View.VISIBLE);
    sort.setImageResource(app.getSettings().isLightContent() ? R.drawable.ic_sort_waypoint_white : R.drawable.ic_sort_waypoint_dark);
    sort.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View v){
        IntermediatePointsDialog.openIntermediatePointsDialog(app.getMapActivity(),app,true);
        if (dlg != null) {
          dlg.dismiss();
        }
 else         if (a instanceof MapActivity) {
          ((MapActivity)a).getMapActions().prepareStartOptionsMenu();
          ((MapActivity)a).getMapActions().toggleDrawer();
        }
      }
    }
);
  }
 else {
    sort.setVisibility(View.GONE);
  }
  if (!waypointHelper.isRouteCalculated()) {
    all.setVisibility(View.GONE);
  }
 else {
    all.setVisibility(View.VISIBLE);
    if (flat) {
      all.setImageResource(app.getSettings().isLightContent() ? R.drawable.ic_tree_list_white : R.drawable.ic_tree_list_dark);
    }
 else {
      all.setImageResource(app.getSettings().isLightContent() ? R.drawable.ic_flat_list_white : R.drawable.ic_flat_list_dark);
    }
    all.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View v){
        if (dlg != null) {
          if (flat) {
            showWaypointsDialog(a,editF);
          }
 else {
            showWaypointsDialogFlat(a,editF);
          }
          dlg.dismiss();
        }
 else         if (a instanceof MapActivity) {
          ((MapActivity)a).getMapActions().showWaypointsInDrawer(!flat);
        }
      }
    }
);
  }
  return v;
}
