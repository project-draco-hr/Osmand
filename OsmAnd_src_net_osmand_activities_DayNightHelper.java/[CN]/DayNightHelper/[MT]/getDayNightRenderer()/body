{
  if (dayNightMode.isDay()) {
    return Boolean.TRUE;
  }
 else   if (dayNightMode.isNight()) {
    return Boolean.FALSE;
  }
 else   if (dayNightMode.isAuto()) {
    long currentTime=System.currentTimeMillis();
    if (currentTime - lastAutoCall > 5000) {
      lastAutoCall=System.currentTimeMillis();
      try {
        LocationManager locationProvider=(LocationManager)osmandApplication.getSystemService(Context.LOCATION_SERVICE);
        Location lastKnownLocation=locationProvider.getLastKnownLocation(LocationManager.PASSIVE_PROVIDER);
        if (lastKnownLocation == null) {
          return null;
        }
        double longitude=lastKnownLocation.getLongitude();
        Date actualTime=new Date();
        SunriseSunset daynightSwitch=new SunriseSunset(lastKnownLocation.getLatitude(),longitude < 0 ? 360 - longitude : longitude,actualTime,TimeZone.getDefault().getOffset(actualTime.getTime()) / 3600000);
        boolean daytime=daynightSwitch.isDaytime();
        log.debug("Sunrise/sunset setting to day: " + daytime);
        lastAutoValue=Boolean.valueOf(daytime);
        return lastAutoValue;
      }
 catch (      IllegalArgumentException e) {
        log.warn("Network location provider not available");
      }
catch (      SecurityException e) {
        log.warn("Missing permitions to get actual location!");
      }
      return null;
    }
 else {
      return lastAutoValue;
    }
  }
 else   if (dayNightMode.isSensor()) {
    log.debug("lux value:" + lux + " setting to day: "+ (lux > SensorManager.LIGHT_CLOUDY));
    return lux > SensorManager.LIGHT_CLOUDY ? Boolean.TRUE : Boolean.FALSE;
  }
  return null;
}
