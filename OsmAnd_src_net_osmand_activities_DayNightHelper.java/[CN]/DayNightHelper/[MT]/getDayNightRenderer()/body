{
  if (dayNightMode.isDay()) {
    return Boolean.TRUE;
  }
 else   if (dayNightMode.isNight()) {
    return Boolean.FALSE;
  }
 else   if (dayNightMode.isAuto()) {
    try {
      LocationManager locationProvider=(LocationManager)osmandApplication.getSystemService(Context.LOCATION_SERVICE);
      Location lastKnownLocation=locationProvider.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);
      if (lastKnownLocation == null) {
        return null;
      }
      SunriseSunset daynightSwitch=new SunriseSunset(lastKnownLocation.getLatitude(),lastKnownLocation.getLongitude(),new Date(),TimeZone.getDefault().getRawOffset() / 3600000);
      boolean daytime=daynightSwitch.isDaytime();
      log.debug("Sunrise/sunset setting to day: " + daytime);
      if (daytime) {
        return Boolean.TRUE;
      }
 else {
        return Boolean.FALSE;
      }
    }
 catch (    IllegalArgumentException e) {
      log.warn("Network location provider not available");
    }
catch (    SecurityException e) {
      log.warn("Missing permitions to get actual location!");
    }
    return null;
  }
 else   if (dayNightMode.isSensor()) {
    log.debug("lux value:" + lux + " setting to day: "+ (lux > SensorManager.LIGHT_CLOUDY));
    return lux > SensorManager.LIGHT_CLOUDY ? Boolean.TRUE : Boolean.FALSE;
  }
  return null;
}
