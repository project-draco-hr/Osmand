{
  final OsmAndAppCustomization appCustomization=app.getAppCustomization();
  if (app.getSettings().FOLLOW_THE_ROUTE.get() && !app.getRoutingHelper().isRouteCalculated()) {
    startMapActivity(activity);
    return false;
  }
  boolean firstTime=false;
  SharedPreferences pref=activity.getPreferences(Context.MODE_WORLD_WRITEABLE);
  boolean appVersionChanged=false;
  if (!pref.contains(FIRST_TIME_APP_RUN)) {
    firstTime=true;
    pref.edit().putBoolean(FIRST_TIME_APP_RUN,true).commit();
    pref.edit().putString(VERSION_INSTALLED,Version.getFullVersion(app)).commit();
  }
 else   if (!Version.getFullVersion(app).equals(pref.getString(VERSION_INSTALLED,""))) {
    pref.edit().putString(VERSION_INSTALLED,Version.getFullVersion(app)).commit();
    appVersionChanged=true;
  }
  if (appCustomization.showFirstTimeRunAndTips(firstTime,appVersionChanged)) {
    if (firstTime) {
      applicationInstalledFirstTime(activity);
    }
 else {
      int i=pref.getInt(TIPS_SHOW,0);
      if (i < 7) {
        pref.edit().putInt(TIPS_SHOW,++i).commit();
      }
      if (i == 1 || i == 5 || appVersionChanged) {
        if (TIPS_AND_TRICKS) {
          TipsAndTricksActivity tipsActivity=new TipsAndTricksActivity(activity);
          Dialog dlg=tipsActivity.getDialogToShowTips(!appVersionChanged,false);
          dlg.show();
        }
 else {
          if (appVersionChanged) {
            final Intent helpIntent=new Intent(activity,HelpActivity.class);
            helpIntent.putExtra(HelpActivity.TITLE,Version.getAppVersion((OsmandApplication)activity.getApplication()));
            helpIntent.putExtra(HelpActivity.URL,LATEST_CHANGES_URL);
            activity.startActivity(helpIntent);
          }
        }
      }
    }
  }
  return firstTime;
}
