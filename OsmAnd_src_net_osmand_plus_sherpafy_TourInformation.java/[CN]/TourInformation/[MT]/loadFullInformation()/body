{
  XmlPullParser parser=PlatformUtil.newXMLPullParser();
  final Reader reader=getUTF8Reader(new FileInputStream(new File(folder,"inventory.xml")));
  parser.setInput(reader);
  int tok;
  String text="";
  StageInformation stage=null;
  StageFavoriteGroup group=null;
  StageFavorite favorite=null;
  stageInformation.clear();
  while ((tok=parser.next()) != XmlPullParser.END_DOCUMENT) {
    if (tok == XmlPullParser.START_TAG) {
      String tag=parser.getName();
      if (tag.equals("tour")) {
        name=getDefAttribute(parser,"name",name);
        mode=getDefAttribute(parser,"mode","");
        homeUrl=getDefAttribute(parser,"url","");
      }
 else       if (tag.equals("stage")) {
        stage=new StageInformation(this,stageInformation.size());
        stage.name=getDefAttribute(parser,"name","");
        stage.mode=getDefAttribute(parser,"mode","");
      }
 else       if (tag.equals("prerequisite")) {
        String map=getDefAttribute(parser,"map","");
        if (!Algorithms.isEmpty(map)) {
          maps.add(map);
        }
      }
 else       if (tag.equals("itinerary") && stage != null) {
        String img=getDefAttribute(parser,"image","");
        stage.distance=Double.parseDouble(getDefAttribute(parser,"distance","0"));
        stage.duration=Integer.parseInt(getDefAttribute(parser,"duration","0"));
        double slat=Double.parseDouble(getDefAttribute(parser,"startLat","0"));
        double slon=Double.parseDouble(getDefAttribute(parser,"startLon","0"));
        if (slat != 0 || slon != 0) {
          stage.startPoint=new LatLon(slat,slon);
        }
        if (img.startsWith(FILE_PREFIX)) {
          stage.itineraryFile=getFile(img);
        }
        stage.itinerary=getInnerXml(parser);
      }
 else       if (stage != null && tag.equals("group")) {
        group=new StageFavoriteGroup();
        group.color=Algorithms.parseColor(getDefAttribute(parser,"color",Algorithms.colorToString(StageImageDrawable.INFO_COLOR)));
        group.name=getDefAttribute(parser,"name","");
        group.id=getDefAttribute(parser,"id","");
        group.order=stage.favorites.size();
        stage.favorites.add(group);
      }
 else       if (group != null && tag.equals("favorite")) {
        favorite=new StageFavorite();
        favorite.location=new LatLon(Double.parseDouble(getDefAttribute(parser,"lat","0")),Double.parseDouble(getDefAttribute(parser,"lon","0")));
        favorite.name=getDefAttribute(parser,"name","");
        favorite.group=group;
        favorite.order=stage.favorites.size();
        group.favorites.add(favorite);
        stage.favorites.add(favorite);
      }
 else       if (tag.equals("fullDescription")) {
        fulldescription=getInnerXml(parser);
      }
 else       if (tag.equals("instructions")) {
        instructions=getInnerXml(parser);
      }
 else       if (favorite != null && tag.equals("description")) {
        favorite.fullDescription=getInnerXml(parser);
      }
 else       if (stage != null && tag.equals("description")) {
        stage.fullDescription=getInnerXml(parser);
      }
    }
 else     if (tok == XmlPullParser.TEXT) {
      text=parser.getText();
    }
 else     if (tok == XmlPullParser.END_TAG) {
      String tag=parser.getName();
      if (tag.equals("stage")) {
        stageInformation.add(stage);
        stage=null;
      }
 else       if (favorite != null && tag.equals("defaultImage")) {
        if (text.startsWith(FILE_PREFIX)) {
          favorite.imgFile=getFile(text);
        }
      }
 else       if (stage != null && tag.equals("defaultImage")) {
        if (text.startsWith(FILE_PREFIX)) {
          stage.imgFile=getFile(text);
        }
      }
 else       if (stage != null && tag.equals("group")) {
        group=null;
      }
 else       if (stage != null && tag.equals("favorite")) {
        favorite=null;
      }
 else       if (tag.equals("defaultImage")) {
        if (text.startsWith(FILE_PREFIX)) {
          imgFile=getFile(text);
        }
      }
 else       if (stage != null && tag.equals("gpx")) {
        if (text.startsWith(FILE_PREFIX)) {
          stage.gpxFile=getFile(text);
        }
      }
 else       if (tag.equals("shortDescription")) {
        if (favorite != null) {
          favorite.shortDescription=text;
        }
 else         if (stage != null) {
          stage.shortDescription=text;
        }
 else {
          shortDescription=text;
        }
      }
      text="";
    }
  }
  reader.close();
}
