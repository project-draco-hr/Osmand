{
  final ListView lv=(ListView)settingsDlg.findViewById(android.R.id.list);
  lv.setOnItemClickListener(new OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      if (listAdapter.getItem(position) instanceof OtherSettingsRoutingParameter) {
        final Intent settings=new Intent(mapActivity,SettingsNavigationActivity.class);
        settings.putExtra(SettingsNavigationActivity.INTENT_SKIP_DIALOG,true);
        mapActivity.startActivity(settings);
      }
 else       if (view.findViewById(R.id.GPXRouteSpinner) != null) {
        showOptionsMenu((TextView)view.findViewById(R.id.GPXRouteSpinner));
      }
 else {
        CheckBox ch=(CheckBox)view.findViewById(R.id.check_item);
        if (ch != null) {
          ch.setChecked(!ch.isChecked());
        }
      }
    }
  }
);
  listAdapter=new ArrayAdapter<LocalRoutingParameter>(ctx,R.layout.layers_list_activity_item,R.id.title,getRoutingParameters(settings.APPLICATION_MODE.get())){
    @Override public View getView(    final int position,    View convertView,    ViewGroup parent){
      LocalRoutingParameter parameter=getItem(position);
      if (parameter instanceof GpxLocalRoutingParameter) {
        View v=mapActivity.getLayoutInflater().inflate(R.layout.plan_route_gpx,null);
        final TextView gpxSpinner=(TextView)v.findViewById(R.id.GPXRouteSpinner);
        updateSpinnerItems(gpxSpinner);
        return v;
      }
      if (parameter instanceof OtherSettingsRoutingParameter) {
        View v=mapActivity.getLayoutInflater().inflate(R.layout.layers_list_activity_item,null);
        final ImageView icon=(ImageView)v.findViewById(R.id.icon);
        icon.setImageDrawable(mapActivity.getMyApplication().getIconsCache().getContentIcon(R.drawable.ic_action_gsettings_dark));
        icon.setVisibility(View.VISIBLE);
        ((TextView)v.findViewById(R.id.title)).setText(R.string.routing_settings_2);
        v.findViewById(R.id.check_item).setVisibility(View.GONE);
        return v;
      }
      return inflateRoutingParameter(position);
    }
    private View inflateRoutingParameter(    final int position){
      View v=mapActivity.getLayoutInflater().inflate(R.layout.layers_list_activity_item,null);
      final TextView tv=(TextView)v.findViewById(R.id.title);
      final CheckBox ch=((CheckBox)v.findViewById(R.id.check_item));
      final LocalRoutingParameter rp=getItem(position);
      tv.setText(rp.getText(mapActivity));
      ch.setOnCheckedChangeListener(null);
      if (rp.routingParameter != null && rp.routingParameter.getId().equals("short_way")) {
        ch.setChecked(!settings.FAST_ROUTE_MODE.get());
      }
 else {
        ch.setChecked(rp.isSelected(settings));
      }
      ch.setVisibility(View.VISIBLE);
      ch.setOnCheckedChangeListener(new OnCheckedChangeListener(){
        @Override public void onCheckedChanged(        CompoundButton buttonView,        boolean isChecked){
          if (rp.routingParameter != null && rp.routingParameter.getId().equals("short_way")) {
            settings.FAST_ROUTE_MODE.set(!isChecked);
          }
          rp.setSelected(settings,isChecked);
          if (rp instanceof OtherLocalRoutingParameter) {
            updateGpxRoutingParameter((OtherLocalRoutingParameter)rp);
          }
          mapActivity.getRoutingHelper().recalculateRouteDueToSettingsChange();
        }
      }
);
      return v;
    }
  }
;
  lv.setAdapter(listAdapter);
}
