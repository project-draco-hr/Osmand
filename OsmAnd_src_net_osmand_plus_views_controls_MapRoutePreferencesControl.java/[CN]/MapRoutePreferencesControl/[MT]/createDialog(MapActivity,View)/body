{
  final Dialog dialog=new Dialog(mapActivity);
  WindowManager.LayoutParams lp=new WindowManager.LayoutParams();
  final int maxHeight;
  if (ScreenOrientationHelper.isOrientationPortrait(mapActivity)) {
    maxHeight=(int)mapActivity.getResources().getDimension(R.dimen.map_route_planning_max_height);
    lp.width=WindowManager.LayoutParams.MATCH_PARENT;
    lp.height=WindowManager.LayoutParams.WRAP_CONTENT;
    lp.gravity=Gravity.BOTTOM;
  }
 else {
    maxHeight=-1;
    lp.height=WindowManager.LayoutParams.MATCH_PARENT;
    lp.width=(int)mapActivity.getResources().getDimension(R.dimen.map_route_planning_land_width);
    lp.gravity=Gravity.LEFT;
  }
  dialog.getContext().setTheme(R.style.Dialog_Fullscreen);
  dialog.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND);
  dialog.getWindow().requestFeature(Window.FEATURE_NO_TITLE);
  dialog.setContentView(ll,new LayoutParams(WindowManager.LayoutParams.MATCH_PARENT,WindowManager.LayoutParams.WRAP_CONTENT));
  dialog.setCanceledOnTouchOutside(true);
  dialog.getWindow().setAttributes(lp);
  if (maxHeight != -1) {
    ll.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener(){
      boolean wrap=true;
      @Override public void onGlobalLayout(){
        if (ll.getHeight() > maxHeight) {
          dialog.setContentView(ll,new LayoutParams(WindowManager.LayoutParams.MATCH_PARENT,maxHeight));
          wrap=false;
        }
 else         if (ll.getHeight() < maxHeight && !wrap) {
          dialog.setContentView(ll,new LayoutParams(WindowManager.LayoutParams.MATCH_PARENT,ll.getHeight()));
          wrap=true;
        }
      }
    }
);
  }
  return dialog;
}
