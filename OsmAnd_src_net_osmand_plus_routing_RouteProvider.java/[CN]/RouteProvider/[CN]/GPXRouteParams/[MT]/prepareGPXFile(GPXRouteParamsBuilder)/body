{
  GPXFile file=builder.file;
  boolean reverse=builder.reverse;
  boolean announceWaypoints=builder.announceWaypoints;
  if (file.isCloudmadeRouteFile() || OSMAND_ROUTER.equals(file.author)) {
    directions=parseOsmAndGPXRoute(points,file,OSMAND_ROUTER.equals(file.author),builder.leftSide,10);
    if (reverse) {
      directions=null;
      Collections.reverse(points);
    }
  }
 else {
    for (    Track tr : file.tracks) {
      for (      TrkSegment tkSeg : tr.segments) {
        for (        WptPt pt : tkSeg.points) {
          points.add(createLocation(pt));
        }
      }
    }
    if (points.isEmpty()) {
      for (      Route rte : file.routes) {
        for (        WptPt pt : rte.points) {
          points.add(createLocation(pt));
        }
      }
    }
    if (reverse) {
      Collections.reverse(points);
    }
  }
  wpt=null;
  if (announceWaypoints && !file.points.isEmpty()) {
    wpt=new DataTileManager<WptPt>(17);
    for (    WptPt w : file.points) {
      wpt.registerObjectXY(MapUtils.get31TileNumberX(w.lon),MapUtils.get31TileNumberY(w.lat),w);
    }
  }
  return this;
}
