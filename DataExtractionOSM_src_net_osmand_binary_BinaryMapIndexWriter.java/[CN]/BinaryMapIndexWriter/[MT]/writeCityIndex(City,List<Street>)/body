{
  if (city.getType() == City.CityType.CITY || city.getType() == City.CityType.TOWN) {
    checkPeekState(CITY_INDEX_INIT);
  }
 else {
    checkPeekState(VILLAGES_INDEX_INIT);
  }
  CityIndex.Builder cityInd=OsmandOdb.CityIndex.newBuilder();
  cityInd.setCityType(city.getType().ordinal());
  cityInd.setId(city.getId());
  cityInd.setName(city.getName());
  if (checkEnNameToWrite(city)) {
    cityInd.setNameEn(city.getEnName());
  }
  cityInd.setX(MapUtils.get31TileNumberX(city.getLocation().getLongitude()));
  cityInd.setY(MapUtils.get31TileNumberY(city.getLocation().getLatitude()));
  for (  Street s : streets) {
    StreetIndex streetInd=createStreetAndBuildings(s,city.getLocation(),null);
    cityInd.addStreets(streetInd);
  }
  codedOutStream.writeMessage(OsmandOdb.CitiesIndex.CITIES_FIELD_NUMBER,cityInd.build());
}
