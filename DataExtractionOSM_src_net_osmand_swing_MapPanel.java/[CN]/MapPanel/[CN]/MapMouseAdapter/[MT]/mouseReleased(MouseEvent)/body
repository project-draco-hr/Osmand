{
  if (e.getButton() == MouseEvent.BUTTON3) {
    if (startDragging != null) {
      dragTo(e.getPoint());
      fireMapLocationListeners();
      startDragging=null;
    }
  }
  if (e.getButton() == MouseEvent.BUTTON1) {
    if (startSelecting != null) {
      selectionArea.setSelectedArea(startSelecting.x,startSelecting.y,e.getPoint().x,e.getPoint().y);
      startSelecting=null;
    }
  }
  if (willBePopupShown && (e.isPopupTrigger() || e.getButton() == MouseEvent.BUTTON3)) {
    popupMenuPoint=new Point(e.getX(),e.getY());
    popupMenu.show(MapPanel.this,e.getX(),e.getY());
    willBePopupShown=false;
  }
  super.mouseReleased(e);
}
