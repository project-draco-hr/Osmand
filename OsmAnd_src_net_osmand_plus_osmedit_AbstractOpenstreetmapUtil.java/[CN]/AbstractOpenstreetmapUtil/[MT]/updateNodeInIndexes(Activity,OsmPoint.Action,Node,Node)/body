{
  final OsmandApplication app=(OsmandApplication)ctx.getApplication();
  final AmenityIndexRepositoryOdb repo=app.getResourceManager().getUpdatablePoiDb();
  showMessageAfterCommit(ctx,app,repo);
  if (repo == null) {
    return;
  }
  if (oldNode != n) {
    repo.deleteAmenities(oldNode.getId() << 1);
    repo.clearCache();
  }
  if (OsmPoint.Action.DELETE == action || OsmPoint.Action.MODIFY == action) {
    repo.deleteAmenities(n.getId() << 1);
    repo.clearCache();
  }
  if (OsmPoint.Action.DELETE != action) {
    List<Amenity> ams=EntityParser.parseAmenities(MapRenderingTypes.getDefault(),n,new ArrayList<Amenity>());
    for (    Amenity a : ams) {
      repo.addAmenity(a);
      repo.clearCache();
    }
  }
}
