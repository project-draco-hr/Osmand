{
  String text=null;
  if (routingHelper != null && routingHelper.isRouteCalculated()) {
    if (routingHelper.isFollowingMode()) {
      text=routingHelper.getCurrentName();
    }
 else {
      int di=MapRouteInfoControl.getDirectionInfo();
      if (di >= 0 && MapRouteInfoControl.isControlVisible() && di < routingHelper.getRouteDirections().size()) {
        RouteDirectionInfo next=routingHelper.getRouteDirections().get(di);
        text="\u2566 " + RoutingHelper.formatStreetName(next.getStreetName(),next.getRef(),next.getDestinationName());
      }
    }
  }
 else   if (map.getMapViewTrackingUtilities().isMapLinkedToLocation()) {
    RouteDataObject rt=locationProvider.getLastKnownRouteSegment();
    if (rt != null) {
      text=RoutingHelper.formatStreetName(rt.getName(),rt.getRef(),rt.getDestinationName());
    }
  }
  if (text == null) {
    text="";
  }
  if (!text.equals(getText().toString())) {
    TextPaint pp=new TextPaint(getPaint());
    if (!text.equals("")) {
      pp.setTextSize(20 * scaleCoefficient);
      float ts=pp.measureText(text);
      int wth=getWidth();
      while (ts > wth && pp.getTextSize() > (16 * scaleCoefficient)) {
        pp.setTextSize(pp.getTextSize() - 1);
        ts=pp.measureText(text);
      }
      boolean dots=false;
      while (ts > wth) {
        dots=true;
        ts=pp.measureText(text);
        text=text.substring(0,text.length() - 2);
      }
      if (dots) {
        text+="..";
      }
      setTextSize(TypedValue.COMPLEX_UNIT_PX,pp.getTextSize());
      setContentDescription(text);
    }
 else {
      setTextSize(TypedValue.COMPLEX_UNIT_PX,7);
      setContentDescription(getResources().getString(R.string.map_widget_top_text));
    }
    setText(text);
    invalidate();
    return true;
  }
  return false;
}
