{
  final OsmandMapTileView view=map.getMapView();
  final Drawable compass=map.getResources().getDrawable(R.drawable.map_compass);
  final Drawable compassWhite=map.getResources().getDrawable(R.drawable.map_compass_white);
  final int mw=(int)compass.getMinimumWidth();
  final int mh=(int)compass.getMinimumHeight();
  ImageViewWidget compassView=new ImageViewWidget(map){
    private float cachedRotate=0;
    private boolean nm;
    @Override protected void onDraw(    Canvas canvas){
      canvas.save();
      canvas.rotate(view.getRotate(),mw / 2,mh / 2);
      getDrawable().draw(canvas);
      canvas.restore();
    }
    @Override public boolean updateInfo(    DrawSettings drawSettings){
      boolean nightMode=drawSettings != null && drawSettings.isNightMode();
      if (nightMode != this.nm) {
        this.nm=nightMode;
        setImageDrawable(nightMode ? compassWhite : compass);
        return true;
      }
      if (view.getRotate() != cachedRotate) {
        cachedRotate=view.getRotate();
        invalidate();
        return true;
      }
      return false;
    }
  }
;
  compassView.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      map.getMapViewTrackingUtilities().switchRotateMapMode();
    }
  }
);
  compassView.setImageDrawable(compass);
  return compassView;
}
