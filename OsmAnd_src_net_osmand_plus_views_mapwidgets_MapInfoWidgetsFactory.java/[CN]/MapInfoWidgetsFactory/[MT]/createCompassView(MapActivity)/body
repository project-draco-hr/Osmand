{
  final OsmandMapTileView view=map.getMapView();
  final Drawable compass=map.getResources().getDrawable(R.drawable.list_activities_compass);
  final Drawable compassWhite=map.getResources().getDrawable(R.drawable.list_activities_compass_white);
  final int mw=(int)compass.getMinimumWidth();
  final int mh=(int)compass.getMinimumHeight();
  ImageViewWidget compassView=new ImageViewWidget(map){
    Drawable d=compass;
    private float cachedRotate=0;
    @Override protected void onDraw(    Canvas canvas){
      canvas.save();
      canvas.rotate(view.getRotate(),mw / 2,mh / 2);
      d.draw(canvas);
      canvas.restore();
    }
    @Override public boolean updateInfo(    DrawSettings drawSettings){
      d=drawSettings != null && drawSettings.isNightMode() ? compassWhite : compass;
      if (view.getRotate() != cachedRotate) {
        cachedRotate=view.getRotate();
        invalidate();
        return true;
      }
      return false;
    }
  }
;
  compassView.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      map.getMapViewTrackingUtilities().switchRotateMapMode();
    }
  }
);
  compassView.setImageDrawable(compass);
  return compassView;
}
