{
  if (poiIndex == null) {
    File file=new File(Environment.getExternalStorageDirectory(),POI_PATH);
    poiIndex=new DataTileManager<Amenity>();
    if (file.exists() && file.canRead()) {
      for (      File f : file.listFiles()) {
        if (f.getName().endsWith(".bz2") || f.getName().endsWith(".osm")) {
          if (log.isDebugEnabled()) {
            log.debug("Starting index POI " + f.getAbsolutePath());
          }
          boolean zipped=f.getName().endsWith(".bz2");
          InputStream stream=null;
          try {
            OsmBaseStorage storage=new OsmBaseStorage();
            stream=new FileInputStream(f);
            stream=new BufferedInputStream(stream);
            if (zipped) {
              if (stream.read() != 'B' || stream.read() != 'Z') {
                log.error("Can't read poi file " + f.getAbsolutePath() + "The source stream must start with the characters BZ if it is to be read as a BZip2 stream.");
                continue;
              }
 else {
                stream=new CBZip2InputStream(stream);
              }
            }
            if (progress != null) {
              progress.startTask("Indexing poi " + f.getName(),stream.available());
            }
            storage.parseOSM(stream,progress);
            for (            Entity e : storage.getRegisteredEntities().values()) {
              if (e instanceof Node && Amenity.isAmenity((Node)e)) {
                poiIndex.registerObject(((Node)e).getLatitude(),((Node)e).getLongitude(),new Amenity((Node)e));
              }
            }
            if (log.isDebugEnabled()) {
              log.debug("Finishing index POI " + f.getAbsolutePath());
            }
          }
 catch (          IOException e) {
            log.error("Can't read poi file " + f.getAbsolutePath(),e);
          }
catch (          SAXException e) {
            log.error("Can't read poi file " + f.getAbsolutePath(),e);
          }
 finally {
            Algoritms.closeStream(stream);
          }
        }
      }
    }
  }
}
