{
  if (tileId == null) {
    tileId=calculateTileId(map,x,y,zoom);
    if (tileId == null) {
      return null;
    }
  }
  if (deleteBefore) {
    cacheOfImages.remove(tileId);
    if (map instanceof SQLiteTileSource) {
      ((SQLiteTileSource)map).deleteImage(x,y,zoom);
    }
 else {
      File f=new File(dirWithTiles,tileId);
      if (f.exists()) {
        f.delete();
      }
    }
    imagesOnFS.put(tileId,null);
  }
  if (loadFromFs && cacheOfImages.get(tileId) == null) {
    if (!loadFromInternetIfNeeded && !tileExistOnFileSystem(tileId,map,x,y,zoom)) {
      return null;
    }
    String url=loadFromInternetIfNeeded ? map.getUrlToLoad(x,y,zoom) : null;
    File toSave=null;
    if (url != null) {
      if (map instanceof SQLiteTileSource) {
        ITileSource base=((SQLiteTileSource)map).getBase();
        toSave=new File(dirWithTiles,calculateTileId(base,x,y,zoom));
      }
 else {
        toSave=new File(dirWithTiles,tileId);
      }
    }
    TileLoadDownloadRequest req=new TileLoadDownloadRequest(dirWithTiles,url,toSave,tileId,map,x,y,zoom);
    if (sync) {
      return getRequestedImageTile(req);
    }
 else {
      asyncLoadingTiles.requestToLoadImage(req);
    }
  }
  return cacheOfImages.get(tileId);
}
