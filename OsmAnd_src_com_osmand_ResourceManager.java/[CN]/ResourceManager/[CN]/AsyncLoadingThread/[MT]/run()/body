{
  while (true) {
    try {
      boolean update=false;
      boolean amenityLoaded=false;
      boolean transportLoaded=false;
      boolean mapLoaded=false;
      while (!requests.isEmpty()) {
        Object req=requests.pop();
        if (req instanceof TileLoadDownloadRequest) {
          TileLoadDownloadRequest r=(TileLoadDownloadRequest)req;
          if (cacheOfImages.get(r.tileId) == null) {
            update|=getRequestedImageTile(r) != null;
          }
        }
 else         if (req instanceof AmenityLoadRequest) {
          if (!amenityLoaded) {
            AmenityLoadRequest r=(AmenityLoadRequest)req;
            r.repository.evaluateCachedAmenities(r.topLatitude,r.leftLongitude,r.bottomLatitude,r.rightLongitude,r.zoom,POIMapLayer.LIMIT_POI,r.filter,null);
            amenityLoaded=true;
          }
        }
 else         if (req instanceof TransportLoadRequest) {
          if (!transportLoaded) {
            TransportLoadRequest r=(TransportLoadRequest)req;
            r.repository.evaluateCachedTransportStops(r.topLatitude,r.leftLongitude,r.bottomLatitude,r.rightLongitude,r.zoom,LIMIT_TRANSPORT,null);
            transportLoaded=true;
          }
        }
 else         if (req instanceof MapLoadRequest) {
          if (!mapLoaded) {
            MapLoadRequest r=(MapLoadRequest)req;
            renderer.loadMap(r.topLatitude,r.leftLongitude,r.bottomLatitude,r.rightLongitude,r.zoom);
          }
        }
      }
      if (update || amenityLoaded || transportLoaded|| mapLoaded) {
        for (        IMapDownloaderCallback c : downloader.getDownloaderCallbacks()) {
          c.tileDownloaded(null);
        }
      }
      sleep(750);
    }
 catch (    InterruptedException e) {
      log.error(e,e);
    }
catch (    RuntimeException e) {
      log.error(e,e);
    }
  }
}
