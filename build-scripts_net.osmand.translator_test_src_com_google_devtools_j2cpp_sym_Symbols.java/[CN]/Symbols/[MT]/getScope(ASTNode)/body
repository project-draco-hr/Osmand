{
  ASTNode n=node;
  while (n != null) {
    Scope scope=instance.scopeTable.get(n);
    if (scope != null) {
      return scope;
    }
    n=n.getParent();
  }
  throw new AssertionError("could not find scope for " + node);
}
