{
  FileInputStream fis=new FileInputStream(new File(pathToRoutes));
  BufferedReader reader=new BufferedReader(new InputStreamReader(fis,Charset.forName("UTF-8")));
  List<TransportRoute> routes=readRoutes(reader);
  fis=new FileInputStream(new File(pathToStops));
  reader=new BufferedReader(new InputStreamReader(fis,Charset.forName("UTF-8")));
  List<TransportStop> stops=readStopes(reader);
  Map<String,TransportStop> stopsMap=new LinkedHashMap<String,TransportStop>();
  for (  TransportStop s : stops) {
    stopsMap.put(s.stopId,s);
  }
  for (  TransportRoute r : routes) {
    for (    String string : r.routeStops) {
      if (!stopsMap.containsKey(string)) {
        throw new IllegalArgumentException("Check stop " + string + " of route "+ r.routeName);
      }
    }
  }
  OsmBaseStorage storage=filterBusStops(stopsMap,routes);
  OsmStorageWriter writer=new OsmStorageWriter();
  writer.saveStorage(new FileOutputStream(pathToSave),storage,null,true);
}
