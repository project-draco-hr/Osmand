{
  application=(OsmandApplication)view.getContext().getApplicationContext();
  this.view=view;
  paintGrayFill=new Paint();
  paintGrayFill.setColor(Color.GRAY);
  paintGrayFill.setStyle(Style.FILL);
  paintGrayFill.setAntiAlias(true);
  paintBlackFill=new Paint();
  paintBlackFill.setColor(Color.BLACK);
  paintBlackFill.setStyle(Style.FILL);
  paintBlackFill.setAntiAlias(true);
  paintWhiteFill=new Paint();
  paintWhiteFill.setColor(Color.WHITE);
  paintWhiteFill.setStyle(Style.FILL);
  paintWhiteFill.setAntiAlias(true);
  paintCenter=new Paint();
  paintCenter.setStyle(Style.STROKE);
  paintCenter.setColor(Color.rgb(60,60,60));
  paintCenter.setStrokeWidth(2);
  paintCenter.setAntiAlias(true);
  paintImg=new Paint();
  paintImg.setFilterBitmap(true);
  view.setClickable(true);
  view.setLongClickable(true);
  view.setFocusable(true);
  handler=new Handler();
  baseHandler=new Handler(application.getResourceManager().getRenderingBufferImageThread().getLooper());
  animatedDraggingThread=new AnimateDraggingMapThread(this);
  gestureDetector=new GestureDetector(view.getContext(),new MapExplorer(this,new MapTileViewOnGestureListener()));
  multiTouchSupport=new MultiTouchSupport(view.getContext(),new MapTileViewMultiTouchZoomListener());
  gestureDetector.setOnDoubleTapListener(new MapTileViewOnDoubleTapListener());
  WindowManager mgr=(WindowManager)view.getContext().getSystemService(Context.WINDOW_SERVICE);
  dm=new DisplayMetrics();
  mgr.getDefaultDisplay().getMetrics(dm);
  currentViewport=new RotatedTileBox.RotatedTileBoxBuilder().setLocation(0,0).setZoom(3).setPixelDimensions(view.getWidth(),view.getHeight()).build();
  currentViewport.setDensity(dm.density);
  currentViewport.setMapDensity(getSettingsMapDensity());
}
