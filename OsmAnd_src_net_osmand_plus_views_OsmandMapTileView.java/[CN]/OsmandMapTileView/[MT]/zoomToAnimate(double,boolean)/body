{
  int zoom=getZoom();
  double zoomToAnimate=tzoom - zoom - getZoomScale();
  if (zoomToAnimate >= 1) {
    zoom+=(int)zoomToAnimate;
    zoomToAnimate-=(int)zoomToAnimate;
  }
  while (zoomToAnimate < 0) {
    zoom--;
    zoomToAnimate+=1;
  }
  if (mainLayer != null && mainLayer.getMaximumShownMapZoom() >= zoom && mainLayer.getMinimumShownMapZoom() <= zoom) {
    currentViewport.setZoomAndAnimation(zoom,zoomToAnimate);
    currentViewport.setRotate(zoom > LOWEST_ZOOM_TO_ROTATE ? rotate : 0);
    refreshMap();
    if (notify && locationListener != null) {
      locationListener.locationChanged(getLatitude(),getLongitude(),this);
    }
  }
}
