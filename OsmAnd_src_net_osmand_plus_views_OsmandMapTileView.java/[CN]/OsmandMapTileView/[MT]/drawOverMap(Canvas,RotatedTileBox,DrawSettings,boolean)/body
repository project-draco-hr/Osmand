{
  final QuadPoint c=tileBox.getCenterPixelPoint();
  for (int i=0; i < layers.size(); i++) {
    try {
      OsmandMapLayer layer=layers.get(i);
      canvas.save();
      if (!layer.drawInScreenPixels()) {
        canvas.rotate(tileBox.getRotate(),c.x,c.y);
      }
      if (onPrepareImage) {
        layer.onPrepareBufferImage(canvas,tileBox,drawSettings);
      }
 else {
        layer.onDraw(canvas,tileBox,drawSettings);
      }
      canvas.restore();
    }
 catch (    IndexOutOfBoundsException e) {
    }
  }
  if (showMapPosition && !onPrepareImage) {
    canvas.drawCircle(c.x,c.y,3 * dm.density,paintCenter);
    canvas.drawCircle(c.x,c.y,7 * dm.density,paintCenter);
  }
}
