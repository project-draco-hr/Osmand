{
  if (TextUtils.isEmpty(poiTypeEditText.getText())) {
    poiTypeEditText.setError(getResources().getString(R.string.please_specify_poi_type));
    return;
  }
  OsmPoint.Action action=node.getId() == -1 ? OsmPoint.Action.CREATE : OsmPoint.Action.MODIFY;
  for (  Map.Entry<String,String> tag : editPoiData.getTagValues().entrySet()) {
    if (tag.getKey().equals(EditPoiData.POI_TYPE_TAG)) {
      final PoiType poiType=allTranslatedSubTypes.get(tag.getValue().trim().toLowerCase());
      if (poiType != null) {
        node.putTag(poiType.getOsmTag(),poiType.getOsmValue());
        if (poiType.getOsmTag2() != null) {
          node.putTag(poiType.getOsmTag2(),poiType.getOsmValue2());
        }
      }
 else {
        node.putTag(editPoiData.amenity.getType().getDefaultTag(),tag.getValue());
      }
    }
 else {
      if (tag.getKey().length() > 0) {
        node.putTag(tag.getKey(),tag.getValue());
      }
 else {
        node.removeTag(tag.getKey());
      }
    }
  }
  commitNode(action,node,mOpenstreetmapUtil.getEntityInfo(),"",false,new Runnable(){
    @Override public void run(){
      if (isLocalEdit) {
        AccessibleToast.makeText(getActivity(),R.string.osm_changes_added_to_local_edits,Toast.LENGTH_LONG).show();
      }
 else {
        final String message=node.getId() == -1 ? getResources().getString(R.string.poi_action_add) : getResources().getString(R.string.poi_action_change);
        AccessibleToast.makeText(getActivity(),MessageFormat.format(getResources().getString(R.string.poi_action_succeded_template),message),Toast.LENGTH_LONG).show();
      }
      if (getActivity() instanceof MapActivity) {
        ((MapActivity)getActivity()).getMapView().refreshMap(true);
      }
      dismiss();
    }
  }
,getActivity(),mOpenstreetmapUtil);
}
