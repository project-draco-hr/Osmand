{
  if (request == null) {
    refreshMap();
    return;
  }
  if (request.zoom != this.zoom) {
    return;
  }
  float w=getCenterPointX();
  float h=getCenterPointY();
  float tileX=getXTile();
  float tileY=getYTile();
  SurfaceHolder holder=getHolder();
synchronized (holder) {
    tilesRect.set(request.xTile,request.yTile,request.xTile + 1,request.yTile + 1);
    calculatePixelRectangle(boundsRect,w,h,tileX,tileY,tilesRect);
    if (boundsRect.left > getWidth() || boundsRect.right < 0 || boundsRect.bottom < 0 || boundsRect.top > getHeight()) {
      return;
    }
    Canvas canvas=holder.lockCanvas(boundsRect);
    if (canvas != null) {
      canvas.rotate(rotate,w,h);
      try {
        ResourceManager mgr=ResourceManager.getResourceManager();
        Bitmap bmp=mgr.getTileImageForMapSync(map,request.xTile,request.yTile,zoom,false);
        float x=(request.xTile - getXTile()) * getTileSize() + w;
        float y=(request.yTile - getYTile()) * getTileSize() + h;
        if (bmp == null) {
          drawEmptyTile(canvas,x,y);
        }
 else {
          canvas.drawBitmap(bmp,x,y,null);
        }
        drawOverMap(canvas);
      }
  finally {
        holder.unlockCanvasAndPost(canvas);
      }
    }
  }
}
