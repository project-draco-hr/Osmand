{
  if (event.getAction() == MotionEvent.ACTION_DOWN) {
    animatedDraggingThread.stopDragging();
    if (startDragging == null) {
      autoStartDragging=new PointF(event.getX(),event.getY());
      autoStartDraggingTime=event.getEventTime();
      startDragging=new PointF(event.getX(),event.getY());
      wasMapDraggedOnTouch=false;
    }
    return super.onTouchEvent(event);
  }
 else   if (event.getAction() == MotionEvent.ACTION_UP) {
    if (startDragging != null) {
      if (wasMapDraggedOnTouch || !isDifferenceSmallToDrag(startDragging,event)) {
        dragTo(startDragging.x,startDragging.y,event.getX(),event.getY());
        startDragging=null;
        if (wasMapDraggingAccelerated(event)) {
          float timeDist=(int)(event.getEventTime() - autoStartDraggingTime);
          if (timeDist < 20) {
            timeDist=20;
          }
          animatedDraggingThread.startDragging(timeDist,autoStartDragging.x,autoStartDragging.y,event.getX(),event.getY());
        }
      }
 else {
        return super.onTouchEvent(event);
      }
    }
  }
 else   if (event.getAction() == MotionEvent.ACTION_MOVE) {
    if (startDragging != null && !isDifferenceSmallToDrag(startDragging,event)) {
      if (wasMapDraggedOnTouch || !isDifferenceSmallToDrag(startDragging,event)) {
        if (!wasMapDraggedOnTouch) {
          cancelLongPress();
          wasMapDraggedOnTouch=true;
        }
        dragTo(startDragging.x,startDragging.y,event.getX(),event.getY());
        startDragging.x=event.getX();
        startDragging.y=event.getY();
        if (event.getEventTime() - autoStartDraggingTime > timeForDraggingAnimation) {
          autoStartDraggingTime=event.getEventTime();
          autoStartDragging.x=event.getX();
          autoStartDragging.y=event.getY();
        }
      }
    }
  }
  return true;
}
