{
  while (true) {
    try {
      boolean update=false;
      while (!requests.isEmpty()) {
        String f=requests.keySet().iterator().next();
        DownloadRequest r=requests.remove(f);
        getImageForTile(r.xTile,r.yTile,r.zoom,OsmandSettings.useInternetToDownloadTiles);
        update=true;
      }
      if (update) {
        prepareImage();
      }
      sleep(350);
    }
 catch (    InterruptedException e) {
      log.error(e);
    }
catch (    RuntimeException e) {
      log.error(e);
    }
  }
}
