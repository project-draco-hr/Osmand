{
  BinaryRoutePlanner planner=new BinaryRoutePlanner(regions);
  RoutingContext ctx=new RoutingContext();
  String vehicle=testCase.getAttribute("vehicle");
  String testDescription=testCase.getAttribute("description");
  String skip=testCase.getAttribute("skip_comment");
  if (skip != null && skip.length() > 0) {
    System.err.println("\n\n!! Skipped test case '" + testDescription + "' because '"+ skip+ "'\n\n");
    return;
  }
  if ("bicycle".equals(vehicle)) {
    ctx.setRouter(new BicycleRouter());
  }
 else   if ("pedestrian".equals(vehicle)) {
    ctx.setRouter(new PedestrianRouter());
  }
 else {
    ctx.setRouter(new CarRouter());
  }
  double startLat=Double.parseDouble(testCase.getAttribute("start_lat"));
  double startLon=Double.parseDouble(testCase.getAttribute("start_lon"));
  RouteSegment startSegment=planner.findRouteSegment(startLat,startLon,ctx);
  double endLat=Double.parseDouble(testCase.getAttribute("target_lat"));
  double endLon=Double.parseDouble(testCase.getAttribute("target_lon"));
  RouteSegment endSegment=planner.findRouteSegment(endLat,endLon,ctx);
  if (startSegment == null) {
    throw new IllegalArgumentException("Start segment is not found for test : " + testDescription);
  }
  if (endSegment == null) {
    throw new IllegalArgumentException("End segment is not found for test : " + testDescription);
  }
  List<RouteSegmentResult> route=planner.searchRoute(ctx,startSegment,endSegment);
  NodeList segments=testCase.getElementsByTagName("segment");
  int i=0;
  while (i < segments.getLength() && i < route.size()) {
    Element segment=(Element)segments.item(i);
    long expectedId=Long.parseLong(segment.getAttribute("id"));
    int expectedStart=Integer.parseInt(segment.getAttribute("start"));
    int expectedEnd=Integer.parseInt(segment.getAttribute("end"));
    RouteSegmentResult segmentResult=route.get(i);
    if (expectedId != segmentResult.object.getId() >> 1) {
      throw new IllegalArgumentException("Test : '" + testDescription + "' on segment "+ (i + 1)+ " : "+ "\n"+ "(expected route id) "+ expectedId+ " != "+ (segmentResult.object.getId() >> 1)+ " (actual route id)");
    }
    if (expectedStart != segmentResult.startPointIndex) {
      throw new IllegalArgumentException("Test : '" + testDescription + "' on segment "+ (i + 1)+ " : "+ "\n"+ "(expected start index) "+ expectedStart+ " != "+ segmentResult.startPointIndex+ " (actual start index)");
    }
    if (expectedEnd != segmentResult.endPointIndex) {
      throw new IllegalArgumentException("Test : '" + testDescription + "' on segment "+ (i + 1)+ " : "+ "\n"+ "(expected end index) "+ expectedEnd+ " != "+ segmentResult.endPointIndex+ " (actual end index)");
    }
    i++;
  }
  if (segments.getLength() < route.size()) {
    throw new IllegalArgumentException("Expected route is shorter than calculated for test : " + testDescription);
  }
 else   if (segments.getLength() > route.size()) {
    throw new IllegalArgumentException("Expected route is more lengthy than calculated for test : " + testDescription);
  }
}
