{
  if (Log.isLoggable(LogUtil.TAG,Log.DEBUG)) {
    Log.d(LogUtil.TAG,"Location changed " + location.getProvider());
  }
  if (location != null && settings.SAVE_TRACK_TO_GPX.get()) {
    savingTrackHelper.insertData(location.getLatitude(),location.getLongitude(),location.getAltitude(),location.getSpeed(),location.getTime(),settings);
  }
  registerUnregisterSensor(location);
  updateSpeedBearing(location);
  mapLayers.getLocationLayer().setLastKnownLocation(location);
  if (routingHelper.isFollowingMode()) {
    routingHelper.setCurrentLocation(location);
  }
  if (location != null) {
    if (isMapLinkedToLocation()) {
      if (settings.AUTO_ZOOM_MAP.get() && location.hasSpeed()) {
        int z=defineZoomFromSpeed(location.getSpeed(),mapView.getZoom());
        if (mapView.getZoom() != z && !mapView.mapIsAnimating()) {
          long now=System.currentTimeMillis();
          if (Math.abs(mapView.getZoom() - z) > 1 || (lastTimeAutoZooming - now) > 6500) {
            lastTimeAutoZooming=now;
            mapView.setZoom(z);
          }
        }
      }
      int currentMapRotation=settings.ROTATE_MAP.get();
      if (location.hasBearing() && currentMapRotation == OsmandSettings.ROTATE_MAP_BEARING) {
        mapView.setRotate(-location.getBearing());
      }
      mapView.setLatLon(location.getLatitude(),location.getLongitude());
    }
 else {
      if (backToLocation.getVisibility() != View.VISIBLE) {
        backToLocation.setVisibility(View.VISIBLE);
      }
    }
  }
 else {
    if (backToLocation.getVisibility() != View.INVISIBLE) {
      backToLocation.setVisibility(View.INVISIBLE);
    }
  }
  mapView.refreshMap();
}
