{
  boolean currentShowingAngle=settings.SHOW_VIEW_ANGLE.get();
  int currentMapRotation=settings.ROTATE_MAP.get();
  boolean show=overruleRegister || (currentShowingAngle && location != null) || currentMapRotation == OsmandSettings.ROTATE_MAP_COMPASS;
  if (sensorRegistered && !show) {
    Log.d(PlatformUtil.TAG,"Disable sensor");
    ((SensorManager)getSystemService(SENSOR_SERVICE)).unregisterListener(this);
    sensorRegistered=false;
    previousSensorValue=0;
    mapLayers.getLocationLayer().setHeading(null);
  }
 else   if (!sensorRegistered && show) {
    Log.d(PlatformUtil.TAG,"Enable sensor");
    SensorManager sensorMgr=(SensorManager)getSystemService(SENSOR_SERVICE);
    Sensor s=sensorMgr.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);
    if (s == null || !sensorMgr.registerListener(this,s,SensorManager.SENSOR_DELAY_UI)) {
      Log.e(PlatformUtil.TAG,"Sensor accelerometer could not be enabled");
    }
    s=sensorMgr.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD);
    if (s == null || !sensorMgr.registerListener(this,s,SensorManager.SENSOR_DELAY_UI)) {
      Log.e(PlatformUtil.TAG,"Sensor magnetic field could not be enabled");
    }
    sensorRegistered=true;
  }
}
