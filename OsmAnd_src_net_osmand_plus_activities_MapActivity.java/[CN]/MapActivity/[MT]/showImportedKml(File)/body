{
  new AsyncTask<Void,Void,GPXFile>(){
    ProgressDialog progress=null;
    @Override protected void onPreExecute(){
      progress=ProgressDialog.show(MapActivity.this,getString(R.string.loading),getString(R.string.loading_data));
    }
    @Override protected GPXFile doInBackground(    Void... nothing){
      final String result=Kml2Gpx.toGpx(kmlFile);
      if (result == null) {
        return null;
      }
      try {
        return GPXUtilities.loadGPXFile(getMyApplication(),new ByteArrayInputStream(result.getBytes("UTF-8")));
      }
 catch (      UnsupportedEncodingException e) {
        return null;
      }
    }
    @Override protected void onPostExecute(    GPXFile result){
      progress.dismiss();
      if (result != null) {
        if (result.warning != null) {
          AccessibleToast.makeText(MapActivity.this,result.warning,Toast.LENGTH_LONG).show();
        }
 else {
          getMyApplication().setGpxFileToDisplay(result,true);
          final WptPt moveTo=result.findPointToShow();
          if (moveTo != null) {
            mapView.getAnimatedDraggingThread().startMoving(moveTo.lat,moveTo.lon,mapView.getZoom(),true);
          }
          mapView.refreshMap();
        }
      }
    }
  }
.execute();
}
