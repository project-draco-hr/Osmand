{
  if (settings.ROTATE_MAP.get() != OsmandSettings.ROTATE_MAP_COMPASS) {
    previousMapRotate=settings.ROTATE_MAP.get();
    settings.ROTATE_MAP.set(OsmandSettings.ROTATE_MAP_COMPASS);
  }
 else   if (previousMapRotate != null) {
    settings.ROTATE_MAP.set(previousMapRotate);
  }
 else {
    settings.ROTATE_MAP.set(settings.ROTATE_MAP.getProfileDefaultValue());
  }
  registerUnregisterSensor(getLastKnownLocation());
  if (settings.ROTATE_MAP.get() != OsmandSettings.ROTATE_MAP_COMPASS) {
    mapView.setRotate(0);
  }
  mapView.refreshMap();
}
