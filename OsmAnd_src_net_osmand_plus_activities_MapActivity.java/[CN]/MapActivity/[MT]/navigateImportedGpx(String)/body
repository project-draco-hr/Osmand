{
  final CallbackWithObject<GPXFile> callback=new CallbackWithObject<GPXUtilities.GPXFile>(){
    @Override public boolean processResult(    GPXFile result){
      getMyApplication().setGpxFileToDisplay(result,true);
      getMapActions().setGPXRouteParams(result);
      getMyApplication().getTargetPointsHelper().updateRoutingHelper();
      getRoutingHelper().recalculateRouteDueToSettingsChange();
      return true;
    }
  }
;
  final ProgressDialog dlg=ProgressDialog.show(this,getString(R.string.loading),getString(R.string.loading_data));
  new Thread(new Runnable(){
    @Override public void run(){
      final GPXFile res=GPXUtilities.loadGPXFile(getApplication(),new File(gpxFile));
      dlg.dismiss();
      if (res != null) {
        MapActivity.this.runOnUiThread(new Runnable(){
          @Override public void run(){
            if (res.warning != null) {
              AccessibleToast.makeText(MapActivity.this,res.warning,Toast.LENGTH_LONG).show();
            }
 else {
              callback.processResult(res);
            }
          }
        }
);
      }
    }
  }
,"Loading gpx").start();
}
