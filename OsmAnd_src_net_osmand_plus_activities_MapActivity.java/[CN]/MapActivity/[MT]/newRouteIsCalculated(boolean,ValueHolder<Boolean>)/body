{
  RoutingHelper rh=app.getRoutingHelper();
  if (newRoute && rh.isRoutePlanningMode() && mapView != null) {
    RotatedTileBox rt=mapView.getCurrentRotatedTileBox();
    Location lt=rh.getLastProjection();
    if (lt == null) {
      lt=app.getTargetPointsHelper().getPointToStartLocation();
    }
    if (lt != null) {
      double left=lt.getLongitude(), right=lt.getLongitude();
      double top=lt.getLatitude(), bottom=lt.getLatitude();
      List<TargetPoint> list=app.getTargetPointsHelper().getIntermediatePointsWithTarget();
      for (      TargetPoint l : list) {
        left=Math.min(left,l.getLongitude());
        right=Math.max(right,l.getLongitude());
        top=Math.max(top,l.getLatitude());
        bottom=Math.min(bottom,l.getLatitude());
      }
      RotatedTileBox tb=new RotatedTileBox(rt);
      double border=0.8;
      int dy=0;
      MapRouteInfoMenu routeInfoMenu=mapLayers.getMapControlsLayer().getMapRouteInfoMenu();
      boolean routeMenuVisible=false;
      int tbw=(int)(tb.getPixWidth() * border);
      int tbh=(int)(tb.getPixHeight() * border);
      WeakReference<MapRouteInfoMenuFragment> fragmentRef=routeInfoMenu.findMenuFragment();
      if (fragmentRef != null) {
        routeMenuVisible=true;
        MapRouteInfoMenuFragment f=fragmentRef.get();
        if (landscapeLayout) {
          tbw=(int)((tb.getPixWidth() - f.getWidth()) * border);
        }
 else {
          tbh=(int)((tb.getPixHeight() - f.getHeight()) * border);
          dy=f.getHeight() - tbh / 2;
        }
      }
      tb.setPixelDimensions(tbw,tbh);
      double clat=bottom / 2 + top / 2;
      double clon=left / 2 + right / 2;
      tb.setLatLonCenter(clat,clon);
      while (tb.getZoom() >= 7 && (!tb.containsLatLon(top,left) || !tb.containsLatLon(bottom,right))) {
        tb.setZoom(tb.getZoom() - 1);
      }
      if (!landscapeLayout && routeMenuVisible) {
        clat=tb.getLatFromPixel(tb.getPixWidth() / 2,tb.getPixHeight() / 2 + dy);
        clon=tb.getLonFromPixel(tb.getPixWidth() / 2,tb.getPixHeight() / 2);
      }
      mapView.getAnimatedDraggingThread().startMoving(clat,clon,tb.getZoom(),true);
    }
  }
}
