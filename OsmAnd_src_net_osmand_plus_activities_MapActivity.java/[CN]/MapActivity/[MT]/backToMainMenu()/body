{
  final Dialog dlg=new Dialog(this,R.style.Dialog_Fullscreen);
  final View menuView=(View)getLayoutInflater().inflate(R.layout.menu,null);
  menuView.setBackgroundColor(Color.argb(200,150,150,150));
  dlg.setContentView(menuView);
  MainMenuActivity.onCreateMainMenu(dlg.getWindow(),this);
  Animation anim=new Animation(){
    @Override protected void applyTransformation(    float interpolatedTime,    Transformation t){
      ColorDrawable colorDraw=((ColorDrawable)menuView.getBackground());
      colorDraw.setAlpha((int)(interpolatedTime * 200));
    }
  }
;
  anim.setDuration(700);
  anim.setInterpolator(new AccelerateInterpolator());
  menuView.setAnimation(anim);
  View showMap=dlg.findViewById(R.id.MapButton);
  showMap.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      dlg.dismiss();
    }
  }
);
  View settingsButton=dlg.findViewById(R.id.SettingsButton);
  settingsButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      final Intent settings=new Intent(MapActivity.this,OsmandIntents.getSettingsActivity());
      MapActivity.this.startActivity(settings);
      dlg.dismiss();
    }
  }
);
  View favouritesButton=dlg.findViewById(R.id.FavoritesButton);
  favouritesButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      final Intent favorites=new Intent(MapActivity.this,OsmandIntents.getFavoritesActivity());
      favorites.setFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
      MapActivity.this.startActivity(favorites);
      dlg.dismiss();
    }
  }
);
  View closeButton=dlg.findViewById(R.id.CloseButton);
  closeButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      dlg.dismiss();
      getMyApplication().closeApplication();
      Intent newIntent=new Intent(MapActivity.this,OsmandIntents.getMainMenuActivity());
      newIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
      newIntent.putExtra(MainMenuActivity.APP_EXIT_KEY,MainMenuActivity.APP_EXIT_CODE);
      startActivity(newIntent);
    }
  }
);
  View searchButton=dlg.findViewById(R.id.SearchButton);
  searchButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      final Intent search=new Intent(MapActivity.this,OsmandIntents.getSearchActivity());
      LatLon loc=getMapLocation();
      search.putExtra(SearchActivity.SEARCH_LAT,loc.getLatitude());
      search.putExtra(SearchActivity.SEARCH_LON,loc.getLongitude());
      search.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
      MapActivity.this.startActivity(search);
      dlg.dismiss();
    }
  }
);
  menuView.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      dlg.dismiss();
    }
  }
);
  dlg.show();
}
