{
  boolean vectorData=OsmandSettings.isUsingMapVectorData(settings);
  OsmandApplication app=((OsmandApplication)getApplication());
  ResourceManager rm=app.getResourceManager();
  if (vectorData && !app.isApplicationInitializing()) {
    if (rm.getRenderer().isEmpty()) {
      Toast.makeText(MapActivity.this,getString(R.string.no_vector_map_loaded),Toast.LENGTH_LONG).show();
      vectorData=false;
    }
  }
  ITileSource newSource=OsmandSettings.getMapTileSource(settings);
  if (mapView.getMap() instanceof SQLiteTileSource) {
    ((SQLiteTileSource)mapView.getMap()).closeDB();
  }
  rm.updateMapSource(vectorData,newSource);
  mapView.setMap(vectorData ? null : newSource);
  ZoomControls zoomControls=(ZoomControls)findViewById(R.id.ZoomControls);
  zoomControls.setIsZoomInEnabled(mapView.getZoom() + 1 < mapView.getMaximumShownMapZoom());
  zoomControls.setIsZoomOutEnabled(mapView.getZoom() + 1 > mapView.getMinimumShownMapZoom());
  rendererLayer.setVisible(vectorData);
}
