{
  boolean vectorData=settings.isUsingMapVectorData();
  OsmandApplication app=((OsmandApplication)getApplication());
  ResourceManager rm=app.getResourceManager();
  if (vectorData && !app.isApplicationInitializing()) {
    if (rm.getRenderer().isEmpty()) {
      Toast.makeText(MapActivity.this,getString(R.string.no_vector_map_loaded),Toast.LENGTH_LONG).show();
      vectorData=false;
    }
  }
  ITileSource newSource=settings.getMapTileSource();
  ITileSource oldMap=mapTileLayer.getMap();
  if (oldMap instanceof SQLiteTileSource) {
    ((SQLiteTileSource)oldMap).closeDB();
  }
  mapTileLayer.setMap(newSource);
  mapTileLayer.setVisible(!vectorData);
  mapVectorLayer.setVisible(vectorData);
  if (vectorData) {
    mapView.setMainLayer(mapVectorLayer);
  }
 else {
    mapView.setMainLayer(mapTileLayer);
  }
}
