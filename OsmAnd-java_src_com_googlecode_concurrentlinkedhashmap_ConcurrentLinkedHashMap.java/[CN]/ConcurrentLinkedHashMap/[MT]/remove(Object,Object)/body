{
  final Node<K,V> node=data.get(key);
  if ((node == null) || (value == null)) {
    return false;
  }
  WeightedValue<V> weightedValue=node.get();
  for (; ; ) {
    if (weightedValue.contains(value)) {
      if (tryToRetire(node,weightedValue)) {
        if (data.remove(key,node)) {
          afterWrite(new RemovalTask(node));
          return true;
        }
      }
 else {
        weightedValue=node.get();
        if (weightedValue.isAlive()) {
          continue;
        }
      }
    }
    return false;
  }
}
