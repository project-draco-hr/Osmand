{
  OsmandApplication app=(OsmandApplication)ctx.getApplicationContext();
  final AlertDialog.Builder builder=new AlertDialog.Builder(ctx);
  builder.setTitle(R.string.favourites_context_menu_edit);
  final View v=LayoutInflater.from(ctx).inflate(R.layout.favorite_edit_dialog,null,false);
  final AutoCompleteTextView cat=(AutoCompleteTextView)v.findViewById(R.id.Category);
  final EditText editText=(EditText)v.findViewById(R.id.Name);
  final EditText editDescr=(EditText)v.findViewById(R.id.description);
  builder.setView(v);
  editText.setText(point.getName());
  editDescr.setText(point.getDescription());
  cat.setText(point.getCategory());
  cat.setThreshold(1);
  final FavouritesDbHelper helper=app.getFavorites();
  List<FavoriteGroup> gs=helper.getFavoriteGroups();
  String[] list=new String[gs.size()];
  for (int i=0; i < list.length; i++) {
    list[i]=gs.get(i).name;
  }
  cat.setAdapter(new ArrayAdapter<String>(ctx,R.layout.list_textview,list));
  builder.setNegativeButton(R.string.shared_string_cancel,null);
  builder.setPositiveButton(R.string.shared_string_apply,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      final String newName=editText.getText().toString().trim();
      point.setName(newName);
      point.setCategory(cat.getText().toString());
      point.setDescription(editDescr.getText().toString());
      AlertDialog.Builder builder1=helper.checkDuplicates(point,helper,ctx);
      if (builder1 != null) {
        builder1.setPositiveButton(R.string.shared_string_ok,new DialogInterface.OnClickListener(){
          @Override public void onClick(          DialogInterface dialog,          int which){
            boolean edited=helper.editFavouriteName(point,point.getName(),cat.getText().toString(),editDescr.getText().toString());
            if (edited && callback != null) {
              callback.run();
            }
          }
        }
);
        builder1.create().show();
      }
 else {
        boolean edited=helper.editFavouriteName(point,newName,cat.getText().toString(),editDescr.getText().toString());
        if (edited && callback != null) {
          callback.run();
        }
      }
    }
  }
);
  builder.create().show();
  editText.requestFocus();
  return true;
}
