{
  if (!isLoaded()) {
synchronized (NativeOsmandLibrary.class) {
      if (!isLoaded()) {
        try {
          log.debug("Loading native stlport_shared...");
          System.loadLibrary("stlport_shared");
          log.debug("Loading native osmand...");
          System.loadLibrary("osmand");
          log.debug("Creating NativeOsmandLibrary instance...");
          library=new NativeOsmandLibrary();
          log.debug("Initializing rendering rules storage...");
          NativeOsmandLibrary.initRenderingRulesStorage(storage);
          isNativeSupported=true;
          log.debug("Native library loaded successfully");
        }
 catch (        Throwable e) {
          log.error("Failed to load native library",e);
          isNativeSupported=false;
        }
      }
    }
  }
  return library;
}
