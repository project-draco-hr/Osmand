{
  super.onCreate(icicle);
  setContentView(R.layout.searchpoi);
  searchPOILevel=(Button)findViewById(R.id.SearchPOILevelButton);
  searchPOILevel.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      ResourceManager resourceManager=ResourceManager.getResourceManager();
      if (zoom > finalZoom) {
        --zoom;
      }
      amenityList=resourceManager.searchAmenities(amenityType,lastKnownMapLocation.getLatitude(),lastKnownMapLocation.getLongitude(),zoom,-1);
      if (amenityList != null) {
        MapUtils.sortListOfMapObject(amenityList,lastKnownMapLocation.getLatitude(),lastKnownMapLocation.getLongitude());
        amenityAdapter.setNewModel(amenityList);
      }
      searchPOILevel.setEnabled(zoom > finalZoom);
    }
  }
);
  Bundle bundle=this.getIntent().getExtras();
  String anemity=bundle.getString(AMENITY_TYPE);
  if (anemity != null) {
    ResourceManager resourceManager=ResourceManager.getResourceManager();
    lastKnownMapLocation=OsmandSettings.getLastKnownMapLocation(this);
    amenityType=findAmenityType(anemity);
    if (amenityType != null) {
      amenityList=resourceManager.searchAmenities(amenityType,lastKnownMapLocation.getLatitude(),lastKnownMapLocation.getLongitude(),zoom,maxCount);
    }
 else {
      amenityList=resourceManager.searchAmenities(amenityType,lastKnownMapLocation.getLatitude(),lastKnownMapLocation.getLongitude(),zoom,maxCount);
    }
    if (amenityList != null) {
      MapUtils.sortListOfMapObject(amenityList,lastKnownMapLocation.getLatitude(),lastKnownMapLocation.getLongitude());
      if (amenityType == null) {
        while (amenityList.size() > 30) {
          amenityList.remove(amenityList.size() - 1);
        }
      }
      amenityAdapter=new AmenityAdapter(amenityList);
      setListAdapter(amenityAdapter);
    }
  }
  ListView lv=getListView();
  lv.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener(){
    @Override public boolean onItemLongClick(    AdapterView<?> av,    View v,    int pos,    long id){
      Amenity amenity=amenityList.get(pos);
      String format=amenity.getSimpleFormat(OsmandSettings.usingEnglishNames(v.getContext()));
      if (amenity.getOpeningHours() != null) {
        format+="\nOpening hours : " + amenity.getOpeningHours();
      }
      Toast.makeText(v.getContext(),format,Toast.LENGTH_LONG).show();
      return true;
    }
  }
);
}
