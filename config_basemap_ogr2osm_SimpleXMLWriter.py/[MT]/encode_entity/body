def encode_entity(text, pattern=_escape):

    def escape_entities(m):
        out = []
        for char in m.group():
            out.append(('&#%d;' % ord(char)))
        return string.join(out, '')
    return encode(pattern.sub(escape_entities, text), 'ascii')
