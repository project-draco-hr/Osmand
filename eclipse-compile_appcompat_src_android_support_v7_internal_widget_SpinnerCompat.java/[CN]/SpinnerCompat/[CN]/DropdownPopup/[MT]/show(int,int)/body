{
  final boolean wasShowing=isShowing();
  computeContentWidth();
  setInputMethodMode(ListPopupWindow.INPUT_METHOD_NOT_NEEDED);
  super.show();
  final ListView listView=getListView();
  listView.setChoiceMode(ListView.CHOICE_MODE_SINGLE);
  setSelection(SpinnerCompat.this.getSelectedItemPosition());
  if (wasShowing) {
    return;
  }
  final ViewTreeObserver vto=getViewTreeObserver();
  if (vto != null) {
    final ViewTreeObserver.OnGlobalLayoutListener layoutListener=new ViewTreeObserver.OnGlobalLayoutListener(){
      @Override public void onGlobalLayout(){
        computeContentWidth();
        DropdownPopup.super.show();
      }
    }
;
    vto.addOnGlobalLayoutListener(layoutListener);
    setOnDismissListener(new PopupWindow.OnDismissListener(){
      @Override public void onDismiss(){
        final ViewTreeObserver vto=getViewTreeObserver();
        if (vto != null) {
          vto.removeGlobalOnLayoutListener(layoutListener);
        }
      }
    }
);
  }
}
