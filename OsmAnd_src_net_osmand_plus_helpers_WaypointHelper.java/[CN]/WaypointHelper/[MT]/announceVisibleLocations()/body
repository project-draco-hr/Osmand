{
  Location lastKnownLocation=app.getRoutingHelper().getLastProjection();
  if (lastKnownLocation != null && app.getRoutingHelper().isFollowingMode()) {
    for (int type=0; type < locationPoints.size(); type++) {
      String nameToAnnounce=null;
      int currentRoute=route.getCurrentRoute();
      List<LocationPoint> approachPoints=new ArrayList<LocationPoint>();
      List<LocationPoint> announcePoints=new ArrayList<LocationPoint>();
      List<LocationPointWrapper> lp=locationPoints.get(type);
      if (lp != null) {
        int kIterator=pointsProgress.get(type);
        while (kIterator < lp.size() && lp.get(kIterator).routeIndex < currentRoute) {
          kIterator++;
        }
        pointsProgress.set(type,kIterator);
        while (kIterator < lp.size()) {
          LocationPointWrapper lwp=lp.get(kIterator);
          if (route.getDistanceToPoint(lwp.routeIndex) > LONG_ANNOUNCE_RADIUS * 2) {
            break;
          }
          LocationPoint point=lwp.point;
          double d1=MapUtils.getDistance(lastKnownLocation.getLatitude(),lastKnownLocation.getLongitude(),point.getLatitude(),point.getLongitude());
          Integer state=locationPointsStates.get(point);
          if (state != null && state.intValue() == ANNOUNCED_ONCE && getVoiceRouter().isDistanceLess(lastKnownLocation.getSpeed(),d1,SHORT_ANNOUNCE_RADIUS)) {
            nameToAnnounce=(nameToAnnounce == null ? "" : ", ") + point.getName();
            locationPointsStates.remove(point);
            announcePoints.add(point);
          }
 else           if ((state == null || state == NOT_ANNOUNCED) && getVoiceRouter().isDistanceLess(lastKnownLocation.getSpeed(),d1,LONG_ANNOUNCE_RADIUS)) {
            locationPointsStates.put(point,ANNOUNCED_ONCE);
            approachPoints.add(point);
          }
          kIterator++;
        }
        if (!announcePoints.isEmpty()) {
          if (type == WAYPOINTS) {
            getVoiceRouter().announceWaypoint(announcePoints);
          }
 else           if (type == POI) {
            getVoiceRouter().announcePoi(announcePoints);
          }
 else           if (type == ALARMS) {
          }
 else           if (type == FAVORITES) {
            getVoiceRouter().announceFavorite(announcePoints);
          }
        }
        if (!approachPoints.isEmpty()) {
          if (type == WAYPOINTS) {
            getVoiceRouter().approachWaypoint(lastKnownLocation,announcePoints);
          }
 else           if (type == POI) {
            getVoiceRouter().approachPoi(lastKnownLocation,announcePoints);
          }
 else           if (type == ALARMS) {
            EnumSet<AlarmInfoType> ait=EnumSet.noneOf(AlarmInfoType.class);
            for (            LocationPoint pw : announcePoints) {
              ait.add(((AlarmInfo)pw).getType());
            }
            for (            AlarmInfoType t : ait) {
              app.getRoutingHelper().getVoiceRouter().announceAlarm(t);
            }
          }
 else           if (type == FAVORITES) {
            getVoiceRouter().approachFavorite(lastKnownLocation,announcePoints);
          }
        }
      }
    }
  }
}
