{
  final String eglExtensions=egl.eglQueryString(display,EGL10.EGL_EXTENSIONS);
  Log.i(TAG,"EGL extensions: " + eglExtensions);
  final String eglVersion=egl.eglQueryString(display,EGL10.EGL_VERSION);
  Log.i(TAG,"EGL version: " + eglVersion);
  Log.i(TAG,"Creating main context...");
  final int[] contextAttribList={EGL14.EGL_CONTEXT_CLIENT_VERSION,2,EGL10.EGL_NONE};
  EGLContext mainContext=null;
  try {
    mainContext=egl.eglCreateContext(display,eglConfig,EGL10.EGL_NO_CONTEXT,contextAttribList);
  }
 catch (  Exception e) {
    Log.e(TAG,"Failed to create main context",e);
  }
  if (mainContext == null || mainContext == EGL10.EGL_NO_CONTEXT) {
    Log.e(TAG,"Failed to create main context: " + egl.eglGetError());
    mainContext=null;
    System.exit(0);
  }
  Log.i(TAG,"Creating GPU worker context...");
  try {
    _gpuWorkerContext=egl.eglCreateContext(display,eglConfig,mainContext,contextAttribList);
  }
 catch (  Exception e) {
    Log.e(TAG,"Failed to create GPU worker context",e);
  }
  if (_gpuWorkerContext == null || _gpuWorkerContext == EGL10.EGL_NO_CONTEXT) {
    Log.e(TAG,"Failed to create GPU worker context: " + egl.eglGetError());
    _gpuWorkerContext=null;
  }
  if (_gpuWorkerContext != null) {
    Log.i(TAG,"Creating GPU worker fake surface...");
    try {
      final int[] surfaceAttribList={EGL10.EGL_WIDTH,1,EGL10.EGL_HEIGHT,1,EGL10.EGL_NONE};
      _gpuWorkerFakeSurface=egl.eglCreatePbufferSurface(display,eglConfig,surfaceAttribList);
    }
 catch (    Exception e) {
      Log.e(TAG,"Failed to create GPU worker fake surface",e);
    }
    if (_gpuWorkerFakeSurface == null || _gpuWorkerFakeSurface == EGL10.EGL_NO_SURFACE) {
      Log.e(TAG,"Failed to create GPU worker fake surface: " + egl.eglGetError());
      _gpuWorkerFakeSurface=null;
    }
  }
  MapRendererSetupOptions rendererSetupOptions=new MapRendererSetupOptions();
  if (_gpuWorkerContext != null && _gpuWorkerFakeSurface != null) {
    rendererSetupOptions.setGpuWorkerThreadEnabled(true);
    _gpuWorkerThreadPrologue=new GpuWorkerThreadPrologue(egl,display,_gpuWorkerContext,_gpuWorkerFakeSurface);
    rendererSetupOptions.setGpuWorkerThreadPrologue(_gpuWorkerThreadPrologue.getBinding());
    _gpuWorkerThreadEpilogue=new GpuWorkerThreadEpilogue(egl);
    rendererSetupOptions.setGpuWorkerThreadEpilogue(_gpuWorkerThreadEpilogue.getBinding());
  }
 else {
    rendererSetupOptions.setGpuWorkerThreadEnabled(false);
  }
  _renderRequestCallback=new RenderRequestCallback();
  rendererSetupOptions.setFrameUpdateRequestCallback(_renderRequestCallback.getBinding());
  _mapRenderer.setup(rendererSetupOptions);
  return mainContext;
}
