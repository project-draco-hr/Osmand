def addNode(x, y, tags={}):
    'Given x,y, returns the ID of an existing node there, or creates it and returns the new ID. Node will be updated with the optional tags.'
    global elementIdCounter, nodeCount, nodeCoords, nodeIDsByXY, nodeTags, nodeCoords
    if ((x, y) in nodeIDsByXY):
        nodeID = nodeIDsByXY[(x, y)]
        try:
            nodeTags[nodeID].update(tags)
        except:
            nodeTags[nodeID] = tags
        return nodeID
    else:
        nodeID = elementIdCounter
        elementIdCounter = (elementIdCounter - 1)
        nodeTags[nodeID] = tags
        nodeIDsByXY[(x, y)] = nodeID
        nodeCoords[nodeID] = (x, y)
        nodeCount = (nodeCount + 1)
        return nodeID
