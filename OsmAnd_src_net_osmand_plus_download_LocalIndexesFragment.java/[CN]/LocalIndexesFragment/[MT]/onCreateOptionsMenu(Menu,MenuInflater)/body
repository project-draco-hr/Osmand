{
  if (!this.isAdded()) {
    return;
  }
  if (listAdapter != null && listAdapter.getGroupCount() == 0 && getDownloadActivity().getLocalIndexInfos().size() > 0) {
    for (    LocalIndexInfo info : getDownloadActivity().getLocalIndexInfos()) {
      if (info.getType() == LocalIndexType.AV_DATA) {
        continue;
      }
      listAdapter.addLocalIndexInfo(info);
    }
    listAdapter.sortData();
    getExpandableListView().setAdapter(listAdapter);
    expandAllGroups();
  }
  ActionBar actionBar=getDownloadActivity().getSupportActionBar();
  actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);
  optionsMenuAdapter=new ContextMenuAdapter(getDownloadActivity());
  OnContextMenuClick listener=new OnContextMenuClick(){
    @Override public boolean onContextMenuClick(    ArrayAdapter<?> adapter,    int itemId,    int pos,    boolean isChecked){
      localOptionsMenu(itemId);
      return true;
    }
  }
;
  optionsMenuAdapter.item(R.string.local_index_mi_reload).icon(R.drawable.ic_action_refresh_dark).listen(listener).position(1).reg();
  optionsMenuAdapter.item(R.string.local_index_mi_delete).icon(R.drawable.ic_action_delete_dark).listen(listener).position(2).reg();
  optionsMenuAdapter.item(R.string.local_index_mi_backup).listen(listener).position(3).reg();
  optionsMenuAdapter.item(R.string.local_index_mi_restore).listen(listener).position(4).reg();
  OsmandPlugin.onOptionsMenuActivity(getDownloadActivity(),null,optionsMenuAdapter);
  int max=3;
  SubMenu split=null;
  for (int j=0; j < optionsMenuAdapter.length(); j++) {
    MenuItem item;
    if (j + 1 >= max && optionsMenuAdapter.length() > max) {
      if (split == null) {
        split=menu.addSubMenu(0,1,j + 1,R.string.default_buttons_other_actions);
        split.setIcon(R.drawable.ic_overflow_menu_white);
        split.getItem();
        MenuItemCompat.setShowAsAction(split.getItem(),MenuItemCompat.SHOW_AS_ACTION_ALWAYS);
      }
      item=split.add(0,optionsMenuAdapter.getElementId(j),j + 1,optionsMenuAdapter.getItemName(j));
      MenuItemCompat.setShowAsAction(item,MenuItemCompat.SHOW_AS_ACTION_ALWAYS);
    }
 else {
      item=menu.add(0,optionsMenuAdapter.getElementId(j),j + 1,optionsMenuAdapter.getItemName(j));
      MenuItemCompat.setShowAsAction(item,MenuItemCompat.SHOW_AS_ACTION_ALWAYS);
    }
    if (optionsMenuAdapter.getImageId(j,isLightActionBar()) != 0) {
      item.setIcon(optionsMenuAdapter.getImageId(j,isLightActionBar()));
    }
  }
  if (operationTask == null || operationTask.getStatus() == AsyncTask.Status.FINISHED) {
    menu.setGroupVisible(0,true);
  }
 else {
    menu.setGroupVisible(0,false);
  }
}
