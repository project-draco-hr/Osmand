{
  if (currentWaypointGPX != lastWaypointGPX && loc != null) {
    ArrayList<LocationPoint> points=new ArrayList<LocationPoint>();
    Location next=locations.get(currentRoute);
    float dist=loc.distanceTo(next);
    while (currentWaypointGPX < lastWaypointGPX) {
      WptPt w=(WptPt)waypoints.get(currentWaypointGPX);
      if (MapUtils.getDistance(w.lat,w.lon,next.getLatitude(),next.getLongitude()) > dist + 50) {
        currentWaypointGPX++;
      }
 else {
        break;
      }
    }
    while (currentWaypointGPX < lastWaypointGPX) {
      WptPt w=(WptPt)waypoints.get(currentWaypointGPX);
      if (MapUtils.getDistance(w.lat,w.lon,loc.getLatitude(),next.getLongitude()) < 60) {
        currentWaypointGPX++;
        points.add(w);
      }
    }
    return points;
  }
  return Collections.emptyList();
}
