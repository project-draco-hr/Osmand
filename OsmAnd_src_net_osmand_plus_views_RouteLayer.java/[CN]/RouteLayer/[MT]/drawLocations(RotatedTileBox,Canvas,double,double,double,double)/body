{
  points.clear();
  actionPoints.clear();
  boolean previousVisible=false;
  Location lastProjection=helper.getLastProjection();
  if (lastProjection != null) {
    if (leftLongitude <= lastProjection.getLongitude() && lastProjection.getLongitude() <= rightLongitude && bottomLatitude <= lastProjection.getLatitude() && lastProjection.getLatitude() <= topLatitude) {
      points.add(lastProjection);
      previousVisible=true;
    }
  }
  List<Location> routeNodes=helper.getRoute().getRouteLocations();
  int cd=helper.getRoute().getCurrentRoute();
  List<RouteDirectionInfo> rd=helper.getRouteDirections();
  Iterator<RouteDirectionInfo> it=rd.iterator();
  RouteDirectionInfo nf=null;
  for (int i=0; i < routeNodes.size(); i++) {
    Location ls=routeNodes.get(i);
    if (nf != null && nf.routePointOffset < i + cd) {
      nf=null;
    }
    while (nf != null && it.hasNext()) {
      nf=it.next();
      if (nf.routePointOffset < i + cd) {
        nf=null;
      }
    }
    boolean action=nf != null && nf.routePointOffset == i + cd;
    if (leftLongitude <= ls.getLongitude() && ls.getLongitude() <= rightLongitude && bottomLatitude <= ls.getLatitude() && ls.getLatitude() <= topLatitude) {
      points.add(ls);
      if (!previousVisible) {
        if (i > 0) {
          points.add(0,routeNodes.get(i - 1));
        }
 else         if (lastProjection != null) {
          points.add(0,lastProjection);
        }
      }
      if (action) {
        if (i > 0) {
          actionPoints.add(0,routeNodes.get(i - 1));
        }
 else         if (lastProjection != null) {
          actionPoints.add(0,lastProjection);
        }
        actionPoints.add(ls);
        if (i < routeNodes.size() - 1) {
          actionPoints.add(routeNodes.get(i + 1));
        }
 else {
          actionPoints.add(ls);
        }
      }
      previousVisible=true;
    }
 else     if (previousVisible) {
      points.add(ls);
      drawSegment(tb,canvas);
      previousVisible=false;
      points.clear();
    }
  }
  drawSegment(tb,canvas);
  drawAction(tb,canvas);
}
