{
  DayNightMode dayNightMode=pref.get();
  if (dayNightMode.isDay()) {
    return Boolean.TRUE;
  }
 else   if (dayNightMode.isNight()) {
    return Boolean.FALSE;
  }
 else   if (dayNightMode.isAuto()) {
    long currentTime=System.currentTimeMillis();
    if (currentTime - lastAutoCall > 60000) {
      lastAutoCall=System.currentTimeMillis();
      try {
        SunriseSunset daynightSwitch=getSunriseSunset();
        if (daynightSwitch != null) {
          boolean daytime=daynightSwitch.isDaytime();
          log.debug("Sunrise/sunset setting to day: " + daytime);
          lastAutoValue=Boolean.valueOf(daytime);
        }
        return lastAutoValue;
      }
 catch (      IllegalArgumentException e) {
        log.warn("Network location provider not available");
      }
catch (      SecurityException e) {
        log.warn("Missing permissions to get actual location!");
      }
      return null;
    }
 else {
      return lastAutoValue;
    }
  }
 else   if (dayNightMode.isSensor()) {
    log.debug("lux value:" + lux + " setting to day: "+ (lux > SensorManager.LIGHT_CLOUDY));
    return lux > SensorManager.LIGHT_CLOUDY ? Boolean.TRUE : Boolean.FALSE;
  }
  return null;
}
