{
  List<String> layersList=new ArrayList<String>();
  layersList.add(getString(R.string.layer_map));
  layersList.add(getString(R.string.layer_poi));
  layersList.add(getString(R.string.layer_transport));
  layersList.add(getString(R.string.layer_osm_bugs));
  layersList.add(getString(R.string.layer_favorites));
  layersList.add(getString(R.string.layer_gpx_layer));
  final int routeInfoInd=routeInfoLayer.couldBeVisible() ? layersList.size() : -1;
  if (routeInfoLayer.couldBeVisible()) {
    layersList.add(getString(R.string.layer_route));
  }
  final int transportRouteInfoInd=!TransportRouteHelper.getInstance().routeIsCalculated() ? -1 : layersList.size();
  if (transportRouteInfoInd > -1) {
    layersList.add(getString(R.string.layer_transport_route));
  }
  final int trafficInd=layersList.size();
  layersList.add(getString(R.string.layer_yandex_traffic));
  final boolean[] selected=new boolean[layersList.size()];
  Arrays.fill(selected,true);
  selected[1]=OsmandSettings.isShowingPoiOverMap(settings);
  selected[2]=OsmandSettings.isShowingTransportOverMap(settings);
  selected[3]=OsmandSettings.isShowingOsmBugs(settings);
  selected[4]=OsmandSettings.isShowingFavorites(settings);
  selected[5]=gpxLayer.isVisible();
  selected[trafficInd]=trafficLayer.isVisible();
  if (routeInfoInd != -1) {
    selected[routeInfoInd]=routeInfoLayer.isUserDefinedVisible();
  }
  if (transportRouteInfoInd != -1) {
    selected[transportRouteInfoInd]=transportInfoLayer.isVisible();
  }
  Builder builder=new AlertDialog.Builder(this);
  builder.setMultiChoiceItems(layersList.toArray(new String[layersList.size()]),selected,new DialogInterface.OnMultiChoiceClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int item,    boolean isChecked){
      if (item == 0) {
        dialog.dismiss();
        selectMapLayer();
      }
 else       if (item == 1) {
        if (isChecked) {
          selectPOIFilterLayer();
        }
        OsmandSettings.setShowPoiOverMap(MapActivity.this,isChecked);
      }
 else       if (item == 2) {
        OsmandSettings.setShowTransortOverMap(MapActivity.this,isChecked);
      }
 else       if (item == 3) {
        OsmandSettings.setShowingOsmBugs(MapActivity.this,isChecked);
      }
 else       if (item == 4) {
        OsmandSettings.setShowingFavorites(MapActivity.this,isChecked);
      }
 else       if (item == 5) {
        if (gpxLayer.isVisible()) {
          gpxLayer.clearCurrentGPX();
          favoritesLayer.getFavorites().setFavoritePointsFromGPXFile(null);
        }
 else {
          dialog.dismiss();
          useGPXFileLayer(false,null);
        }
      }
 else       if (item == routeInfoInd) {
        routeInfoLayer.setVisible(isChecked);
      }
 else       if (item == transportRouteInfoInd) {
        transportInfoLayer.setVisible(isChecked);
      }
 else       if (item == trafficInd) {
        OsmandSettings.setShowingYandexTraffic(MapActivity.this,isChecked);
      }
      updateLayers();
      mapView.refreshMap();
    }
  }
);
  builder.show();
}
