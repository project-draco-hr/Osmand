{
  if (Log.isLoggable(LogUtil.TAG,Log.DEBUG)) {
    Log.d(LogUtil.TAG,"Location changed " + location.getProvider());
  }
  if (location != null && OsmandSettings.isSavingTrackToGpx(this)) {
    savingTrackHelper.insertData(location.getLatitude(),location.getLongitude(),location.getAltitude(),location.getSpeed(),location.getTime());
  }
  registerUnregisterSensor(location);
  updateSpeedBearing(location);
  locationLayer.setLastKnownLocation(location);
  if (routingHelper.isFollowingMode()) {
    routingHelper.setCurrentLocation(location);
  }
  if (location != null) {
    if (isMapLinkedToLocation()) {
      if (OsmandSettings.isAutoZoomEnabled(this) && location.hasSpeed()) {
        int z=defineZoomFromSpeed(location.getSpeed(),mapView.getZoom());
        if (mapView.getZoom() != z && !mapView.mapIsAnimating()) {
          mapView.setZoom(z);
        }
      }
      if (location.hasBearing() && currentMapRotation == OsmandSettings.ROTATE_MAP_BEARING && !mapView.mapIsAnimating()) {
        mapView.setRotate(-location.getBearing());
      }
      mapView.setLatLon(location.getLatitude(),location.getLongitude());
    }
 else {
      if (backToLocation.getVisibility() != View.VISIBLE) {
        backToLocation.setVisibility(View.VISIBLE);
      }
    }
  }
 else {
    if (backToLocation.getVisibility() != View.INVISIBLE) {
      backToLocation.setVisibility(View.INVISIBLE);
    }
  }
}
