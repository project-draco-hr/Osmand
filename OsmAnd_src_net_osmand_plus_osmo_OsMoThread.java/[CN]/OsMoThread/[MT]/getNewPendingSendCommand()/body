{
  if (authorized == 0) {
    String auth="TOKEN|" + sessionInfo.token;
    log.info("OSMO send:" + auth);
    cmd(auth,true);
    authorized=1;
    return ByteBuffer.wrap(prepareCommand(auth).toString().getBytes("UTF-8"));
  }
  if (authorized == 1) {
    return null;
  }
  for (  OsMoSender s : listSenders) {
    String l=s.nextSendCommand(this);
    if (l != null) {
      StringBuilder res=prepareCommand(l);
      log.info("OSMO send " + res);
      return ByteBuffer.wrap(res.toString().getBytes("UTF-8"));
    }
  }
  if (System.currentTimeMillis() - lastSendCommand > TIMEOUT_TO_PING) {
    if (pingSent == 0) {
      pingSent=System.currentTimeMillis();
      cmd(PING_CMD,true);
      log.info("OSMO send " + PING_CMD);
      return ByteBuffer.wrap(prepareCommand(PING_CMD).toString().getBytes("UTF-8"));
    }
  }
  return null;
}
