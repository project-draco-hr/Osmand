{
  final RoutingHelper rh=app.getRoutingHelper();
  final WaypointHelper wh=app.getWaypointHelper();
  final OsmandSettings settings=app.getSettings();
  final OsmAndLocationProvider locationProvider=app.getLocationProvider();
  final MapViewTrackingUtilities trackingUtilities=ma.getMapViewTrackingUtilities();
  final Paint paintCircle=new Paint();
  final float th=11 * scaleCoefficient;
  paintCircle.setColor(Color.rgb(225,15,15));
  paintCircle.setStrokeWidth(11 * scaleCoefficient);
  paintCircle.setStyle(Style.STROKE);
  paintCircle.setAntiAlias(true);
  paintCircle.setDither(true);
  final Paint content=new Paint();
  content.setColor(Color.WHITE);
  content.setStyle(Style.FILL);
  final Paint ptext=new Paint();
  ptext.setTextSize(27 * scaleCoefficient);
  ptext.setFakeBoldText(true);
  ptext.setAntiAlias(true);
  ptext.setTextAlign(Align.CENTER);
  final BaseMapWidget alarm=new BaseMapWidget(ma){
    private int textDy=0;
    private String text="";
    private Bitmap img=null;
    private int imgId;
    @Override public boolean updateInfo(    DrawSettings drawSettings){
      boolean trafficWarnings=settings.SHOW_TRAFFIC_WARNINGS.get();
      boolean cams=settings.SHOW_CAMERAS.get();
      boolean visible=false;
      boolean eval=rh.isFollowingMode() || trackingUtilities.isMapLinkedToLocation();
      if ((trafficWarnings || cams) && eval) {
        AlarmInfo alarm;
        if (rh.isFollowingMode()) {
          alarm=wh.getMostImportantAlarm(settings.METRIC_SYSTEM.get(),cams);
        }
 else {
          RouteDataObject ro=locationProvider.getLastKnownRouteSegment();
          Location loc=locationProvider.getLastKnownLocation();
          if (ro != null && loc != null) {
            alarm=wh.calculateMostImportantAlarm(ro,loc,settings.METRIC_SYSTEM.get(),cams);
          }
 else {
            alarm=null;
          }
        }
        if (alarm != null) {
          int locimgId=0;
          int textDy=0;
          String text=null;
          if (alarm.getType() == AlarmInfoType.SPEED_LIMIT) {
            text=alarm.getIntValue() + "";
            if (settings.DRIVING_REGION.get().americanSigns) {
              locimgId=R.drawable.warnings_speed_limit_us;
              textDy=(int)(-12 * scaleCoefficient);
            }
          }
 else           if (alarm.getType() == AlarmInfoType.SPEED_CAMERA) {
            locimgId=R.drawable.warnings_speed_camera;
            text="";
          }
 else           if (alarm.getType() == AlarmInfoType.BORDER_CONTROL) {
            text="CLO";
          }
 else           if (alarm.getType() == AlarmInfoType.TOLL_BOOTH) {
            text="$";
          }
 else           if (alarm.getType() == AlarmInfoType.TRAFFIC_CALMING) {
            locimgId=R.drawable.warnings_speed_bump;
            text="";
          }
 else           if (alarm.getType() == AlarmInfoType.STOP) {
            text="";
          }
          visible=(text != null && text.length() > 0) || locimgId != 0;
          if (visible) {
            if (alarm.getType() == AlarmInfoType.SPEED_CAMERA) {
              visible=cams;
            }
 else {
              visible=trafficWarnings;
            }
          }
          if (visible) {
            if (locimgId != imgId) {
              imgId=locimgId;
              if (imgId == 0) {
                img=null;
              }
 else {
                img=BitmapFactory.decodeResource(getResources(),locimgId);
              }
              invalidate();
            }
            if (text != null && !text.equals(this.text)) {
              this.text=text;
              this.textDy=textDy;
              invalidate();
            }
          }
        }
      }
      updateVisibility(visible);
      return true;
    }
    @Override protected void onDraw(    Canvas canvas){
      if (img == null) {
        RectF f=new RectF(th / 2,th / 2,getWidth() - th / 2,getHeight() - th / 2);
        canvas.drawOval(f,content);
        canvas.drawOval(f,paintCircle);
      }
 else {
        canvas.drawBitmap(img,0,0,paintCircle);
      }
      if (text.length() > 0) {
        canvas.drawText(text,getWidth() / 2,getHeight() / 2 + ptext.descent() + 3 * scaleCoefficient - textDy,ptext);
      }
    }
  }
;
  return alarm;
}
