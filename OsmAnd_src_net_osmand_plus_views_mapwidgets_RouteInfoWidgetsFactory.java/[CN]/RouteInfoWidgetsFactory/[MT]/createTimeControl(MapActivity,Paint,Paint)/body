{
  final RoutingHelper routingHelper=map.getRoutingHelper();
  final Drawable time=map.getResources().getDrawable(R.drawable.widget_time);
  final Drawable timeToGo=map.getResources().getDrawable(R.drawable.widget_time_to_distance);
  final OsmandApplication ctx=map.getMyApplication();
  final OsmandPreference<Boolean> showArrival=ctx.getSettings().SHOW_ARRIVAL_TIME_OTHERWISE_EXPECTED_TIME;
  final TextInfoWidget leftTimeControl=new TextInfoWidget(map,0,paintText,paintSubText){
    private long cachedLeftTime=0;
    @Override public boolean updateInfo(    DrawSettings drawSettings){
      int time=0;
      if (routingHelper != null && routingHelper.isRouteCalculated()) {
        time=routingHelper.getLeftTime();
        if (time != 0) {
          if (showArrival.get()) {
            long toFindTime=time * 1000 + System.currentTimeMillis();
            if (Math.abs(toFindTime - cachedLeftTime) > 30000) {
              cachedLeftTime=toFindTime;
              setContentTitle(getContext().getString(R.string.access_arrival_time));
              if (DateFormat.is24HourFormat(ctx)) {
                setText(DateFormat.format("k:mm",toFindTime).toString(),null);
              }
 else {
                setText(DateFormat.format("h:mm",toFindTime).toString(),DateFormat.format("aa",toFindTime).toString());
              }
              return true;
            }
          }
 else {
            if (Math.abs(time - cachedLeftTime) > 30) {
              cachedLeftTime=time;
              int hours=time / (60 * 60);
              int minutes=(time / 60) % 60;
              setContentTitle(getContext().getString(R.string.map_widget_time));
              setText(String.format("%d:%02d",hours,minutes),null);
              return true;
            }
          }
        }
      }
      if (time == 0 && cachedLeftTime != 0) {
        cachedLeftTime=0;
        setText(null,null);
        return true;
      }
      return false;
    }
  }
;
  leftTimeControl.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      showArrival.set(!showArrival.get());
      leftTimeControl.setImageDrawable(showArrival.get() ? time : timeToGo);
      leftTimeControl.requestLayout();
      map.getMapView().refreshMap();
    }
  }
);
  leftTimeControl.setText(null,null);
  leftTimeControl.setImageDrawable(showArrival.get() ? time : timeToGo);
  return leftTimeControl;
}
