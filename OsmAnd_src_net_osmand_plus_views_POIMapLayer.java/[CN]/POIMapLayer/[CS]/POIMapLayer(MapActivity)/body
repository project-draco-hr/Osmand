{
  routingHelper=activity.getRoutingHelper();
  routingHelper.addListener(this);
  settings=activity.getMyApplication().getSettings();
  app=activity.getMyApplication();
  data=new OsmandMapLayer.MapLayerData<List<Amenity>>(){
{
      ZOOM_THRESHOLD=0;
    }
    @Override public boolean isInterrupted(){
      return super.isInterrupted();
    }
    @Override public void layerOnPostExecute(){
      activity.getMapView().refreshMap();
    }
    @Override protected List<Amenity> calculateResult(    RotatedTileBox tileBox){
      QuadRect latLonBounds=tileBox.getLatLonBounds();
      if (filter == null) {
        return new ArrayList<Amenity>();
      }
      int z=(int)Math.floor(tileBox.getZoom() + Math.log(view.getSettings().MAP_DENSITY.get()) / Math.log(2));
      return filter.searchAmenities(latLonBounds.top,latLonBounds.left,latLonBounds.bottom,latLonBounds.right,z,new ResultMatcher<Amenity>(){
        @Override public boolean publish(        Amenity object){
          return true;
        }
        @Override public boolean isCancelled(){
          return isInterrupted();
        }
      }
);
    }
  }
;
}
