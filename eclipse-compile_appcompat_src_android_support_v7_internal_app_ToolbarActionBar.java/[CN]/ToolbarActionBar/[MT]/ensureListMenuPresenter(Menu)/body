{
  if (mListMenuPresenter == null && (menu instanceof MBuilder)) {
    MBuilder mb=(MBuilder)menu;
    Context context=mDecorToolbar.getContext();
    final TypedValue outValue=new TypedValue();
    final Resources.Theme widgetTheme=context.getResources().newTheme();
    widgetTheme.setTo(context.getTheme());
    widgetTheme.resolveAttribute(R.attr.panelMenuListTheme,outValue,true);
    if (outValue.resourceId != 0) {
      widgetTheme.applyStyle(outValue.resourceId,true);
    }
 else {
      widgetTheme.applyStyle(R.style.Theme_AppCompat_CompactMenu,true);
    }
    context=new ContextThemeWrapper(context,0);
    context.getTheme().setTo(widgetTheme);
    mListMenuPresenter=new ListMenuPresenter(context,R.layout.abc_list_menu_item_layout);
    mListMenuPresenter.setCallback(new PanelMenuPresenterCallback());
    mb.addMenuPresenter(mListMenuPresenter);
  }
}
