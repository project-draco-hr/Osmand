{
  long locationTime=System.currentTimeMillis();
  OsmandSettings settings=ctx.getSettings();
  boolean record=false;
  isRecording=false;
  if (OsmAndLocationProvider.isPointAccurateForRouting(location) && OsmAndLocationProvider.isNotSimulatedLocation(location)) {
    if (OsmandPlugin.getEnabledPlugin(OsmandMonitoringPlugin.class) != null) {
      if (settings.SAVE_TRACK_TO_GPX.get() && locationTime - lastTimeUpdated > settings.SAVE_TRACK_INTERVAL.get() && ctx.getRoutingHelper().isFollowingMode()) {
        record=true;
      }
 else       if (settings.SAVE_GLOBAL_TRACK_TO_GPX.get() && locationTime - lastTimeUpdated > settings.SAVE_GLOBAL_TRACK_INTERVAL.get()) {
        record=true;
      }
    }
 else     if (ctx.getAppCustomization().saveGPXPoint(location) && locationTime - lastTimeUpdated > settings.SAVE_GLOBAL_TRACK_INTERVAL.get()) {
      record=true;
    }
    if (OsmandPlugin.getEnabledPlugin(OsmandMonitoringPlugin.class) != null) {
      if (settings.SAVE_GLOBAL_TRACK_TO_GPX.get() || (settings.SAVE_TRACK_TO_GPX.get() && ctx.getRoutingHelper().isFollowingMode())) {
        isRecording=true;
      }
    }
 else     if (ctx.getAppCustomization().saveGPXPoint(location)) {
      isRecording=true;
    }
  }
  if (record) {
    insertData(location.getLatitude(),location.getLongitude(),location.getAltitude(),location.getSpeed(),location.getAccuracy(),locationTime,settings);
  }
}
