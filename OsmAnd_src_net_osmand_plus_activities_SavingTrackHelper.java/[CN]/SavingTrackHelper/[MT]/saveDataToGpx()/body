{
  SQLiteDatabase db=getReadableDatabase();
  List<String> warnings=new ArrayList<String>();
  File dir=OsmandSettings.getOsmandSettings(ctx).getExternalStorageDirectory();
  if (db != null && dir.canWrite()) {
    dir=new File(dir,ResourceManager.GPX_PATH);
    dir.mkdirs();
    if (dir.exists()) {
      Map<String,GPXFile> data=new LinkedHashMap<String,GPXFile>();
      collectDBPoints(db,data);
      collectDBTracks(db,data);
      for (      String f : data.keySet()) {
        File fout=new File(dir,f + ".gpx");
        if (fout.exists() && !data.get(f).isEmpty()) {
          f=f + "_" + new SimpleDateFormat("HH-mm.EEEE").format(new Date(data.get(f).findPointToShow().time));
          fout=new File(dir,f + ".gpx");
          int ind=1;
          while (fout.exists()) {
            fout=new File(dir,f + "_" + (++ind)+ ".gpx");
          }
        }
        String warn=GPXUtilities.writeGpxFile(fout,data.get(f),ctx);
        if (warn != null) {
          warnings.add(warn);
          return warnings;
        }
      }
    }
  }
  db=getWritableDatabase();
  if (db != null && warnings.isEmpty()) {
    db.execSQL("DELETE FROM " + TRACK_NAME + " WHERE "+ TRACK_COL_DATE+ " <= ?",new Object[]{System.currentTimeMillis()});
    db.execSQL("DELETE FROM " + POINT_NAME + " WHERE "+ POINT_COL_DATE+ " <= ?",new Object[]{System.currentTimeMillis()});
  }
  return warnings;
}
