{
  SQLiteDatabase db=getReadableDatabase();
  List<String> warnings=new ArrayList<String>();
  File dir=OsmandSettings.getExternalStorageDirectory(ctx);
  if (db != null && dir.canWrite()) {
    dir=new File(dir,ResourceManager.APP_DIR + TRACKS_PATH);
    dir.mkdirs();
    if (dir.exists()) {
      Map<String,GPXFile> data=new LinkedHashMap<String,GPXFile>();
      collectDBPoints(db,data);
      collectDBTracks(db,data);
      for (      String f : data.keySet()) {
        File fout=new File(dir,f + ".gpx");
        int ind=1;
        while (fout.exists()) {
          fout=new File(dir,f + "_" + (++ind)+ ".gpx");
        }
        String warn=GPXUtilities.writeGpxFile(fout,data.get(f),ctx);
        if (warn != null) {
          warnings.add(warn);
          return warnings;
        }
      }
    }
  }
  db=getWritableDatabase();
  if (db != null && warnings.isEmpty()) {
    db.execSQL("DELETE FROM " + TRACK_NAME + " WHERE "+ TRACK_COL_DATE+ " <= ?",new Object[]{System.currentTimeMillis()});
  }
  return warnings;
}
