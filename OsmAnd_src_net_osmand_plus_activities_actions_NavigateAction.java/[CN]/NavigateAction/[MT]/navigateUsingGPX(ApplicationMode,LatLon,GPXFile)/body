{
  Builder builder=new AlertDialog.Builder(mapActivity);
  final boolean[] props=new boolean[]{false,false,false,settings.SPEAK_GPX_WPT.get(),settings.CALC_GPX_ROUTE.get()};
  builder.setMultiChoiceItems(new String[]{getString(R.string.gpx_option_reverse_route),getString(R.string.gpx_option_destination_point),getString(R.string.gpx_option_from_start_point),getString(R.string.announce_gpx_waypoints),getString(R.string.calculate_osmand_route_gpx)},props,new OnMultiChoiceClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which,    boolean isChecked){
      props[which]=isChecked;
    }
  }
);
  builder.setPositiveButton(R.string.default_buttons_apply,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      boolean reverse=props[0];
      boolean passWholeWay=props[2];
      boolean useDestination=props[1];
      boolean announceGpxWpt=props[3];
      boolean calculateOsmAndRoute=props[4];
      settings.SPEAK_GPX_WPT.set(announceGpxWpt);
      settings.CALC_GPX_ROUTE.set(calculateOsmAndRoute);
      GPXRouteParamsBuilder bld=GPXRouteParamsBuilder.newBuilder(result,settings);
      if (reverse) {
        bld.reverse();
      }
      if (announceGpxWpt) {
        bld.announceWaypoints();
      }
      if (calculateOsmAndRoute) {
        bld.calculateOsmAndRoute();
      }
      GPXRouteParams gpxRoute=bld.build();
      Location loc=getLastKnownLocation();
      if (passWholeWay && loc != null) {
        gpxRoute.setStartPoint(loc);
      }
      Location startForRouting=getLastKnownLocation();
      if (startForRouting == null) {
        startForRouting=gpxRoute.getStartPointForRoute();
      }
      LatLon endPoint=endForRouting;
      if (endPoint == null || !useDestination) {
        LatLon point=gpxRoute.getLastPoint();
        if (point != null) {
          endPoint=point;
        }
        if (endPoint != null) {
          app.getTargetPointsHelper().navigateToPoint(point,false,-1);
        }
      }
      if (endPoint != null) {
        mapActivity.followRoute(appMode,endPoint,new ArrayList<LatLon>(),startForRouting,gpxRoute);
        settings.FOLLOW_THE_GPX_ROUTE.set(result.path);
      }
    }
  }
);
  builder.setNegativeButton(R.string.default_buttons_cancel,null);
  builder.show();
  return true;
}
