{
  final TypedArray a=context.obtainStyledAttributes(attrs,R.styleable.View,0,0);
  int themeId=0;
  if (useAndroidTheme) {
    themeId=a.getResourceId(R.styleable.View_android_theme,0);
  }
  if (useAppTheme && themeId == 0) {
    themeId=a.getResourceId(R.styleable.View_theme,0);
    if (themeId != 0) {
      Log.i(TAG,"app:theme is now deprecated. Please move to using android:theme instead.");
    }
  }
  a.recycle();
  if (themeId != 0 && (!(context instanceof ContextThemeWrapper) || ((ContextThemeWrapper)context).getThemeResId() != themeId)) {
    context=new ContextThemeWrapper(context,themeId);
  }
  return context;
}
