{
  View row=convertView;
  if (row == null) {
    LayoutInflater inflater=getLayoutInflater();
    row=inflater.inflate(R.layout.osmo_group_list_item,parent,false);
  }
  final OsMoDevice model=(OsMoDevice)getChild(groupPosition,childPosition);
  row.setTag(model);
  if (selectedObject == model) {
    row.setBackgroundColor(getResources().getColor(R.color.row_selection_color));
  }
 else {
    row.setBackgroundColor(Color.TRANSPARENT);
  }
  TextView label=(TextView)row.findViewById(R.id.osmo_label);
  TextView labelTime=(TextView)row.findViewById(R.id.osmo_label_time);
  ImageView icon=(ImageView)row.findViewById(R.id.osmo_user_icon);
  Location location=model.getLastLocation();
  if (model.getTrackerId().equals(osMoPlugin.getService().getMyGroupTrackerId())) {
    location=tracker.getLastSendLocation();
  }
  if (location == null || mapLocation == null) {
    if (model.isEnabled()) {
      icon.setImageResource(R.drawable.mon_osmo_conn_small);
    }
 else {
      icon.setImageResource(R.drawable.monitoring_rec_inactive);
    }
    label.setText(model.getVisibleName());
  }
 else {
    DirectionDrawable draw=new DirectionDrawable();
    float[] mes=new float[2];
    net.osmand.Location.distanceBetween(location.getLatitude(),location.getLongitude(),mapLocation.getLatitude(),mapLocation.getLongitude(),mes);
    draw.setAngle(mes[1] - lastCompass + 180);
    final boolean recent=Math.abs(location.getTime() - System.currentTimeMillis()) < RECENT_THRESHOLD;
    int color;
    if (recent) {
      color=model.getColor();
      if (color == 0) {
        color=getRandomColor();
        osMoPlugin.getGroups().setDeviceProperties(model,model.getVisibleName(),color);
      }
    }
 else {
      color=getResources().getColor(R.color.color_unknown);
    }
    draw.setColor(color);
    icon.setImageDrawable(draw);
    int dist=(int)mes[0];
    long seconds=Math.max(0,(System.currentTimeMillis() - location.getTime()) / 1000);
    String time="";
    if (seconds < 60) {
      seconds=(seconds / 5) * 5;
      time=seconds + " " + getString(R.string.seconds_ago);
    }
 else     if (seconds / 60 < 100) {
      time=(seconds / 60) + " " + getString(R.string.minutes_ago);
    }
 else {
      time=(seconds / (60 * 60)) + " " + getString(R.string.hours_ago);
    }
    String distance=OsmAndFormatter.getFormattedDistance(dist,getMyApplication()) + "  ";
    String visibleName=model.getVisibleName();
    String firstPart=distance + visibleName;
    label.setText(firstPart,TextView.BufferType.SPANNABLE);
    ((Spannable)label.getText()).setSpan(new ForegroundColorSpan(getResources().getColor(R.color.color_distance)),0,distance.length() - 1,0);
    labelTime.setText(time,TextView.BufferType.SPANNABLE);
    ((Spannable)labelTime.getText()).setSpan(new ForegroundColorSpan(getResources().getColor(seconds < 60 ? R.color.color_ok : R.color.color_unknown)),0,time.length(),0);
  }
  return row;
}
