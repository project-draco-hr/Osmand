{
  String text=null;
  if (routingHelper != null && routingHelper.isRouteCalculated()) {
    if (routingHelper.isFollowingMode()) {
      text=routingHelper.getCurrentName();
    }
 else {
      int di=map.getMapLayers().getRouteInfoLayer().getDirectionInfo();
      if (di >= 0 && map.getMapLayers().getRouteInfoLayer().isVisible()) {
        RouteDirectionInfo next=routingHelper.getRouteDirections().get(di);
        text=routingHelper.formatStreetName(next.getStreetName(),next.getRef());
      }
    }
  }
  if (text == null) {
    text="";
  }
  if (!text.equals(getText().toString())) {
    TextPaint pp=new TextPaint(getPaint());
    if (!text.equals("")) {
      pp.setTextSize(25 * scaleCoefficient);
      float ts=pp.measureText(text);
      int wth=getWidth();
      while (ts > wth && pp.getTextSize() > (14 * scaleCoefficient)) {
        pp.setTextSize(pp.getTextSize() - 1);
        ts=pp.measureText(text);
      }
      boolean dots=false;
      while (ts > wth) {
        dots=true;
        text=text.substring(0,text.length() - 2);
        ts=pp.measureText(text);
      }
      if (dots) {
        text+="..";
      }
      setTextSize(TypedValue.COMPLEX_UNIT_PX,pp.getTextSize());
    }
 else {
      setTextSize(TypedValue.COMPLEX_UNIT_PX,7);
    }
    setText(text);
    invalidate();
    return true;
  }
  return false;
}
