{
  PreferenceScreen grp=screen.getPreferenceManager().createPreferenceScreen(activity);
  grp.setTitle(R.string.osmand_service);
  grp.setSummary(R.string.osmand_service_descr);
  ((PreferenceCategory)screen.findPreference("global_settings")).addPreference(grp);
  unregisterReceiver(this.activity);
  routeServiceEnabled=new CheckBoxPreference(activity);
  this.activity=activity;
  broadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      routeServiceEnabled.setChecked(false);
    }
  }
;
  activity.registerReceiver(broadcastReceiver,new IntentFilter(NavigationService.OSMAND_STOP_SERVICE_ACTION));
  routeServiceEnabled.setOnPreferenceChangeListener(new OnPreferenceChangeListener(){
    @Override public boolean onPreferenceChange(    Preference preference,    Object newValue){
      Intent serviceIntent=new Intent(activity,NavigationService.class);
      if ((Boolean)newValue) {
        ComponentName name=activity.startService(serviceIntent);
        if (name == null) {
          routeServiceEnabled.setChecked(app.getNavigationService() != null);
        }
      }
 else {
        if (!activity.stopService(serviceIntent)) {
          routeServiceEnabled.setChecked(app.getNavigationService() != null);
        }
      }
      return true;
    }
  }
);
  routeServiceEnabled.setTitle(R.string.background_router_service);
  routeServiceEnabled.setSummary(R.string.background_router_service_descr);
  routeServiceEnabled.setKey(OsmandSettings.SERVICE_OFF_ENABLED);
  grp.addPreference(routeServiceEnabled);
  String[] entries=new String[]{app.getString(R.string.gps_provider),app.getString(R.string.network_provider)};
  String[] entrieValues=new String[]{LocationManager.GPS_PROVIDER,LocationManager.NETWORK_PROVIDER};
  grp.addPreference(activity.createListPreference(settings.SERVICE_OFF_PROVIDER,entries,entrieValues,R.string.background_service_provider,R.string.background_service_provider_descr));
  grp.addPreference(activity.createTimeListPreference(settings.SERVICE_OFF_INTERVAL,SECONDS,MINUTES,1000,R.string.background_service_int,R.string.background_service_int_descr));
  grp.addPreference(activity.createTimeListPreference(settings.SERVICE_OFF_WAIT_INTERVAL,new int[]{15,30,45,60,90},new int[]{2,3,5,10},1000,R.string.background_service_wait_int,R.string.background_service_wait_int_descr));
}
