{
  PreferenceCategory cat=new PreferenceCategory(activity);
  cat.setTitle(R.string.osmand_service);
  ((PreferenceScreen)screen.findPreference(SettingsActivity.SCREEN_ID_GENERAL_SETTINGS)).addPreference(cat);
  unregisterReceiver(this.activity);
  routeServiceEnabled=new CheckBoxPreference(activity);
  this.activity=activity;
  broadcastReceiver=new BroadcastReceiver(){
    @Override public void onReceive(    Context context,    Intent intent){
      routeServiceEnabled.setChecked(false);
    }
  }
;
  activity.registerReceiver(broadcastReceiver,new IntentFilter(NavigationService.OSMAND_STOP_SERVICE_ACTION));
  routeServiceEnabled.setOnPreferenceChangeListener(new OnPreferenceChangeListener(){
    @Override public boolean onPreferenceChange(    Preference preference,    Object newValue){
      Intent serviceIntent=new Intent(activity,NavigationService.class);
      if ((Boolean)newValue) {
        ComponentName name=activity.startService(serviceIntent);
        if (name == null) {
          routeServiceEnabled.setChecked(app.getNavigationService() != null);
        }
      }
 else {
        if (!activity.stopService(serviceIntent)) {
          routeServiceEnabled.setChecked(app.getNavigationService() != null);
        }
      }
      return true;
    }
  }
);
  routeServiceEnabled.setTitle(R.string.background_router_service);
  routeServiceEnabled.setSummary(R.string.background_router_service_descr);
  routeServiceEnabled.setKey(OsmandSettings.SERVICE_OFF_ENABLED);
  cat.addPreference(routeServiceEnabled);
  cat.addPreference(activity.createTimeListPreference(settings.SERVICE_OFF_INTERVAL,SECONDS,MINUTES,1000,R.string.background_service_int,R.string.background_service_int_descr));
}
