{
  long time=-System.currentTimeMillis();
  RenderingContext rctx=new RenderingContext(){
    @Override protected byte[] getIconRawData(    String data){
      return _R.getIconData(data);
    }
  }
;
  RenderingRuleSearchRequest request=new RenderingRuleSearchRequest(storage);
  NativeSearchResult res=searchObjectsForRendering(sleft,sright,stop,sbottom,zoom,request,true,rctx,"Nothing found");
  rctx.leftX=(float)(((double)sleft) / MapUtils.getPowZoom(31 - zoom));
  rctx.topY=(float)(((double)stop) / MapUtils.getPowZoom(31 - zoom));
  rctx.width=(int)((sright - sleft) / MapUtils.getPowZoom(31 - zoom - 8));
  rctx.height=(int)((sbottom - stop) / MapUtils.getPowZoom(31 - zoom - 8));
  rctx.shadowRenderingMode=2;
  rctx.zoom=zoom;
  long search=time + System.currentTimeMillis();
  final RenderingGenerationResult rres=NativeSwingRendering.generateRenderingIndirect(rctx,res.nativeHandler,false,request,true);
  long rendering=time + System.currentTimeMillis() - search;
  InputStream inputStream=new InputStream(){
    int nextInd=0;
    @Override public int read() throws IOException {
      if (nextInd >= rres.bitmapBuffer.capacity()) {
        return -1;
      }
      byte b=rres.bitmapBuffer.get(nextInd++);
      if (b < 0) {
        return b + 256;
      }
 else {
        return b;
      }
    }
  }
;
  Iterator<ImageReader> readers=ImageIO.getImageReadersByFormatName("png");
  ImageReader reader=readers.next();
  reader.setInput(new MemoryCacheImageInputStream(inputStream),true);
  BufferedImage img=reader.read(0);
  long last=time + System.currentTimeMillis() - rendering;
  System.out.println(" TIMES search - " + search + " rendering - "+ rendering+ " unpack - "+ last);
  return img;
}
