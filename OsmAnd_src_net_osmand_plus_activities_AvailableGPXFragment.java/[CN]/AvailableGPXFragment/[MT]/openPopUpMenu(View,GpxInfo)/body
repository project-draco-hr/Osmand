{
  boolean light=getMyApplication().getSettings().isLightContent();
  final PopupMenu optionsMenu=new PopupMenu(getActivity(),v);
  DirectionsDialogs.setupPopUpMenuIcon(optionsMenu);
  Drawable showIcon=getResources().getDrawable(R.drawable.ic_show_on_map);
  if (light) {
    showIcon=showIcon.mutate();
    showIcon.setColorFilter(getResources().getColor(R.color.icon_color_light),PorterDuff.Mode.MULTIPLY);
  }
  MenuItem item=optionsMenu.getMenu().add(R.string.show_gpx_route).setIcon(showIcon);
  item.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
    @Override public boolean onMenuItemClick(    MenuItem item){
      showGpxOnMap(gpxInfo);
      return true;
    }
  }
);
  item=optionsMenu.getMenu().add(R.string.local_index_mi_rename).setIcon(light ? R.drawable.ic_action_edit_light : R.drawable.ic_action_edit_dark);
  item.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
    @Override public boolean onMenuItemClick(    MenuItem item){
      LocalIndexesFragment.renameFile(getActivity(),gpxInfo.file,new Runnable(){
        @Override public void run(){
          asyncLoader=new LoadGpxTask();
          asyncLoader.execute(getActivity());
        }
      }
);
      return true;
    }
  }
);
  item=optionsMenu.getMenu().add(R.string.share_fav).setIcon(light ? R.drawable.ic_action_gshare_light : R.drawable.ic_action_gshare_dark);
  item.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
    @Override public boolean onMenuItemClick(    MenuItem item){
      final Uri fileUri=Uri.fromFile(gpxInfo.file);
      final Intent sendIntent=new Intent(Intent.ACTION_SEND);
      sendIntent.putExtra(Intent.EXTRA_STREAM,fileUri);
      sendIntent.setType("application/gpx+xml");
      startActivity(sendIntent);
      return true;
    }
  }
);
  final OsmEditingPlugin osmEditingPlugin=OsmandPlugin.getEnabledPlugin(OsmEditingPlugin.class);
  if (osmEditingPlugin != null && osmEditingPlugin.isActive()) {
    Drawable exportIcon=getResources().getDrawable(R.drawable.ic_action_export);
    if (light) {
      exportIcon=exportIcon.mutate();
      exportIcon.setColorFilter(getResources().getColor(R.color.icon_color_light),PorterDuff.Mode.MULTIPLY);
    }
    item=optionsMenu.getMenu().add(R.string.export).setIcon(exportIcon);
    item.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
      @Override public boolean onMenuItemClick(      MenuItem item){
        osmEditingPlugin.sendGPXFiles(getActivity(),AvailableGPXFragment.this,gpxInfo);
        return true;
      }
    }
);
  }
  item=optionsMenu.getMenu().add(R.string.edit_filter_delete_menu_item).setIcon(light ? R.drawable.ic_action_delete_light : R.drawable.ic_action_delete_dark);
  item.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener(){
    @Override public boolean onMenuItemClick(    MenuItem item){
      AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
      builder.setMessage(R.string.recording_delete_confirm);
      builder.setPositiveButton(R.string.default_buttons_yes,new DialogInterface.OnClickListener(){
        @Override public void onClick(        DialogInterface dialog,        int which){
          operationTask=new DeleteGpxTask();
          operationTask.execute(gpxInfo);
        }
      }
);
      builder.setNegativeButton(R.string.default_buttons_cancel,null);
      builder.show();
      return true;
    }
  }
);
  optionsMenu.show();
}
