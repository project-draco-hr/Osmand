{
  MenuItem mi=createMenuItem(menu,SEARCH_ID,R.string.search_poi_filter,R.drawable.ic_action_search_light,R.drawable.ic_action_search_dark,MenuItem.SHOW_AS_ACTION_ALWAYS | MenuItem.SHOW_AS_ACTION_COLLAPSE_ACTION_VIEW);
  searchView=new com.actionbarsherlock.widget.SearchView(getActivity());
  mi.setActionView(searchView);
  searchView.setOnQueryTextListener(new OnQueryTextListener(){
    @Override public boolean onQueryTextSubmit(    String query){
      listAdapter.getFilter().filter(query);
      return true;
    }
    @Override public boolean onQueryTextChange(    String newText){
      listAdapter.getFilter().filter(newText);
      return true;
    }
  }
);
  optionsMenuAdapter=new ContextMenuAdapter(getActivity());
  OnContextMenuClick listener=new OnContextMenuClick(){
    @Override public boolean onContextMenuClick(    ArrayAdapter<?> adapter,    final int itemId,    int pos,    boolean isChecked){
      if (itemId == R.string.local_index_mi_reload) {
        asyncLoader=new LoadGpxTask();
        asyncLoader.execute(getActivity());
      }
 else       if (itemId == R.string.show_gpx_route) {
        openShowOnMapMode();
      }
 else       if (itemId == R.string.local_index_mi_delete) {
        openSelectionMode(itemId,R.drawable.ic_action_delete_dark,R.drawable.ic_action_delete_light,new DialogInterface.OnClickListener(){
          @Override public void onClick(          DialogInterface dialog,          int which){
            doAction(itemId);
          }
        }
);
      }
      return true;
    }
  }
;
  optionsMenuAdapter.item(R.string.show_gpx_route).icons(R.drawable.ic_action_map_marker_dark,R.drawable.ic_action_map_marker_light).listen(listener).reg();
  optionsMenuAdapter.item(R.string.local_index_mi_delete).icons(R.drawable.ic_action_delete_dark,R.drawable.ic_action_delete_light).listen(listener).reg();
  optionsMenuAdapter.item(R.string.local_index_mi_reload).icons(R.drawable.ic_action_refresh_dark,R.drawable.ic_action_refresh_light).listen(listener).reg();
  OsmandPlugin.onOptionsMenuActivity(getSherlockActivity(),this,optionsMenuAdapter);
  for (int j=0; j < optionsMenuAdapter.length(); j++) {
    MenuItem item;
    item=menu.add(0,optionsMenuAdapter.getElementId(j),j + 1,optionsMenuAdapter.getItemName(j));
    item.setShowAsAction(MenuItem.SHOW_AS_ACTION_IF_ROOM);
    if (optionsMenuAdapter.getImageId(j,isLightActionBar()) != 0) {
      item.setIcon(optionsMenuAdapter.getImageId(j,isLightActionBar()));
    }
  }
}
