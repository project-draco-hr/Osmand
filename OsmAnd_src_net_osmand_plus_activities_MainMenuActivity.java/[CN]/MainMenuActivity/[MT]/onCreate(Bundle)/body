{
  getMyApplication().applyTheme(this);
  super.onCreate(savedInstanceState);
  if (getIntent() != null) {
    Intent intent=getIntent();
    if (intent.getExtras() != null && intent.getExtras().containsKey(APP_EXIT_KEY)) {
      getMyApplication().closeApplication(this);
      return;
    }
  }
  if (Version.isSherpafy(getMyApplication())) {
    final Intent mapIntent=new Intent(this,TourViewActivity.class);
    startActivity(mapIntent);
    finish();
    return;
  }
  setContentView(R.layout.dashboard);
  String textVersion=Version.getFullVersion(getMyApplication());
  if (textVersion.contains("#")) {
    textVersion=textVersion.substring(0,textVersion.indexOf("#") + 1);
  }
  ActionBar actionBar=getSupportActionBar();
  actionBar.setTitle(textVersion);
  actionBar.setIcon(android.R.color.transparent);
  actionBarBackground=new ColorDrawable(Color.argb(180,0,0,0));
  actionBarBackground.setAlpha(START_ALPHA);
  actionBar.setBackgroundDrawable(actionBarBackground);
  ((NotifyingScrollView)findViewById(R.id.main_scroll)).setOnScrollChangedListener(onScrollChangedListener);
  if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR1) {
    actionBarBackground.setCallback(mDrawableCallback);
  }
  boolean firstTime=initApp(this,getMyApplication());
  if (getMyApplication().getAppCustomization().checkExceptionsOnStart()) {
    checkPreviousRunsForExceptions(firstTime);
  }
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
    fabButton=new FloatingActionButton.Builder(this).withDrawable(getResources().getDrawable(R.drawable.ic_action_map)).withButtonColor(Color.parseColor("#ff8f00")).withGravity(Gravity.BOTTOM | Gravity.RIGHT).withMargins(0,0,16,16).create();
    fabButton.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View view){
        startMapActivity();
      }
    }
);
    fabButton.hideFloatingActionButton();
  }
  getLocationProvider().addCompassListener(this);
  getLocationProvider().registerOrUnregisterCompassListener(true);
  defaultMargin=(int)TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,-40,getResources().getDisplayMetrics());
}
