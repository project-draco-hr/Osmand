{
  super.onResume();
  Intent intent=getIntent();
  if (intent != null) {
    selectFavoriteMode=intent.hasExtra(SELECT_FAVORITE_POINT_INTENT_KEY);
    if (intent.hasExtra(SearchActivity.SEARCH_LAT) && intent.hasExtra(SearchActivity.SEARCH_LON)) {
      double lat=intent.getDoubleExtra(SearchActivity.SEARCH_LAT,0);
      double lon=intent.getDoubleExtra(SearchActivity.SEARCH_LON,0);
      if (lat != 0 || lon != 0) {
        location=new LatLon(lat,lon);
      }
    }
  }
  if (!isSelectFavoriteMode()) {
    if (location == null && getParent() instanceof SearchActivity) {
      location=((SearchActivity)getParent()).getSearchPoint();
    }
    if (location == null) {
      location=settings.getLastKnownMapLocation();
    }
  }
  locationUpdate(location);
  if (!isSelectFavoriteMode()) {
  }
}
