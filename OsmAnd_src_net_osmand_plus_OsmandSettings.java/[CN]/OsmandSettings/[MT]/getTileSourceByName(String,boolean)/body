{
  if (tileName == null || tileName.length() == 0) {
    return null;
  }
  List<TileSourceTemplate> knownTemplates=TileSourceManager.getKnownSourceTemplates();
  File tPath=extendOsmandPath(ResourceManager.TILES_PATH);
  File dir=new File(tPath,tileName);
  if (!dir.exists()) {
    TileSourceTemplate ret=checkAmongAvailableTileSources(dir,knownTemplates);
    if (ret != null) {
      return ret;
    }
    ret=checkAmongAvailableTileSources(dir,getInternetAvailableSourceTemplates());
    if (ret != null) {
      return ret;
    }
  }
 else   if (tileName.endsWith(SQLiteTileSource.EXT)) {
    return new SQLiteTileSource(dir,knownTemplates);
  }
 else   if (dir.isDirectory() && !dir.getName().startsWith(".")) {
    TileSourceTemplate t=TileSourceManager.createTileSourceTemplate(dir);
    if (warnWhenSelected && !t.isRuleAcceptable()) {
      Toast.makeText(ctx,ctx.getString(R.string.warning_tile_layer_not_downloadable,dir.getName()),Toast.LENGTH_SHORT).show();
    }
    if (!TileSourceManager.isTileSourceMetaInfoExist(dir)) {
      TileSourceTemplate ret=checkAmongAvailableTileSources(dir,knownTemplates);
      if (ret != null) {
        t=ret;
      }
 else {
        ret=checkAmongAvailableTileSources(dir,getInternetAvailableSourceTemplates());
        if (ret != null) {
          t=ret;
        }
      }
    }
    return t;
  }
  return null;
}
