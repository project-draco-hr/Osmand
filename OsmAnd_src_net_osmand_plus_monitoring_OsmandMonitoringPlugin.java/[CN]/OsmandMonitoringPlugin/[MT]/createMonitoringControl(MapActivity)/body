{
  final Drawable monitoringBig=map.getResources().getDrawable(R.drawable.monitoring_rec_big);
  final Drawable monitoringSmall=map.getResources().getDrawable(R.drawable.monitoring_rec_small);
  final Drawable monitoringInactive=map.getResources().getDrawable(R.drawable.monitoring_rec_inactive);
  monitoringControl=new TextInfoWidget(map){
    long lastUpdateTime;
    @Override public boolean updateInfo(    DrawSettings drawSettings){
      if (isSaving) {
        setText(map.getString(R.string.shared_string_save),"");
        setImageDrawable(monitoringBig);
        return true;
      }
      String txt=map.getString(R.string.monitoring_control_start);
      String subtxt=null;
      Drawable d=monitoringInactive;
      long last=lastUpdateTime;
      final boolean globalRecord=settings.SAVE_GLOBAL_TRACK_TO_GPX.get();
      final boolean isRecording=app.getSavingTrackHelper().getIsRecording();
      float dist=app.getSavingTrackHelper().getDistance();
      if (dist > 0) {
        last=app.getSavingTrackHelper().getLastTimeUpdated();
        String ds=OsmAndFormatter.getFormattedDistance(dist,map.getMyApplication());
        int ls=ds.lastIndexOf(' ');
        if (ls == -1) {
          txt=ds;
        }
 else {
          txt=ds.substring(0,ls);
          subtxt=ds.substring(ls + 1);
        }
      }
      if (globalRecord) {
        d=monitoringBig;
      }
 else       if (isRecording) {
        d=monitoringSmall;
      }
 else {
        d=monitoringInactive;
      }
      setText(txt,subtxt);
      setImageDrawable(d);
      if ((last != lastUpdateTime) && (globalRecord || isRecording)) {
        lastUpdateTime=last;
        setImageDrawable(monitoringInactive);
        map.getMyApplication().runInUIThread(new Runnable(){
          @Override public void run(){
            if (globalRecord) {
              setImageDrawable(monitoringBig);
            }
 else {
              setImageDrawable(monitoringSmall);
            }
          }
        }
,500);
      }
      return true;
    }
  }
;
  monitoringControl.updateInfo(null);
  monitoringControl.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      controlDialog(map);
    }
  }
);
  return monitoringControl;
}
