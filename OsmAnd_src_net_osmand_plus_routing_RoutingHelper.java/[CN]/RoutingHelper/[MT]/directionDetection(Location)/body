{
  makeUturnWhenPossible=false;
  suppressTurnPrompt=false;
  if (finalLocation == null || currentLocation == null) {
    turnImminent=0;
    return;
  }
  if (routeNodes.size() > 0) {
    if (currentLocation.hasBearing() || lastFixedLocation != null) {
      float bearingMotion=currentLocation.hasBearing() ? currentLocation.getBearing() : lastFixedLocation.bearingTo(currentLocation);
      float bearingToRoute=currentLocation.bearingTo(routeNodes.get(currentRoute));
      if (Math.abs(bearingMotion - bearingToRoute) > 45f && 360 - Math.abs(bearingMotion - bearingToRoute) > 45f) {
        suppressTurnPrompt=true;
      }
      if (Math.abs(bearingMotion - bearingToRoute) > 135f && 360 - Math.abs(bearingMotion - bearingToRoute) > 135f) {
        float d=currentLocation.distanceTo(routeNodes.get(currentRoute));
        if (d > POSITION_TOLERANCE) {
          if (makeUTwpDetected == 0) {
            makeUTwpDetected=System.currentTimeMillis();
          }
 else           if ((System.currentTimeMillis() - makeUTwpDetected > 5000)) {
            makeUturnWhenPossible=true;
            turnImminent=1;
          }
        }
      }
 else {
        makeUTwpDetected=0;
      }
    }
  }
}
