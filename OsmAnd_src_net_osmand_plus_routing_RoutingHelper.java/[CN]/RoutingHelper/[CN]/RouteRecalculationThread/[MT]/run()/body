{
  RouteCalculationResult res=provider.calculateRouteImpl(params);
  if (params.calculationProgress.isCancelled) {
    currentRunningJob=null;
    return;
  }
synchronized (RoutingHelper.this) {
    if (res.isCalculated()) {
      setNewRoute(res,params.start);
    }
 else {
      evalWaitInterval=evalWaitInterval * 3 / 2;
      evalWaitInterval=Math.min(evalWaitInterval,120000);
    }
    currentRunningJob=null;
  }
  if (res.isCalculated()) {
    String msg=app.getString(R.string.new_route_calculated_dist) + ": " + OsmAndFormatter.getFormattedDistance(res.getWholeDistance(),app);
    if (res.getRoutingTime() != 0f) {
      msg+=" (" + Algorithms.formatDuration((int)res.getRoutingTime()) + ")";
    }
    showMessage(msg);
  }
 else   if (params.type.isOnline() && !settings.isInternetConnectionAvailable()) {
    boolean showMsg=true;
    if (settings.ROUTE_CALC_OSMAND_PARTS.get() && params.previousToRecalculate != null && params.previousToRecalculate.isCalculated()) {
      RouteCalculationResult rcr=params.previousToRecalculate;
      List<Location> locs=rcr.getRouteLocations();
      List<RouteDirectionInfo> routeDirections=rcr.getRouteDirections();
      try {
        provider.insertInitialSegment(params,locs,routeDirections,true);
        showMsg=false;
      }
 catch (      RuntimeException e) {
        e.printStackTrace();
      }
    }
    if (showMsg) {
      showMessage(app.getString(R.string.error_calculating_route) + ":\n" + app.getString(R.string.internet_connection_required_for_online_route));
    }
  }
 else {
    if (res.getErrorMessage() != null) {
      showMessage(app.getString(R.string.error_calculating_route) + ":\n" + res.getErrorMessage());
    }
 else {
      showMessage(app.getString(R.string.empty_route_calculated));
    }
  }
  lastTimeEvaluatedRoute=System.currentTimeMillis();
}
