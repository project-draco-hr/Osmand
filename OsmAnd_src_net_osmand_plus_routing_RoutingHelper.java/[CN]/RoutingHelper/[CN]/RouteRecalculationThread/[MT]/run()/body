{
  RouteCalculationResult res=provider.calculateRouteImpl(params);
  if (params.calculationProgress.isCancelled) {
    currentRunningJob=null;
    return;
  }
synchronized (RoutingHelper.this) {
    if (res.isCalculated()) {
      setNewRoute(res,params.start);
    }
 else {
      evalWaitInterval=evalWaitInterval * 3 / 2;
      evalWaitInterval=Math.min(evalWaitInterval,120000);
    }
    currentRunningJob=null;
  }
  if (res.isCalculated()) {
    showMessage(app.getString(R.string.new_route_calculated_dist) + ": " + OsmAndFormatter.getFormattedDistance(res.getWholeDistance(),app));
  }
 else   if (params.type != RouteService.OSMAND && !settings.isInternetConnectionAvailable()) {
    showMessage(app.getString(R.string.error_calculating_route) + ":\n" + app.getString(R.string.internet_connection_required_for_online_route),Toast.LENGTH_LONG);
  }
 else {
    if (res.getErrorMessage() != null) {
      showMessage(app.getString(R.string.error_calculating_route) + ":\n" + res.getErrorMessage(),Toast.LENGTH_LONG);
    }
 else {
      showMessage(app.getString(R.string.empty_route_calculated),Toast.LENGTH_LONG);
    }
  }
  lastTimeEvaluatedRoute=System.currentTimeMillis();
}
