{
  resourcesLock.lock();
  try {
    List<IndexItem> resourcesInRepository;
    if (resources != null) {
      resourcesInRepository=resources;
    }
 else {
      resourcesInRepository=DownloadActivity.downloadListIndexThread.getCachedIndexFiles();
    }
    if (resourcesInRepository == null) {
      return false;
    }
    resourcesByRegions.clear();
    voiceRecItems.clear();
    voiceTTSItems.clear();
    for (    WorldRegion region : app.getWorldRegion().getFlattenedSubregions()) {
      processRegion(resourcesInRepository,false,region);
    }
    processRegion(resourcesInRepository,true,app.getWorldRegion());
    final Collator collator=OsmAndCollator.primaryCollator();
    final OsmandRegions osmandRegions=app.getRegions();
    Collections.sort(voiceRecItems,new Comparator<IndexItem>(){
      @Override public int compare(      IndexItem lhs,      IndexItem rhs){
        return collator.compare(lhs.getVisibleName(app.getApplicationContext(),osmandRegions),rhs.getVisibleName(app.getApplicationContext(),osmandRegions));
      }
    }
);
    Collections.sort(voiceTTSItems,new Comparator<IndexItem>(){
      @Override public int compare(      IndexItem lhs,      IndexItem rhs){
        return collator.compare(lhs.getVisibleName(app.getApplicationContext(),osmandRegions),rhs.getVisibleName(app.getApplicationContext(),osmandRegions));
      }
    }
);
    return true;
  }
  finally {
    resourcesLock.unlock();
  }
}
