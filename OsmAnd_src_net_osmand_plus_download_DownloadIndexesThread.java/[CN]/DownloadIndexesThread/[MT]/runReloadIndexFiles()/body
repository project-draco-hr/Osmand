{
  checkRunning();
  final BasicProgressAsyncTask<Void,Void,DownloadIndexesResult> inst=new BasicProgressAsyncTask<Void,Void,DownloadIndexesResult>(ctx){
    @Override protected void onPreExecute(){
      currentRunningTask.add(this);
      super.onPreExecute();
      this.message=ctx.getString(R.string.downloading_list_indexes);
    }
    @Override protected DownloadIndexesResult doInBackground(    Void... params){
      DownloadIndexesResult result=new DownloadIndexesResult();
      IndexFileList indexFileList=DownloadOsmandIndexesHelper.getIndexesList(ctx);
      result.indexFiles=indexFileList;
      if (indexFileList != null) {
        updateLoadedFiles();
        prepareFilesToUpdate();
        prepareData(indexFileList.getIndexFiles(),result.resourcesByRegions,result.voiceRecItems,result.voiceTTSItems);
      }
      return result;
    }
    protected void onPostExecute(    DownloadIndexesResult result){
      notifyFilesToUpdateChanged();
      indexFiles=result.indexFiles;
      resourcesByRegions=result.resourcesByRegions;
      voiceRecItems=result.voiceRecItems;
      voiceTTSItems=result.voiceTTSItems;
      if (indexFiles != null && uiActivity != null) {
        boolean basemapExists=uiActivity.getMyApplication().getResourceManager().containsBasemap();
        IndexItem basemap=indexFiles.getBasemap();
        if (basemap != null) {
          String dt=uiActivity.getMyApplication().getResourceManager().getIndexFileNames().get(basemap.getTargetFileName());
          if (!basemapExists || !Algorithms.objectEquals(dt,basemap.getDate(dateFormat))) {
            List<DownloadEntry> downloadEntry=basemap.createDownloadEntry(uiActivity.getMyApplication(),DownloadActivityType.NORMAL_FILE,new ArrayList<DownloadEntry>());
            uiActivity.getEntriesToDownload().put(basemap,downloadEntry);
            AccessibleToast.makeText(uiActivity,R.string.basemap_was_selected_to_download,Toast.LENGTH_LONG).show();
            if (uiActivity instanceof DownloadActivity) {
              uiActivity.updateFragments();
            }
          }
        }
        if (indexFiles.isIncreasedMapVersion()) {
          showWarnDialog();
        }
      }
 else {
        AccessibleToast.makeText(ctx,R.string.list_index_files_was_not_loaded,Toast.LENGTH_LONG).show();
      }
      currentRunningTask.remove(this);
      if (uiActivity != null) {
        uiActivity.updateProgress(false,tag);
        runCategorization(uiActivity.getDownloadType());
        uiActivity.onCategorizationFinished();
      }
    }
    private void showWarnDialog(){
      AlertDialog.Builder builder=new AlertDialog.Builder(ctx);
      builder.setMessage(R.string.map_version_changed_info);
      builder.setPositiveButton(R.string.button_upgrade_osmandplus,new DialogInterface.OnClickListener(){
        @Override public void onClick(        DialogInterface dialog,        int which){
          Intent intent=new Intent(Intent.ACTION_VIEW,Uri.parse("market://search?q=pname:net.osmand.plus"));
          try {
            ctx.startActivity(intent);
          }
 catch (          ActivityNotFoundException e) {
          }
        }
      }
);
      builder.setNegativeButton(R.string.shared_string_cancel,new DialogInterface.OnClickListener(){
        @Override public void onClick(        DialogInterface dialog,        int which){
          dialog.dismiss();
        }
      }
);
      builder.show();
    }
    @Override protected void updateProgress(    boolean updateOnlyProgress,    Object tag){
      if (uiActivity != null) {
        uiActivity.updateProgress(updateOnlyProgress,tag);
      }
    }
  }
;
  execute(inst);
}
