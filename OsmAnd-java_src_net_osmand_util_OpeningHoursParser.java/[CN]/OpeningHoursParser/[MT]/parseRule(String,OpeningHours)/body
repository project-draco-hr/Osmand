{
  r=r.replaceAll("sunset",sunset);
  r=r.replaceAll("sunrise",sunrise);
  r=r.replaceAll("\\+","-" + endOfDay);
  int startDay=-1;
  int previousDay=-1;
  int startMonth=-1;
  int previousMonth=-1;
  int k=0;
  BasicOpeningHourRule basic=new BasicOpeningHourRule();
  boolean[] days=basic.getDays();
  boolean[] months=basic.getMonths();
  if ("24/7".equals(r)) {
    Arrays.fill(days,true);
    basic.addTimeRange(0,24 * 60);
    rs.addRule(basic);
    return true;
  }
  for (; k < r.length(); k++) {
    char ch=r.charAt(k);
    if (Character.isDigit(ch)) {
      break;
    }
    if ((k + 2 < r.length()) && r.substring(k,k + 3).equals("off")) {
      break;
    }
    if (Character.isWhitespace(ch) || ch == ',') {
      continue;
    }
 else     if (ch == '-') {
      if (previousDay != -1) {
        startDay=previousDay;
      }
 else       if (previousMonth != -1) {
        startMonth=previousMonth;
      }
 else {
        return false;
      }
    }
 else     if (k < r.length() - 1) {
      int i=0;
      for (      String s : daysStr) {
        if (s.charAt(0) == ch && s.charAt(1) == r.charAt(k + 1)) {
          break;
        }
        i++;
      }
      if (i < daysStr.length) {
        if (startDay != -1) {
          for (int j=startDay; j <= i; j++) {
            days[j]=true;
          }
          if (startDay > i) {
            for (int j=startDay; j <= 6; j++) {
              days[j]=true;
            }
            for (int j=0; j <= i; j++) {
              days[j]=true;
            }
          }
          startDay=-1;
        }
 else {
          days[i]=true;
        }
        previousDay=i;
      }
 else {
        int m=0;
        for (        String s : monthsStr) {
          if (s.charAt(0) == ch && s.charAt(1) == r.charAt(k + 1) && s.charAt(2) == r.charAt(k + 2)) {
            break;
          }
          m++;
        }
        if (m < monthsStr.length) {
          if (startMonth != -1) {
            for (int j=startMonth; j <= m; j++) {
              months[j]=true;
            }
            if (startMonth > m) {
              for (int j=startMonth; j <= 11; j++) {
                months[j]=true;
              }
              for (int j=0; j <= m; j++) {
                months[j]=true;
              }
            }
            startMonth=-1;
          }
 else {
            months[m]=true;
          }
          previousMonth=m;
        }
      }
    }
 else {
      return false;
    }
  }
  if (previousDay == -1) {
    for (int i=0; i < 7; i++) {
      days[i]=true;
    }
  }
  if (previousMonth == -1) {
    for (int i=0; i < 12; i++) {
      months[i]=true;
    }
  }
  String timeSubstr=r.substring(k);
  String[] times=timeSubstr.split(",");
  boolean timesExist=true;
  for (  String time : times) {
    time=time.trim();
    if (time.length() == 0) {
      continue;
    }
    if (time.equals("off")) {
      break;
    }
    if (time.equals("24/7")) {
      basic.addTimeRange(0,24 * 60);
      break;
    }
    String[] stEnd=time.split("-");
    if (stEnd.length != 2) {
      continue;
    }
    timesExist=true;
    int st;
    int end;
    try {
      int i1=stEnd[0].indexOf(':');
      int i2=stEnd[1].indexOf(':');
      int startHour, startMin, endHour, endMin;
      if (i1 == -1) {
        startHour=Integer.parseInt(stEnd[0].trim());
        startMin=0;
      }
 else {
        startHour=Integer.parseInt(stEnd[0].substring(0,i1).trim());
        startMin=Integer.parseInt(stEnd[0].substring(i1 + 1).trim());
      }
      if (i2 == -1) {
        endHour=Integer.parseInt(stEnd[1].trim());
        endMin=0;
      }
 else {
        endHour=Integer.parseInt(stEnd[1].substring(0,i2).trim());
        endMin=Integer.parseInt(stEnd[1].substring(i2 + 1).trim());
      }
      st=startHour * 60 + startMin;
      end=endHour * 60 + endMin;
    }
 catch (    NumberFormatException e) {
      return false;
    }
    basic.addTimeRange(st,end);
  }
  rs.addRule(basic);
  if (!timesExist) {
    return false;
  }
  return true;
}
