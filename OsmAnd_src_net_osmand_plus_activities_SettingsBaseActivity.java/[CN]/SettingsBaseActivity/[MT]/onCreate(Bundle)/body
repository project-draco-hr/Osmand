{
  ((OsmandApplication)getApplication()).applyTheme(this);
  getSupportActionBar().setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);
  getSupportActionBar().setDisplayHomeAsUpEnabled(true);
  getSupportActionBar().setTitle(R.string.settings_activity);
  super.onCreate(savedInstanceState);
  settings=getMyApplication().getSettings();
  if (profileSettings) {
    modes.clear();
    for (    ApplicationMode a : ApplicationMode.values(settings)) {
      if (a != ApplicationMode.DEFAULT) {
        modes.add(a);
      }
    }
    getSupportActionBar().setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);
    List<String> s=new ArrayList<String>();
    for (    ApplicationMode a : modes) {
      s.add(a.toHumanString(getMyApplication()));
    }
    ArrayAdapter<String> spinnerAdapter=new ArrayAdapter<String>(getSupportActionBar().getThemedContext(),R.layout.sherlock_spinner_item,s);
    spinnerAdapter.setDropDownViewResource(R.layout.sherlock_spinner_dropdown_item);
    getSupportActionBar().setListNavigationCallbacks(spinnerAdapter,new OnNavigationListener(){
      @Override public boolean onNavigationItemSelected(      int itemPosition,      long itemId){
        settings.APPLICATION_MODE.set(modes.get(itemPosition));
        updateAllSettings();
        return true;
      }
    }
);
  }
  setPreferenceScreen(getPreferenceManager().createPreferenceScreen(this));
}
