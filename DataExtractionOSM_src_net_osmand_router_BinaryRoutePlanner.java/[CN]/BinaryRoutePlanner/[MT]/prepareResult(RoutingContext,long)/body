{
  List<RouteSegmentResult> result=new ArrayList<RouteSegmentResult>();
  RouteSegment segment=ctx.finalReverseRoute;
  int parentSegmentStart=ctx.finalReverseEndSegment;
  while (segment != null) {
    RouteSegmentResult res=new RouteSegmentResult();
    res.object=segment.road;
    res.startPointIndex=segment.segmentStart;
    res.endPointIndex=parentSegmentStart;
    parentSegmentStart=segment.parentSegmentEnd;
    segment=segment.parentRoute;
    if (res.startPointIndex != res.endPointIndex) {
      result.add(res);
    }
    res.startPoint=convertPoint(res.object,res.startPointIndex);
    res.endPoint=convertPoint(res.object,res.endPointIndex);
  }
  Collections.reverse(result);
  segment=ctx.finalDirectRoute;
  int parentSegmentEnd=ctx.finalDirectEndSegment;
  while (segment != null) {
    RouteSegmentResult res=new RouteSegmentResult();
    res.object=segment.road;
    res.startPointIndex=parentSegmentEnd;
    res.endPointIndex=segment.segmentStart;
    parentSegmentEnd=segment.parentSegmentEnd;
    segment=segment.parentRoute;
    if (res.startPointIndex != res.endPointIndex) {
      result.add(res);
    }
    res.startPoint=convertPoint(res.object,res.startPointIndex);
    res.endPoint=convertPoint(res.object,res.endPointIndex);
  }
  if (PRINT_TO_CONSOLE_ROUTE_INFORMATION_TO_TEST) {
    System.out.println("ROUTE : ");
    double startLat=MapUtils.get31LatitudeY(ctx.startY);
    double startLon=MapUtils.get31LongitudeX(ctx.startX);
    double endLat=MapUtils.get31LatitudeY(ctx.targetEndY);
    double endLon=MapUtils.get31LongitudeX(ctx.targetEndX);
    System.out.println(MessageFormat.format("<test regions=\"\" description=\"\" best_percent=\"\" vehicle=\"\" \n" + "    start_lat=\"{0}\" start_lon=\"{1}\" target_lat=\"{2}\" target_lon=\"{3}\">",startLat + "",startLon + "",endLat + "",endLon + ""));
    for (    RouteSegmentResult res : result) {
      String name="Unknown";
      String ref="";
      if (ref != null) {
        name+=" " + ref;
      }
      System.out.println(MessageFormat.format("\t<segment id=\"{0}\" start=\"{1}\" end=\"{2}\" name=\"{3}\"/>",(res.object.getId()) + "",res.startPointIndex,res.endPointIndex,name));
    }
    System.out.println("</test>");
  }
  ctx.timeToCalculate=(System.nanoTime() - startNanoTime);
  log.info("Time to calculate : " + ctx.timeToCalculate / 1e6 + ", time to load : " + ctx.timeToLoad / 1e6 + ", loaded tiles : " + ctx.loadedTiles.size() + ", visited segments " + ctx.visitedSegments);
  return result;
}
