{
  if (visible == this.visible) {
    return;
  }
  this.visible=visible;
  DashboardOnMap.staticVisible=visible;
  if (visible) {
    mapViewLocation=mapActivity.getMapLocation();
    mapRotation=mapActivity.getMapRotate();
    mapLinkedToLocation=mapActivity.getMapViewTrackingUtilities().isMapLinkedToLocation();
    myLocation=mapActivity.getMyApplication().getLocationProvider().getLastKnownLocation();
    mapActivity.getMapViewTrackingUtilities().setDashboard(this);
    dashboardView.setVisibility(View.VISIBLE);
    actionButton.show();
    updateDownloadBtn();
    if (mapActivity.getMyApplication().getSettings().USE_DASHBOARD_INSTEAD_OF_DRAWER.get()) {
      addOrUpdateDashboardFragments();
      scrollView.setVisibility(View.VISIBLE);
      listViewLayout.setVisibility(View.GONE);
      switchButton=(ImageView)scrollView.findViewById(R.id.map_menu_button);
      if (switchButton == null) {
        switchButton=(ImageView)dashboardView.findViewById(R.id.map_menu_button);
      }
      switchButton.setImageDrawable(mapActivity.getMyApplication().getIconsCache().getIcon(R.drawable.ic_navigation_drawer,R.color.icon_color_light));
      mapActivity.findViewById(R.id.MapHudButtonsOverlay).setVisibility(View.INVISIBLE);
    }
 else {
      scrollView.setVisibility(View.GONE);
      switchButton=(ImageView)listViewLayout.findViewById(R.id.map_menu_button);
      if (switchButton == null) {
        switchButton=(ImageView)dashboardView.findViewById(R.id.map_menu_button);
      }
      listViewLayout.setVisibility(View.VISIBLE);
      switchButton.setImageDrawable(mapActivity.getMyApplication().getIconsCache().getIcon(R.drawable.ic_dashboard_dark,R.color.icon_color_light));
    }
    switchButton.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View v){
        switchBtnAction();
      }
    }
);
    open(dashboardView.findViewById(R.id.animateContent));
    mapActivity.getMapActions().disableDrawer();
    updateLocation(true,true,false);
  }
 else {
    mapActivity.getMapActions().enableDrawer();
    mapActivity.getMapViewTrackingUtilities().setDashboard(null);
    hide(dashboardView.findViewById(R.id.animateContent));
    mapActivity.findViewById(R.id.MapHudButtonsOverlay).setVisibility(View.VISIBLE);
    actionButton.hide();
    for (    WeakReference<DashBaseFragment> df : fragList) {
      if (df.get() != null) {
        df.get().onCloseDash();
      }
    }
  }
}
