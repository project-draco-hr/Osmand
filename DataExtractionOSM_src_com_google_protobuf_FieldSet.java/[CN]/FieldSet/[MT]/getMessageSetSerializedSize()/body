{
  int size=0;
  for (  final Map.Entry<FieldDescriptorType,Object> entry : fields.entrySet()) {
    final FieldDescriptorType descriptor=entry.getKey();
    if (descriptor.getLiteJavaType() == WireFormat.JavaType.MESSAGE && !descriptor.isRepeated() && !descriptor.isPacked()) {
      size+=CodedOutputStream.computeMessageSetExtensionSize(entry.getKey().getNumber(),(MessageLite)entry.getValue());
    }
 else {
      size+=computeFieldSize(descriptor,entry.getValue());
    }
  }
  return size;
}
