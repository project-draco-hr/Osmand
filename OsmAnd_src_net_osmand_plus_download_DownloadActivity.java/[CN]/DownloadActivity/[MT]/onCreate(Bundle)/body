{
  getMyApplication().applyTheme(this);
  super.onCreate(savedInstanceState);
  downloadValidationManager=new DownloadValidationManager(getMyApplication());
  downloadThread=getMyApplication().getDownloadThread();
  DownloadResources indexes=getDownloadThread().getIndexes();
  if (!indexes.isDownloadedFromInternet) {
    getDownloadThread().runReloadIndexFiles();
  }
  setContentView(R.layout.download);
  final View downloadProgressLayout=findViewById(R.id.downloadProgressLayout);
  downloadProgressLayout.setVisibility(View.VISIBLE);
  updateDescriptionTextWithSize(this,downloadProgressLayout);
  int currentTab=DOWNLOAD_TAB_NUMBER;
  String tab=getIntent() == null || getIntent().getExtras() == null ? null : getIntent().getExtras().getString(TAB_TO_OPEN);
  if (tab != null) {
    if (tab.equals(DOWNLOAD_TAB)) {
      currentTab=DOWNLOAD_TAB_NUMBER;
    }
 else     if (tab.equals(LOCAL_TAB)) {
      currentTab=LOCAL_TAB_NUMBER;
    }
 else     if (tab.equals(UPDATES_TAB)) {
      currentTab=UPDATES_TAB_NUMBER;
    }
  }
  viewPager=(ViewPager)findViewById(R.id.pager);
  PagerSlidingTabStrip mSlidingTabLayout=(PagerSlidingTabStrip)findViewById(R.id.sliding_tabs);
  mTabs.add(new TabActivity.TabItem(R.string.download_tab_downloads,getString(R.string.download_tab_downloads),DownloadResourceGroupFragment.class));
  mTabs.add(new TabActivity.TabItem(R.string.download_tab_local,getString(R.string.download_tab_local),LocalIndexesFragment.class));
  mTabs.add(new TabActivity.TabItem(R.string.download_tab_updates,getString(R.string.download_tab_updates),UpdatesIndexFragment.class));
  viewPager.setAdapter(new TabActivity.OsmandFragmentPagerAdapter(getSupportFragmentManager(),mTabs));
  mSlidingTabLayout.setViewPager(viewPager);
  viewPager.setCurrentItem(currentTab);
  viewPager.addOnPageChangeListener(new ViewPager.OnPageChangeListener(){
    @Override public void onPageScrolled(    int i,    float v,    int i1){
    }
    @Override public void onPageSelected(    int i){
      visibleBanner.updateBannerInProgress();
    }
    @Override public void onPageScrollStateChanged(    int i){
    }
  }
);
  visibleBanner=new BannerAndDownloadFreeVersion(findViewById(R.id.mainLayout),this,true);
  final Intent intent=getIntent();
  if (intent != null && intent.getExtras() != null) {
    filter=intent.getExtras().getString(FILTER_KEY);
    filterCat=intent.getExtras().getString(FILTER_CAT);
    filterGroup=intent.getExtras().getString(FILTER_GROUP);
  }
  showFirstTimeExternalStorage();
}
