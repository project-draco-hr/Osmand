{
  final OpenStreetNote bug=(OpenStreetNote)args.getSerializable(KEY_BUG);
  final Action action=OsmBugsUtil.Action.valueOf((String)args.getSerializable(KEY_ACTION));
  int title;
  if (action == Action.CLOSE) {
    title=R.string.osn_close_dialog_title;
  }
 else   if (action == Action.MODIFY) {
    title=R.string.osn_comment_dialog_title;
  }
 else   if (action == Action.REOPEN) {
    title=R.string.osn_reopen_dialog_title;
  }
 else {
    title=R.string.osn_add_dialog_title;
  }
  AlertDialog dlg=(AlertDialog)dialog;
  dlg.setTitle(title);
  final View view=dlg.findViewById(R.id.layout);
  Button btn=dlg.getButton(DialogInterface.BUTTON_POSITIVE);
  btn.setText(title);
  OsmBugsUtil util=getOsmbugsUtil(bug);
  final boolean offline=util instanceof OsmBugsLocalUtil;
  if (offline) {
    view.findViewById(R.id.userNameEditText).setVisibility(View.GONE);
    view.findViewById(R.id.userNameEditTextLabel).setVisibility(View.GONE);
    view.findViewById(R.id.passwordEditText).setVisibility(View.GONE);
    view.findViewById(R.id.passwordEditTextLabel).setVisibility(View.GONE);
  }
 else {
    ((EditText)view.findViewById(R.id.userNameEditText)).setText(getUserName());
    ((EditText)view.findViewById(R.id.passwordEditText)).setText(((OsmandApplication)activity.getApplication()).getSettings().USER_PASSWORD.get());
  }
  if (action == Action.CREATE && bug.comments.size() > 0) {
    ((EditText)view.findViewById(R.id.messageEditText)).setText(bug.comments.get(0));
  }
  AndroidUtils.softKeyboardDelayed((EditText)view.findViewById(R.id.messageEditText));
  btn.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View dialog){
      if (bug != null) {
        String text=offline ? getMessageText(view) : getTextAndUpdateUserPwd(view);
        asyncActionTask(bug,text,action);
        activity.getContextMenu().close();
      }
    }
  }
);
}
