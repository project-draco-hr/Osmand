{
  final int deviceApiVersion=android.os.Build.VERSION.SDK_INT;
  String SITE_API;
  if (deviceApiVersion >= android.os.Build.VERSION_CODES.GINGERBREAD) {
    SITE_API="https://api.openstreetmap.org/";
  }
 else {
    SITE_API="http://api.openstreetmap.org/";
  }
  List<OpenStreetNote> bugs=new ArrayList<OpenStreetNote>();
  StringBuilder b=new StringBuilder();
  b.append(SITE_API + "api/0.6/notes?bbox=");
  b.append(leftLongitude);
  b.append(",").append(bottomLatitude);
  b.append(",").append(rightLongitude);
  b.append(",").append(topLatitude);
  try {
    log.info("Loading bugs " + b);
    URL url=new URL(b.toString());
    URLConnection connection=url.openConnection();
    BufferedReader reader=new BufferedReader(new InputStreamReader(connection.getInputStream()));
    XmlPullParser parser=Xml.newPullParser();
    parser.setInput(reader);
    int tok;
    OpenStreetNote current=null;
    int commentIndex=0;
    while ((tok=parser.next()) != XmlPullParser.END_DOCUMENT) {
      if (tok == XmlPullParser.START_TAG) {
        if (parser.getName().equals("note")) {
          current=new OpenStreetNote();
          commentIndex=-1;
          current.setLongitude(Double.parseDouble(parser.getAttributeValue("","lon")));
          current.setLatitude(Double.parseDouble(parser.getAttributeValue("","lat")));
          current.setOpened(true);
          bugs.add(current);
        }
 else         if (parser.getName().equals("status") && current != null) {
          current.setOpened("open".equals(readText(parser,"status")));
        }
 else         if (parser.getName().equals("id") && current != null) {
          current.id=Long.parseLong(readText(parser,"id"));
        }
 else         if (parser.getName().equals("comment")) {
          commentIndex++;
        }
 else         if (parser.getName().equals("user") && current != null) {
          if (commentIndex == current.users.size()) {
            current.users.add(readText(parser,"user"));
          }
        }
 else         if (parser.getName().equals("date") && current != null) {
          if (commentIndex == current.dates.size()) {
            current.dates.add(readText(parser,"date"));
          }
        }
 else         if (parser.getName().equals("text") && current != null) {
          if (commentIndex == current.comments.size()) {
            current.comments.add(readText(parser,"text"));
          }
        }
      }
    }
    reader.close();
  }
 catch (  IOException e) {
    log.warn("Error loading bugs",e);
  }
catch (  NumberFormatException e) {
    log.warn("Error loading bugs",e);
  }
catch (  RuntimeException e) {
    log.warn("Error loading bugs",e);
  }
catch (  XmlPullParserException e) {
    log.warn("Error loading bugs",e);
  }
  for (  OsmNotesPoint p : local.getOsmbugsPoints()) {
    if (p.getId() < 0) {
      OpenStreetNote bug=new OpenStreetNote();
      bug.setId(p.getId());
      bug.setLongitude(p.getLongitude());
      bug.setLatitude(p.getLatitude());
      bug.dates.add("");
      bug.users.add(activity.getMyApplication().getSettings().USER_NAME.get());
      bug.comments.add(p.getText());
      bug.setOpened(p.getAction() == Action.CREATE || p.getAction() == Action.MODIFY);
      bug.setLocal(true);
      bugs.add(bug);
    }
  }
  return bugs;
}
