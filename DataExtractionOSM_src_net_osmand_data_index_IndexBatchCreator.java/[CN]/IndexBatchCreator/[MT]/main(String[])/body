{
  IndexBatchCreator creator=new IndexBatchCreator();
  OsmExtractionUI.configLogFile();
  if (args == null || args.length == 0) {
    System.out.println("Please specify -local parameter or path to batch.xml configuration file as 1 argument.");
    throw new IllegalArgumentException("Please specify -local parameter or path to batch.xml configuration file as 1 argument.");
  }
  String name=args[0];
  InputStream stream;
  InputStream regionsStream=null;
  if (name.equals("-local")) {
    stream=IndexBatchCreator.class.getResourceAsStream("batch.xml");
    regionsStream=IndexBatchCreator.class.getResourceAsStream("regions.xml");
    log.info("Using local settings");
  }
 else {
    try {
      stream=new FileInputStream(name);
    }
 catch (    FileNotFoundException e) {
      throw new IllegalArgumentException("XML configuration file not found : " + name,e);
    }
    if (args.length > 1) {
      try {
        File regionsFile=new File(args[1]);
        regionsStream=new FileInputStream(regionsFile);
      }
 catch (      FileNotFoundException e) {
        throw new IllegalArgumentException("Please specify xml-file with regions to download",e);
      }
    }
  }
  boolean skipExisting=false;
  for (int i=0; i < args.length; i++) {
    if ("--skip-existing".equals(args[i])) {
      skipExisting=true;
      break;
    }
  }
  try {
    Document doc=DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(stream);
    Document regions=null;
    if (regionsStream != null) {
      name=args[1];
      regions=DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(regionsStream);
    }
    creator.runBatch(doc,regions,skipExisting);
  }
 catch (  Exception e) {
    System.out.println("XML configuration file could not be read from " + name);
    e.printStackTrace();
    log.error("XML configuration file could not be read from " + name,e);
  }
 finally {
    safeClose(stream,"Error closing stream for " + name);
  }
}
