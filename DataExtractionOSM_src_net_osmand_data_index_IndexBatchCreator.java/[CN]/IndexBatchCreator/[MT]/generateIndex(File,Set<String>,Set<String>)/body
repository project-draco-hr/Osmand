{
  if (!generateIndexes) {
    return;
  }
  try {
    String regionName=f.getName();
    int i=f.getName().indexOf('.');
    if (i > -1) {
      regionName=Algoritms.capitalizeFirstLetterAndLowercase(f.getName().substring(0,i));
    }
    boolean saveAddressWays=writeWayNodes && !doNotWriteWayNodesInUploading.contains(regionName.toLowerCase());
    IndexCreator indexCreator=new IndexCreator(indexDirFiles);
    indexCreator.setIndexAddress(indexAddress);
    indexCreator.setIndexPOI(indexPOI);
    indexCreator.setIndexTransport(indexTransport);
    indexCreator.setLastModifiedDate(f.lastModified());
    indexCreator.setNormalizeStreets(true);
    indexCreator.setSaveAddressWays(saveAddressWays);
    String addressFileName=regionName + "_" + IndexConstants.ADDRESS_TABLE_VERSION+ IndexConstants.ADDRESS_INDEX_EXT;
    indexCreator.setAddressFileName(addressFileName);
    String transportFileName=regionName + "_" + IndexConstants.TRANSPORT_TABLE_VERSION+ IndexConstants.TRANSPORT_INDEX_EXT;
    indexCreator.setTransportFileName(transportFileName);
    String poiFileName=regionName + "_" + IndexConstants.POI_TABLE_VERSION+ IndexConstants.POI_INDEX_EXT;
    indexCreator.setPoiFileName(poiFileName);
    try {
      alreadyGeneratedFiles.add(f.getName());
      indexCreator.generateIndexes(f,new ConsoleProgressImplementation(3),null);
      if (indexAddress) {
        uploadIndex(new File(indexDirFiles,addressFileName),alreadyUploadedFiles);
      }
      if (indexPOI) {
        uploadIndex(new File(indexDirFiles,poiFileName),alreadyUploadedFiles);
      }
      if (indexTransport) {
        uploadIndex(new File(indexDirFiles,transportFileName),alreadyUploadedFiles);
      }
    }
 catch (    Exception e) {
      log.error("Exception generating indexes for " + f.getName(),e);
    }
  }
 catch (  OutOfMemoryError e) {
    System.gc();
    log.error("OutOfMemory",e);
  }
  System.gc();
}
