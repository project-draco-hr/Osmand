{
  try {
    List<File> filesToReindex=new ArrayList<File>();
    boolean forceWifi=downloadFileHelper.isWifiConnected();
    for (int i=0; i < filesToDownload.length; i++) {
      String filename=filesToDownload[i];
      DownloadEntry entry=entriesToDownload.get(filename);
      if (entry != null) {
        String indexOfAllFiles=filesToDownload.length <= 1 ? "" : (" [" + (i + 1) + "/"+ filesToDownload.length+ "]");
        boolean result=downloadFileHelper.downloadFile(filename,entry.fileToSave,entry.fileToUnzip,entry.unzip,progress,entry.dateModified,entry.parts,filesToReindex,indexOfAllFiles,this,forceWifi);
        if (result) {
          entriesToDownload.remove(filename);
          downloads.set(downloads.get() + 1);
          publishProgress(entry);
        }
      }
    }
    boolean vectorMapsToReindex=false;
    for (    File f : filesToReindex) {
      if (f.getName().endsWith(IndexConstants.BINARY_MAP_INDEX_EXT)) {
        vectorMapsToReindex=true;
        break;
      }
    }
    if (vectorMapsToReindex) {
      ResourceManager manager=((OsmandApplication)getApplication()).getResourceManager();
      List<String> warnings=manager.indexingMaps(progress);
      if (warnings.isEmpty() && !OsmandSettings.getOsmandSettings(getApplicationContext()).MAP_VECTOR_DATA.get()) {
        warnings.add(getString(R.string.binary_map_download_success));
        OsmandSettings.getOsmandSettings(getApplicationContext()).MAP_VECTOR_DATA.set(true);
      }
      if (!warnings.isEmpty()) {
        return warnings.get(0);
      }
    }
  }
 catch (  InterruptedException e) {
  }
 finally {
    if (progressFileDlg != null) {
      removeDialog(DIALOG_PROGRESS_FILE);
      progressFileDlg=null;
    }
  }
  return null;
}
