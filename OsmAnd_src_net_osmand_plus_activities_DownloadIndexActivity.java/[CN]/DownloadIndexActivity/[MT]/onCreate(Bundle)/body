{
  super.onCreate(savedInstanceState);
  setContentView(R.layout.download_index);
  tracker=GoogleAnalyticsTracker.getInstance();
  tracker.startNewSession(getString(R.string.ga_api_key),60,this);
  setCustomVarsToTracker();
  tracker.trackPageView("/download.activity?" + Version.getVersionAsURLParam());
  downloadFileHelper=new DownloadFileHelper(this);
  findViewById(R.id.DownloadButton).setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      downloadFilesCheckFreeVersion();
    }
  }
);
  indexFileNames=((OsmandApplication)getApplication()).getResourceManager().getIndexFileNames();
  filterText=(EditText)findViewById(R.id.search_box);
  textWatcher=new TextWatcher(){
    @Override public void afterTextChanged(    Editable s){
    }
    @Override public void beforeTextChanged(    CharSequence s,    int start,    int count,    int after){
    }
    @Override public void onTextChanged(    CharSequence s,    int start,    int before,    int count){
      DownloadIndexAdapter adapter=((DownloadIndexAdapter)getExpandableListAdapter());
      if (adapter != null) {
        adapter.getFilter().filter(s);
      }
    }
  }
;
  filterText.addTextChangedListener(textWatcher);
  final Intent intent=getIntent();
  if (intent != null && intent.getExtras() != null) {
    final String filter=intent.getExtras().getString(FILTER_KEY);
    if (filter != null) {
      filterText.setText(filter);
    }
  }
  if (downloadListIndexThread.getCachedIndexFiles() != null) {
    setListAdapter(new DownloadIndexAdapter(downloadListIndexThread.getCachedIndexFiles()));
  }
 else {
    downloadIndexList();
  }
  if (getPackageName().equals(FREE_VERSION_NAME) && OsmandSettings.getOsmandSettings(this).checkFreeDownloadsNumberZero()) {
    Builder msg=new AlertDialog.Builder(this);
    msg.setTitle(R.string.free_version_title);
    msg.setMessage(getString(R.string.free_version_message,MAXIMUM_AVAILABLE_FREE_DOWNLOADS + "",""));
    msg.show();
  }
}
