{
  super.onCreate(savedInstanceState);
  settings=((OsmandApplication)getApplication()).getSettings();
  if (downloadListIndexThread == null) {
    downloadListIndexThread=new DownloadIndexListThread(this);
  }
  requestWindowFeature(Window.FEATURE_NO_TITLE);
  setContentView(R.layout.download_index);
  View b=findViewById(R.id.search_back_button);
  b.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      finish();
    }
  }
);
  downloadFileHelper=new DownloadFileHelper(getClientContext());
  findViewById(R.id.DownloadButton).setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      downloadFilesCheckFreeVersion(flattenDownloadEntries());
    }
  }
);
  filterText=(EditText)findViewById(R.id.search_box);
  textWatcher=new TextWatcher(){
    @Override public void afterTextChanged(    Editable s){
    }
    @Override public void beforeTextChanged(    CharSequence s,    int start,    int count,    int after){
    }
    @Override public void onTextChanged(    CharSequence s,    int start,    int before,    int count){
      DownloadIndexAdapter adapter=((DownloadIndexAdapter)getExpandableListAdapter());
      if (adapter != null) {
        adapter.getFilter().filter(s);
      }
    }
  }
;
  filterText.addTextChangedListener(textWatcher);
  final Intent intent=getIntent();
  if (intent != null && intent.getExtras() != null) {
    final String filter=intent.getExtras().getString(FILTER_KEY);
    if (filter != null) {
      filterText.setText(filter);
    }
  }
  if (downloadListIndexThread.getCachedIndexFiles() != null && downloadListIndexThread.isDownloadedFromInternet()) {
    DownloadIndexAdapter adapter=new DownloadIndexAdapter(this,getFilteredByType());
    setListAdapter(adapter);
  }
 else {
    downloadIndexList();
  }
  if (Version.isFreeVersion(getMyApplication()) && settings.checkFreeDownloadsNumberZero()) {
    Builder msg=new AlertDialog.Builder(this);
    msg.setTitle(R.string.free_version_title);
    msg.setMessage(getString(R.string.free_version_message,MAXIMUM_AVAILABLE_FREE_DOWNLOADS + "",""));
    msg.setPositiveButton(R.string.default_buttons_ok,null);
    msg.show();
  }
  Spinner spinner=(Spinner)findViewById(R.id.SpinnerLocation);
  final DownloadActivityType[] downloadTypes=getDownloadTypes();
  spinnerAdapter=new ArrayAdapter<String>(this,R.layout.my_spinner_text,new ArrayList<String>(Arrays.asList(toString(downloadTypes)))){
    @Override public View getDropDownView(    int position,    View convertView,    ViewGroup parent){
      View dropDownView=super.getDropDownView(position,convertView,parent);
      if (dropDownView instanceof TextView) {
        ((TextView)dropDownView).setTextColor(getResources().getColor(R.color.color_black));
      }
      return dropDownView;
    }
  }
;
  spinnerAdapter.setDropDownViewResource(R.layout.my_spinner_text);
  spinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  spinner.setAdapter(spinnerAdapter);
  spinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener(){
    @Override public void onItemSelected(    AdapterView<?> parent,    View view,    int position,    long id){
      changeType(downloadTypes[position]);
    }
    @Override public void onNothingSelected(    AdapterView<?> parent){
    }
  }
);
}
