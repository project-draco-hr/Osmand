{
  double sz=0;
  for (  DownloadEntry es : entriesToDownload.values()) {
    sz+=es.sizeMB;
  }
  File dir=OsmandApplication.getSettings().extendOsmandPath("");
  double asz=-1;
  if (dir.canRead()) {
    StatFs fs=new StatFs(dir.getAbsolutePath());
    asz=(((long)fs.getAvailableBlocks()) * fs.getBlockSize()) / (1 << 20);
  }
  if (asz != -1 && asz < sz) {
    Toast.makeText(this,getString(R.string.download_files_not_enough_space,sz,asz),Toast.LENGTH_LONG).show();
  }
 else {
    Builder builder=new AlertDialog.Builder(this);
    if (asz > 0 && sz / asz > 0.8) {
      builder.setMessage(MessageFormat.format(getString(R.string.download_files_question_space),entriesToDownload.size(),sz,asz));
    }
 else {
      builder.setMessage(MessageFormat.format(getString(R.string.download_files_question),entriesToDownload.size(),sz));
    }
    builder.setPositiveButton(R.string.default_buttons_yes,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        showDialog(DIALOG_PROGRESS_FILE);
      }
    }
);
    builder.setNegativeButton(R.string.default_buttons_no,null);
    builder.show();
  }
}
