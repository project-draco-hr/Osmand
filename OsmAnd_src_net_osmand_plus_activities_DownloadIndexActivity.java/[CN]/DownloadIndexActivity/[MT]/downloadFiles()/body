{
  Builder builder=new AlertDialog.Builder(this);
  double sz=0;
  for (  DownloadEntry es : entriesToDownload.values()) {
    sz+=es.sizeMB;
  }
  builder.setMessage(MessageFormat.format(getString(R.string.download_files_question),entriesToDownload.size(),sz));
  builder.setPositiveButton(R.string.default_buttons_yes,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      progressFileDlg=ProgressDialog.show(DownloadIndexActivity.this,getString(R.string.downloading),getString(R.string.downloading_file),true,true);
      interruptDownloading=false;
      progressFileDlg.show();
      final ProgressDialogImplementation impl=new ProgressDialogImplementation(progressFileDlg,true);
      progressFileDlg.setOnCancelListener(new DialogInterface.OnCancelListener(){
        @Override public void onCancel(        DialogInterface dialog){
          interruptDownloading=true;
        }
      }
);
      impl.setRunnable("DownloadIndex",new Runnable(){
        @Override public void run(){
          try {
            List<File> filesToReindex=new ArrayList<File>();
            ArrayList<String> filesToDownload=new ArrayList<String>(entriesToDownload.keySet());
            for (int i=0; i < filesToDownload.size(); i++) {
              String filename=filesToDownload.get(i);
              DownloadEntry entry=entriesToDownload.get(filename);
              if (entry != null) {
                String indexOfAllFiles=filesToDownload.size() < 1 ? "" : (" [" + (i + 1) + "/"+ filesToDownload.size()+ "]");
                if (downloadFile(filename,entry.fileToSave,entry.fileToUnzip,entry.unzip,impl,entry.dateModified,entry.parts,filesToReindex,indexOfAllFiles)) {
                  entriesToDownload.remove(filename);
                  runOnUiThread(new Runnable(){
                    @Override public void run(){
                      ((DownloadIndexAdapter)getListAdapter()).notifyDataSetChanged();
                      findViewById(R.id.DownloadButton).setVisibility(entriesToDownload.isEmpty() ? View.GONE : View.VISIBLE);
                    }
                  }
);
                }
              }
            }
            boolean vectorMapsToReindex=false;
            for (            File f : filesToReindex) {
              if (f.getName().endsWith(IndexConstants.BINARY_MAP_INDEX_EXT)) {
                vectorMapsToReindex=true;
                break;
              }
            }
            if (vectorMapsToReindex) {
              ResourceManager manager=((OsmandApplication)getApplication()).getResourceManager();
              List<String> warnings=manager.indexingMaps(impl);
              if (warnings.isEmpty() && !OsmandSettings.getOsmandSettings(getApplicationContext()).MAP_VECTOR_DATA.get()) {
                warnings.add(getString(R.string.binary_map_download_success));
                OsmandSettings.getOsmandSettings(getApplicationContext()).MAP_VECTOR_DATA.set(true);
              }
              if (!warnings.isEmpty()) {
                showWarning(warnings.get(0));
              }
            }
          }
 catch (          InterruptedException e) {
            progressFileDlg=null;
          }
 finally {
            if (progressFileDlg != null) {
              progressFileDlg.dismiss();
              progressFileDlg=null;
            }
          }
        }
      }
);
      impl.run();
    }
  }
);
  builder.setNegativeButton(R.string.default_buttons_no,null);
  builder.show();
}
