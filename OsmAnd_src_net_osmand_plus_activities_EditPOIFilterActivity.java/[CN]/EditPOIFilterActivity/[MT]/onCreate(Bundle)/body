{
  super.onCreate(icicle);
  titleBar=new CustomTitleBar(this,R.string.searchpoi_activity,R.drawable.tab_search_poi_icon);
  setContentView(R.layout.editing_poi_filter);
  titleBar.afterSetContentView();
  filterLevel=(Button)findViewById(R.id.filter_currentButton);
  filterLevel.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      Bundle extras=getIntent().getExtras();
      boolean searchNearBy=true;
      LatLon lastKnownMapLocation=((OsmandApplication)getApplication()).getSettings().getLastKnownMapLocation();
      double latitude=lastKnownMapLocation != null ? lastKnownMapLocation.getLatitude() : 0;
      double longitude=lastKnownMapLocation != null ? lastKnownMapLocation.getLongitude() : 0;
      final Intent newIntent=new Intent(EditPOIFilterActivity.this,SearchPOIActivity.class);
      if (extras != null && extras.containsKey(SEARCH_LAT) && extras.containsKey(SEARCH_LON)) {
        latitude=extras.getDouble(SEARCH_LAT);
        longitude=extras.getDouble(SEARCH_LON);
        searchNearBy=false;
      }
      final double lat=latitude;
      final double lon=longitude;
      newIntent.putExtra(SearchPOIActivity.AMENITY_FILTER,filter.getFilterId());
      if (searchNearBy) {
        AlertDialog.Builder b=new AlertDialog.Builder(EditPOIFilterActivity.this);
        b.setItems(new String[]{getString(R.string.search_nearby),getString(R.string.search_near_map)},new DialogInterface.OnClickListener(){
          @Override public void onClick(          DialogInterface dialog,          int which){
            if (which == 1) {
              newIntent.putExtra(SearchPOIActivity.SEARCH_LAT,lat);
              newIntent.putExtra(SearchPOIActivity.SEARCH_LON,lon);
            }
            startActivity(newIntent);
          }
        }
);
        b.show();
      }
 else {
        newIntent.putExtra(SearchPOIActivity.SEARCH_LAT,lat);
        newIntent.putExtra(SearchPOIActivity.SEARCH_LON,lon);
        startActivity(newIntent);
      }
    }
  }
);
  ((ImageButton)findViewById(R.id.SaveButton)).setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      savePoiFilter();
    }
  }
);
  ((ImageButton)findViewById(R.id.DeleteButton)).setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      removePoiFilter();
    }
  }
);
  Bundle bundle=this.getIntent().getExtras();
  String filterId=bundle.getString(AMENITY_FILTER);
  helper=((OsmandApplication)getApplication()).getPoiFilters();
  filter=helper.getFilterById(filterId);
  if (filter.isStandardFilter()) {
    ((ImageButton)findViewById(R.id.DeleteButton)).setVisibility(View.GONE);
  }
 else {
    ((ImageButton)findViewById(R.id.DeleteButton)).setVisibility(View.VISIBLE);
  }
  titleBar.getTitleView().setText(getString(R.string.filterpoi_activity) + " - " + filter.getName());
  setListAdapter(new AmenityAdapter(AmenityType.getCategories()));
}
