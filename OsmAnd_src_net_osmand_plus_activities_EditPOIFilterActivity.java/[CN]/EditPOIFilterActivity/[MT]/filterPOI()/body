{
  Bundle extras=getIntent().getExtras();
  boolean searchNearBy=true;
  LatLon lastKnownMapLocation=((OsmandApplication)getApplication()).getSettings().getLastKnownMapLocation();
  double latitude=lastKnownMapLocation != null ? lastKnownMapLocation.getLatitude() : 0;
  double longitude=lastKnownMapLocation != null ? lastKnownMapLocation.getLongitude() : 0;
  final Intent newIntent=new Intent(EditPOIFilterActivity.this,SearchPOIActivity.class);
  if (extras != null && extras.containsKey(SEARCH_LAT) && extras.containsKey(SEARCH_LON)) {
    latitude=extras.getDouble(SEARCH_LAT);
    longitude=extras.getDouble(SEARCH_LON);
    searchNearBy=false;
  }
  final double lat=latitude;
  final double lon=longitude;
  newIntent.addFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
  newIntent.putExtra(SearchPOIActivity.AMENITY_FILTER,filter.getFilterId());
  if (searchNearBy) {
    AlertDialog.Builder b=new AlertDialog.Builder(EditPOIFilterActivity.this);
    b.setItems(new String[]{getString(R.string.search_nearby),getString(R.string.search_near_map)},new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        if (which == 1) {
          newIntent.putExtra(SearchPOIActivity.SEARCH_LAT,lat);
          newIntent.putExtra(SearchPOIActivity.SEARCH_LON,lon);
        }
        startActivity(newIntent);
      }
    }
);
    b.show();
  }
 else {
    newIntent.putExtra(SearchPOIActivity.SEARCH_LAT,lat);
    newIntent.putExtra(SearchPOIActivity.SEARCH_LON,lon);
    startActivity(newIntent);
  }
}
