{
  if (searchPoint == null) {
    AccessibleToast.makeText(getActivity(),R.string.please_select_address,Toast.LENGTH_SHORT).show();
    return;
  }
  String historyName=null;
  String objectName="";
  int zoom=14;
  if (!Algorithms.isEmpty(street2) && !Algorithms.isEmpty(street)) {
    String cityName=!Algorithms.isEmpty(postcode) ? postcode : city;
    objectName=street;
    historyName=MessageFormat.format(getString(R.string.search_history_int_streets),street,street2,cityName);
    zoom=17;
  }
 else   if (!Algorithms.isEmpty(building)) {
    String cityName=!Algorithms.isEmpty(postcode) ? postcode : city;
    objectName=street + " " + building;
    historyName=MessageFormat.format(getString(R.string.search_history_building),building,street,cityName);
    zoom=17;
  }
 else   if (!Algorithms.isEmpty(street)) {
    String cityName=postcode != null ? postcode : city;
    objectName=street;
    historyName=MessageFormat.format(getString(R.string.search_history_street),street,cityName);
    zoom=16;
  }
 else   if (!Algorithms.isEmpty(city)) {
    historyName=MessageFormat.format(getString(R.string.search_history_city),city);
    objectName=city;
    zoom=14;
  }
  if (mode == SELECT_POINT) {
    Intent intent=getActivity().getIntent();
    intent.putExtra(SELECT_ADDRESS_POINT_INTENT_KEY,objectName);
    intent.putExtra(SELECT_ADDRESS_POINT_LAT,searchPoint.getLatitude());
    intent.putExtra(SELECT_ADDRESS_POINT_LON,searchPoint.getLongitude());
    getActivity().setResult(SELECT_ADDRESS_POINT_RESULT_OK,intent);
    getActivity().finish();
  }
 else {
    OsmandApplication ctx=(OsmandApplication)getActivity().getApplication();
    final TargetPointsHelper targetPointsHelper=ctx.getTargetPointsHelper();
    if (mode == NAVIGATE_TO) {
      targetPointsHelper.setSingleDestination(searchPoint.getLatitude(),searchPoint.getLongitude(),historyName);
      MapActivity.launchMapActivityMoveToTop(getActivity());
    }
 else     if (mode == ADD_WAYPOINT) {
      if (targetPointsHelper.getIntermediatePoints().size() == 0) {
        targetPointsHelper.navigateToPoint(searchPoint,true,-1);
      }
 else {
        targetPointsHelper.navigateToPoint(searchPoint,true,targetPointsHelper.getIntermediatePoints().size());
      }
      IntermediatePointsDialog.openIntermediatePointsDialog(mapActivity);
      MapActivity.launchMapActivityMoveToTop(getActivity());
    }
 else     if (mode == SHOW_ON_MAP) {
      osmandSettings.setMapLocationToShow(searchPoint.getLatitude(),searchPoint.getLongitude(),zoom,historyName);
      MapActivity.launchMapActivityMoveToTop(getActivity());
    }
  }
}
