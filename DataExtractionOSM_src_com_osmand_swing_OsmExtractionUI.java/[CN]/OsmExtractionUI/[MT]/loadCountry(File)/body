{
  final IOsmStorageFilter filter;
  if (filterAreaToLoad.isSelected() && mapPanel.getSelectionArea().isVisible()) {
    MapSelectionArea area=mapPanel.getSelectionArea();
    filter=new OsmBoundsFilter(area.getLat1(),area.getLon1(),area.getLat2(),area.getLon2());
  }
 else {
    filter=null;
  }
  try {
    final ProgressDialog dlg=new ProgressDialog(frame,"Loading osm file");
    dlg.setRunnable(new Runnable(){
      @Override public void run(){
        Region res;
        try {
          res=new DataExtraction().readCountry(f.getAbsolutePath(),dlg,filter);
        }
 catch (        IOException e) {
          throw new IllegalArgumentException(e);
        }
catch (        SAXException e) {
          throw new IllegalStateException(e);
        }
        dlg.setResult(res);
      }
    }
);
    Region region=(Region)dlg.run();
    if (region != null) {
      int i=f.getName().indexOf('.');
      if (region.getName().isEmpty()) {
        region.setName(Algoritms.capitalizeFirstLetterAndLowercase(f.getName().substring(0,i)));
      }
      setRegion(region,region.getName());
      frame.setTitle("OsmAnd Map Creator - " + f.getName());
    }
 else {
    }
  }
 catch (  InterruptedException e1) {
    log.error("Interrupted",e1);
  }
catch (  InvocationTargetException e1) {
    log.error("Exception during operation",e1.getCause());
  }
}
