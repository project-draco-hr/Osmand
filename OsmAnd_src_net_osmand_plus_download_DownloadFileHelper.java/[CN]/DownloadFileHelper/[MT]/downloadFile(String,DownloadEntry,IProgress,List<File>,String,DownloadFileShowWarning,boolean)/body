{
  FileOutputStream out=null;
  try {
    out=new FileOutputStream(de.fileToSave);
    try {
      String urlPrefix="http://" + DownloadOsmandIndexesHelper.INDEX_DOWNLOAD_DOMAIN + "/download?event=2&file=";
      String urlSuffix="&" + Version.getVersionAsURLParam(ctx);
      if (de.isRoadMap) {
        urlSuffix+="&road=yes";
      }
      if (de.parts == 1) {
        URL url=new URL(urlPrefix + fileName + urlSuffix);
        downloadFile(fileName,out,url,null,indexOfAllFiles,progress,forceWifi);
      }
 else {
        for (int i=1; i <= de.parts; i++) {
          URL url=new URL(urlPrefix + fileName + "-"+ i+ urlSuffix);
          downloadFile(fileName,out,url," [" + i + "/"+ de.parts+ "]",indexOfAllFiles,progress,forceWifi);
        }
      }
    }
  finally {
      out.close();
      out=null;
    }
    unzipFile(de,progress,toReIndex);
    showWarningCallback.showWarning(ctx.getString(R.string.download_index_success));
    return true;
  }
 catch (  IOException e) {
    log.error("Exception ocurred",e);
    showWarningCallback.showWarning(ctx.getString(R.string.error_io_error));
    if (out != null) {
      try {
        out.close();
      }
 catch (      IOException e1) {
      }
    }
    de.fileToSave.delete();
    return false;
  }
catch (  InterruptedException e) {
    de.fileToSave.delete();
    throw e;
  }
}
