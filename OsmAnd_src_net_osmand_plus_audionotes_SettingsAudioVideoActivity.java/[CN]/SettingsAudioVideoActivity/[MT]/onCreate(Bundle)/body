{
  super.onCreate(savedInstanceState);
  getSupportActionBar().setTitle(R.string.av_settings);
  PreferenceScreen grp=getPreferenceScreen();
  AudioVideoNotesPlugin p=OsmandPlugin.getEnabledPlugin(AudioVideoNotesPlugin.class);
  if (p != null) {
    String[] entries;
    Integer[] intValues;
    entries=new String[]{getString(R.string.av_def_action_choose),getString(R.string.av_def_action_audio),getString(R.string.av_def_action_video),getString(R.string.av_def_action_picture)};
    intValues=new Integer[]{AV_DEFAULT_ACTION_CHOOSE,AV_DEFAULT_ACTION_AUDIO,AV_DEFAULT_ACTION_VIDEO,AV_DEFAULT_ACTION_TAKEPICTURE};
    ListPreference defAct=createListPreference(p.AV_DEFAULT_ACTION,entries,intValues,R.string.av_widget_action,R.string.av_widget_action_descr);
    grp.addPreference(defAct);
    final Camera cam=openCamera();
    if (cam != null) {
      grp.addPreference(createCheckBoxPreference(p.AV_EXTERNAL_PHOTO_CAM,R.string.av_use_external_camera,R.string.av_use_external_camera_descr));
      Parameters parameters=cam.getParameters();
      List<Camera.Size> psps=parameters.getSupportedPictureSizes();
      List<Integer> mpix=new ArrayList<Integer>();
      List<Integer> picSizesValues=new ArrayList<Integer>();
      for (int index=0; index < psps.size(); index++) {
        mpix.add((psps.get(index)).width * (psps.get(index)).height);
        picSizesValues.add(index);
      }
      for (int i=0; i < mpix.size(); i++) {
        for (int j=0; j < mpix.size() - i - 1; j++) {
          if (mpix.get(j) < mpix.get(j + 1)) {
            int tmp=mpix.get(j + 1);
            mpix.set(j + 1,mpix.get(j));
            mpix.set(j,tmp);
            tmp=picSizesValues.get(j + 1);
            picSizesValues.set(j + 1,picSizesValues.get(j));
            picSizesValues.set(j,tmp);
          }
        }
      }
      cameraPictureSizeDefault=picSizesValues.get(0);
      log.debug("onCreate() set cameraPictureSizeDefault=" + cameraPictureSizeDefault);
      List<String> itemsPicSizes=new ArrayList<String>();
      String prefix;
      for (int index=0; index < psps.size(); index++) {
        float px=(float)((psps.get(picSizesValues.get(index))).width * (psps.get(picSizesValues.get(index))).height);
        if (px > 102400) {
          px=px / 1048576;
          prefix="Mpx";
        }
 else {
          px=px / 1024;
          prefix="Kpx";
        }
        itemsPicSizes.add((psps.get(picSizesValues.get(index))).width + "x" + (psps.get(picSizesValues.get(index))).height+ " ( "+ String.format("%.2f",px)+ " "+ prefix+ " )");
      }
      log.debug("onCreate() set default size: width=" + psps.get(cameraPictureSizeDefault).width + " height="+ psps.get(cameraPictureSizeDefault).height+ " index in ps="+ cameraPictureSizeDefault);
      entries=itemsPicSizes.toArray(new String[itemsPicSizes.size()]);
      intValues=picSizesValues.toArray(new Integer[picSizesValues.size()]);
      if (entries.length > 0) {
        ListPreference camSizes=createListPreference(p.AV_CAMERA_PICTURE_SIZE,entries,intValues,R.string.av_camera_pic_size,R.string.av_camera_pic_size_descr);
        grp.addPreference(camSizes);
      }
      List<String> sfm=parameters.getSupportedFocusModes();
      List<String> items=new ArrayList<String>();
      List<Integer> itemsValues=new ArrayList<Integer>();
      for (int index=0; index < sfm.size(); index++) {
        if (sfm.get(index).equals("auto")) {
          items.add(getString(R.string.av_camera_focus_auto));
          itemsValues.add(AV_CAMERA_FOCUS_AUTO);
        }
 else         if (sfm.get(index).equals("fixed")) {
          items.add(getString(R.string.av_camera_focus_hiperfocal));
          itemsValues.add(AV_CAMERA_FOCUS_HIPERFOCAL);
        }
 else         if (sfm.get(index).equals("edof")) {
          items.add(getString(R.string.av_camera_focus_edof));
          itemsValues.add(AV_CAMERA_FOCUS_EDOF);
        }
 else         if (sfm.get(index).equals("infinity")) {
          items.add(getString(R.string.av_camera_focus_infinity));
          itemsValues.add(AV_CAMERA_FOCUS_INFINITY);
        }
 else         if (sfm.get(index).equals("macro")) {
          items.add(getString(R.string.av_camera_focus_macro));
          itemsValues.add(AV_CAMERA_FOCUS_MACRO);
        }
 else         if (sfm.get(index).equals("continuous-picture")) {
          items.add(getString(R.string.av_camera_focus_continuous));
          itemsValues.add(AV_CAMERA_FOCUS_CONTINUOUS);
        }
      }
      entries=items.toArray(new String[items.size()]);
      intValues=itemsValues.toArray(new Integer[itemsValues.size()]);
      if (entries.length > 0) {
        ListPreference camFocus=createListPreference(p.AV_CAMERA_FOCUS_TYPE,entries,intValues,R.string.av_camera_focus,R.string.av_camera_focus_descr);
        grp.addPreference(camFocus);
      }
      grp.addPreference(createCheckBoxPreference(p.AV_PHOTO_PLAY_SOUND,R.string.av_photo_play_sound,R.string.av_photo_play_sound_descr));
      cam.release();
    }
    grp.addPreference(createCheckBoxPreference(p.AV_EXTERNAL_RECORDER,R.string.av_use_external_recorder,R.string.av_use_external_recorder_descr));
    entries=new String[]{"3GP","MP4"};
    intValues=new Integer[]{VIDEO_OUTPUT_3GP,VIDEO_OUTPUT_MP4};
    ListPreference lp=createListPreference(p.AV_VIDEO_FORMAT,entries,intValues,R.string.av_video_format,R.string.av_video_format_descr);
    grp.addPreference(lp);
  }
}
