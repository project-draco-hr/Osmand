{
  if (!visible) {
    return;
  }
  if (!isVectorDataVisible() && tileLayer != null) {
    tileLayer.drawTileMap(canvas,tilesRect);
    resourceManager.getRenderer().interruptLoadingMap();
  }
 else {
    final MapRendererView mapRenderer=view.getMapRenderer();
    if (mapRenderer != null && !oldRender) {
      NativeCoreContext.getMapRendererContext().setNightMode(drawSettings.isNightMode());
      OsmandSettings st=view.getApplication().getSettings();
      if (!Algorithms.objectEquals(st.MAP_UNDERLAY.get(),cachedUnderlay)) {
        cachedUnderlay=st.MAP_UNDERLAY.get();
        ITileSource tileSource=st.getTileSourceByName(cachedUnderlay,false);
        if (tileSource != null) {
          TileSourceProxyProvider prov=new TileSourceProxyProvider(view.getApplication(),tileSource);
          mapRenderer.setMapLayerProvider(-1,prov.instantiateProxy(true));
          prov.swigReleaseOwnership();
        }
 else {
          mapRenderer.resetMapLayerProvider(-1);
        }
      }
      mapRenderer.setTarget(new PointI(tilesRect.getCenter31X(),tilesRect.getCenter31Y()));
      mapRenderer.setAzimuth(-tilesRect.getRotate());
      mapRenderer.setZoom((float)(tilesRect.getZoom() + tilesRect.getZoomAnimation()));
    }
 else {
      if (!view.isZooming()) {
        if (resourceManager.updateRenderedMapNeeded(tilesRect,drawSettings)) {
          final RotatedTileBox copy=tilesRect.copy();
          copy.increasePixelDimensions(copy.getPixWidth() / 3,copy.getPixHeight() / 4);
          resourceManager.updateRendererMap(copy);
        }
      }
      MapRenderRepositories renderer=resourceManager.getRenderer();
      drawRenderedMap(canvas,renderer.getBitmap(),renderer.getBitmapLocation(),tilesRect);
      drawRenderedMap(canvas,renderer.getPrevBitmap(),renderer.getPrevBmpLocation(),tilesRect);
    }
  }
}
