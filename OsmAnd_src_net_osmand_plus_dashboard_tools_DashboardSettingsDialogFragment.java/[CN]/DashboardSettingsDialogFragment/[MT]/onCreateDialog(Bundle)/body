{
  AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
  final OsmandSettings settings=mapActivity.getMyApplication().getSettings();
  if (savedInstanceState != null && savedInstanceState.containsKey(CHECKED_ITEMS)) {
    adapter=new DashFragmentAdapter(getActivity(),fragmentsData,savedInstanceState.getBooleanArray(CHECKED_ITEMS));
  }
 else {
    adapter=new DashFragmentAdapter(getActivity(),fragmentsData,settings);
  }
  builder.setTitle(R.string.dahboard_options_dialog_title).setAdapter(adapter,null).setPositiveButton(R.string.shared_string_ok,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialogInterface,    int type){
      boolean[] shouldShow=adapter.getCheckedItems();
      for (int i=0; i < shouldShow.length; i++) {
        settings.registerBooleanPreference(DashboardOnMap.SHOULD_SHOW + fragmentsData[i].tag,true).makeGlobal().set(shouldShow[i]);
      }
      mapActivity.getDashboard().refreshDashboardFragments();
    }
  }
).setNegativeButton(R.string.shared_string_cancel,null);
  return builder.create();
}
