{
  TypedValue typedValue=new TypedValue();
  Resources.Theme theme=getActivity().getTheme();
  theme.resolveAttribute(android.R.attr.textColorPrimary,typedValue,true);
  textColorPrimary=typedValue.data;
  theme.resolveAttribute(R.attr.dialog_inactive_text_color,typedValue,true);
  textColorSecondary=typedValue.data;
  final OsmandSettings settings=mapActivity.getMyApplication().getSettings();
  View view=LayoutInflater.from(getActivity()).inflate(R.layout.show_dashboard_on_start_dialog_item,null,false);
  final TextView textView=(TextView)view.findViewById(R.id.text);
  textView.setText(R.string.show_on_start);
  final CompoundButton compoundButton=(CompoundButton)view.findViewById(R.id.check_item);
  compoundButton.setChecked(settings.SHOW_DASHBOARD_ON_MAP_SCREEN.get());
  textView.setTextColor(settings.SHOW_DASHBOARD_ON_MAP_SCREEN.get() ? textColorPrimary : textColorSecondary);
  compoundButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener(){
    @Override public void onCheckedChanged(    CompoundButton compoundButton,    boolean b){
      textView.setTextColor(b ? textColorPrimary : textColorSecondary);
    }
  }
);
  AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
  if (savedInstanceState != null && savedInstanceState.containsKey(CHECKED_ITEMS)) {
    mAdapter=new DashFragmentAdapter(getActivity(),mFragmentsData,savedInstanceState.getBooleanArray(CHECKED_ITEMS),savedInstanceState.getIntArray(NUMBER_OF_ROWS_ARRAY));
  }
 else {
    mAdapter=new DashFragmentAdapter(getActivity(),mFragmentsData,settings);
  }
  builder.setTitle(R.string.dahboard_options_dialog_title).setAdapter(mAdapter,null).setPositiveButton(R.string.shared_string_apply,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialogInterface,    int type){
      boolean[] shouldShow=mAdapter.getCheckedItems();
      int[] numberOfRows=mAdapter.getNumbersOfRows();
      for (int i=0; i < shouldShow.length; i++) {
        final DashFragmentData fragmentData=mFragmentsData.get(i);
        settings.registerBooleanPreference(DashboardOnMap.SHOULD_SHOW + fragmentData.tag,true).makeGlobal().set(shouldShow[i]);
        if (fragmentData.rowNumberTag != null) {
          settings.registerIntPreference(fragmentData.rowNumberTag,DEFAULT_NUMBER_OF_ROWS).makeGlobal().set(numberOfRows[i]);
        }
      }
      mapActivity.getDashboard().refreshDashboardFragments();
      settings.SHOW_DASHBOARD_ON_MAP_SCREEN.set(compoundButton.isChecked());
    }
  }
).setNegativeButton(R.string.shared_string_cancel,null);
  final AlertDialog dialog=builder.create();
  ListView listView=dialog.getListView();
  listView.addHeaderView(view);
  return dialog;
}
