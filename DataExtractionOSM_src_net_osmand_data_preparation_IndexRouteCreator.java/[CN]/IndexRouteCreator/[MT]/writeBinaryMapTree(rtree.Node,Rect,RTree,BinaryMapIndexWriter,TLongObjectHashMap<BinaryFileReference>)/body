{
  Element[] e=parent.getAllElements();
  boolean containsLeaf=false;
  for (int i=0; i < parent.getTotalElements(); i++) {
    if (e[i].getElementType() == rtree.Node.LEAF_NODE) {
      containsLeaf=true;
    }
  }
  BinaryFileReference ref=writer.startMapTreeElement(re.getMinX(),re.getMaxX(),re.getMinY(),re.getMaxY(),containsLeaf);
  if (ref != null) {
    bounds.put(parent.getNodeIndex(),ref);
  }
  for (int i=0; i < parent.getTotalElements(); i++) {
    if (e[i].getElementType() != rtree.Node.LEAF_NODE) {
      rtree.Node chNode=r.getReadNode(((NonLeafElement)e[i]).getPtr());
      writeBinaryMapTree(chNode,e[i].getRect(),r,writer,bounds);
    }
  }
  writer.endWriteMapTreeElement();
}
