{
  if (voiceProvider != null) {
    File parent=OsmandSettings.getOsmandSettings(ctx).extendOsmandPath(ResourceManager.VOICE_PATH);
    File voiceDir=new File(parent,voiceProvider);
    if (!voiceDir.exists()) {
      throw new CommandPlayerException(ctx.getString(R.string.voice_data_unavailable));
    }
    if (MediaCommandPlayerImpl.isMyData(voiceDir)) {
      return new MediaCommandPlayerImpl(osmandApplication,voiceProvider);
    }
 else     if (TTSCommandPlayerImpl.isMyData(voiceDir)) {
      return new TTSCommandPlayerImpl(ctx,voiceProvider);
    }
    throw new CommandPlayerException(ctx.getString(R.string.voice_data_not_supported));
  }
  return null;
}
