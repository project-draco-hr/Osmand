{
  if (map == null) {
    return;
  }
  ResourceManager mgr=resourceManager;
  int nzoom=view.getZoom();
  float tileX=view.getXTile();
  float tileY=view.getYTile();
  float w=view.getCenterPointX();
  float h=view.getCenterPointY();
  float ftileSize=view.getTileSize();
  int left=(int)FloatMath.floor(tilesRect.left);
  int top=(int)FloatMath.floor(tilesRect.top);
  int width=(int)FloatMath.ceil(tilesRect.right - left);
  int height=(int)FloatMath.ceil(tilesRect.bottom - top);
  boolean useInternet=settings.USE_INTERNET_TO_DOWNLOAD_TILES.get() && settings.isInternetConnectionAvailable() && map.couldBeDownloadedFromInternet();
  int maxLevel=Math.min(view.getSettings().MAX_LEVEL_TO_DOWNLOAD_TILE.get(),map.getMaximumZoomSupported());
  int tileSize=map.getTileSize();
  for (int i=0; i < width; i++) {
    for (int j=0; j < height; j++) {
      int leftPlusI=(int)FloatMath.floor((float)MapUtils.getTileNumberX(nzoom,MapUtils.getLongitudeFromTile(nzoom,left + i)));
      int topPlusJ=(int)FloatMath.floor((float)MapUtils.getTileNumberY(nzoom,MapUtils.getLatitudeFromTile(nzoom,top + j)));
      float x1=(left + i - tileX) * ftileSize + w;
      float y1=(top + j - tileY) * ftileSize + h;
      String ordImgTile=mgr.calculateTileId(map,leftPlusI,topPlusJ,nzoom);
      boolean imgExist=mgr.tileExistOnFileSystem(ordImgTile,map,leftPlusI,topPlusJ,nzoom);
      Bitmap bmp=null;
      boolean originalBeLoaded=useInternet && nzoom <= maxLevel;
      if (imgExist || originalBeLoaded) {
        bmp=mgr.getTileImageForMapAsync(ordImgTile,map,leftPlusI,topPlusJ,nzoom,useInternet);
      }
      if (bmp == null) {
        int div=2;
        String imgTile2=mgr.calculateTileId(map,leftPlusI / 2,topPlusJ / 2,nzoom - 1);
        String imgTile4=mgr.calculateTileId(map,leftPlusI / 4,topPlusJ / 4,nzoom - 2);
        if (originalBeLoaded || imgExist) {
          bmp=mgr.getTileImageFromCache(imgTile2);
          div=2;
          if (bmp == null) {
            bmp=mgr.getTileImageFromCache(imgTile4);
            div=4;
          }
        }
        if (!originalBeLoaded && !imgExist) {
          if (mgr.tileExistOnFileSystem(imgTile2,map,leftPlusI / 2,topPlusJ / 2,nzoom - 1) || (useInternet && nzoom - 1 <= maxLevel)) {
            bmp=mgr.getTileImageForMapAsync(imgTile2,map,leftPlusI / 2,topPlusJ / 2,nzoom - 1,useInternet);
            div=2;
          }
 else           if (mgr.tileExistOnFileSystem(imgTile4,map,leftPlusI / 4,topPlusJ / 4,nzoom - 2) || (useInternet && nzoom - 2 <= maxLevel)) {
            bmp=mgr.getTileImageForMapAsync(imgTile4,map,leftPlusI / 4,topPlusJ / 4,nzoom - 2,useInternet);
            div=4;
          }
        }
        if (bmp != null) {
          int xZoom=((left + i) % div) * tileSize / div;
          int yZoom=((top + j) % div) * tileSize / div;
          bitmapToZoom.set(xZoom,yZoom,xZoom + tileSize / div,yZoom + tileSize / div);
          bitmapToDraw.set(x1,y1,x1 + ftileSize,y1 + ftileSize);
          canvas.drawBitmap(bmp,bitmapToZoom,bitmapToDraw,paintBitmap);
        }
      }
 else {
        bitmapToZoom.set(0,0,tileSize,tileSize);
        bitmapToDraw.set(x1,y1,x1 + ftileSize,y1 + ftileSize);
        canvas.drawBitmap(bmp,bitmapToZoom,bitmapToDraw,paintBitmap);
      }
    }
  }
}
