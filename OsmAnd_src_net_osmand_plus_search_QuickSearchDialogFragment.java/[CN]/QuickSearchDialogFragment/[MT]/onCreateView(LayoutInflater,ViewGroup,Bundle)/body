{
  final MapActivity mapActivity=getMapActivity();
  final OsmandApplication app=getMyApplication();
  final View view=inflater.inflate(R.layout.search_dialog_fragment,container,false);
  if (savedInstanceState != null) {
    searchQuery=savedInstanceState.getString(QUICK_SEARCH_QUERY_KEY);
  }
  if (searchQuery == null) {
    searchQuery=getArguments().getString(QUICK_SEARCH_QUERY_KEY);
  }
  if (searchQuery == null)   searchQuery="";
  tabToolbarView=view.findViewById(R.id.tab_toolbar_layout);
  tabsView=view.findViewById(R.id.tabs_view);
  searchView=view.findViewById(R.id.search_view);
  Toolbar toolbar=(Toolbar)view.findViewById(R.id.toolbar);
  toolbar.setNavigationIcon(app.getIconsCache().getThemedIcon(R.drawable.abc_ic_ab_back_mtrl_am_alpha));
  toolbar.setNavigationContentDescription(R.string.access_shared_string_navigate_up);
  toolbar.setNavigationOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      dismiss();
    }
  }
);
  setupSearch(mapActivity);
  viewPager=(ViewPager)view.findViewById(R.id.pager);
  pagerAdapter=new SearchFragmentPagerAdapter(getChildFragmentManager(),getResources());
  viewPager.setAdapter(pagerAdapter);
  tabLayout=(TabLayout)view.findViewById(R.id.tab_layout);
  tabLayout.setupWithViewPager(viewPager);
  searchEditText=(EditText)view.findViewById(R.id.searchEditText);
  searchEditText.addTextChangedListener(new TextWatcher(){
    @Override public void beforeTextChanged(    CharSequence s,    int start,    int count,    int after){
    }
    @Override public void onTextChanged(    CharSequence s,    int start,    int before,    int count){
    }
    @Override public void afterTextChanged(    Editable s){
      String newQueryText=s.toString();
      updateClearButtonVisibility(newQueryText.length() > 0);
      updateTabbarVisibility(newQueryText.length() == 0);
      if (!searchQuery.equalsIgnoreCase(newQueryText)) {
        searchQuery=newQueryText;
        runSearch();
      }
    }
  }
);
  progressBar=(ProgressBar)view.findViewById(R.id.searchProgressBar);
  clearButton=(ImageButton)view.findViewById(R.id.clearButton);
  clearButton.setImageDrawable(app.getIconsCache().getThemedIcon(R.drawable.ic_action_remove_dark));
  clearButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      if (searchEditText.getText().length() > 0) {
        String newText=searchUICore.getPhrase().getTextWithoutLastWord();
        searchEditText.setText(newText);
        searchEditText.setSelection(newText.length());
      }
    }
  }
);
  addMainSearchFragment();
  searchEditText.requestFocus();
  AndroidUtils.softKeyboardDelayed(searchEditText);
  return view;
}
