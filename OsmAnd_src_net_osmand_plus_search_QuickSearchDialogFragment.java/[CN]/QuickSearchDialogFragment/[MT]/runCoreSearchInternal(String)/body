{
  return searchUICore.search(text,new ResultMatcher<SearchResult>(){
    SearchResultCollection regionResultCollection=null;
    SearchCoreAPI regionResultApi=null;
    List<SearchResult> results=new ArrayList<>();
    @Override public boolean publish(    SearchResult object){
      if (paused) {
        if (results.size() > 0) {
          getResultCollection().addSearchResults(results,true,true);
        }
        return false;
      }
switch (object.objectType) {
case SEARCH_API_FINISHED:
        final SearchCoreAPI searchApi=(SearchCoreAPI)object.object;
      final List<SearchResult> apiResults;
    final SearchPhrase phrase=object.requiredSearchPhrase;
  final SearchCoreAPI regionApi=regionResultApi;
final SearchResultCollection regionCollection=regionResultCollection;
final boolean hasRegionCollection=(searchApi == regionApi && regionCollection != null);
if (hasRegionCollection) {
apiResults=regionCollection.getCurrentSearchResults();
}
 else {
apiResults=results;
}
regionResultApi=null;
regionResultCollection=null;
results=new ArrayList<>();
app.runInUIThread(new Runnable(){
@Override public void run(){
if (!paused) {
boolean appended=false;
if (getResultCollection() == null || getResultCollection().getPhrase() != phrase) {
SearchResultCollection resCollection=new SearchResultCollection(phrase);
resCollection.addSearchResults(results,true,true);
setResultCollection(resCollection);
}
 else {
getResultCollection().addSearchResults(apiResults,false,true);
appended=true;
}
if (!hasRegionCollection) {
updateSearchResult(getResultCollection(),appended);
}
}
}
}
);
break;
case SEARCH_API_REGION_FINISHED:
regionResultApi=(SearchCoreAPI)object.object;
final SearchPhrase regionPhrase=object.requiredSearchPhrase;
regionResultCollection=new SearchResultCollection(regionPhrase);
regionResultCollection.addSearchResults(results,true,true);
app.runInUIThread(new Runnable(){
@Override public void run(){
if (!paused) {
boolean appended=getResultCollection() != null && getResultCollection().getPhrase() == regionPhrase;
if (appended) {
SearchResultCollection resCollection=getResultCollection().combineWithCollection(regionResultCollection,false,true);
updateSearchResult(resCollection,true);
}
 else {
updateSearchResult(regionResultCollection,false);
}
}
}
}
);
break;
case PARTIAL_LOCATION:
app.runInUIThread(new Runnable(){
@Override public void run(){
foundPartialLocation=true;
updateToolbarButton();
}
}
);
break;
default :
results.add(object);
}
return false;
}
@Override public boolean isCancelled(){
return paused;
}
}
);
}
