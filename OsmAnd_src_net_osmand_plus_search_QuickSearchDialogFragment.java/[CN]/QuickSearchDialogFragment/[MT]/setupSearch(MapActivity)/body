{
  final OsmandApplication app=mapActivity.getMyApplication();
  String locale=app.getSettings().MAP_PREFERRED_LOCALE.get();
  searchUICore=app.getSearchUICore();
  searchUICore.resetPhrase();
  location=app.getLocationProvider().getLastKnownLocation();
  LatLon clt=mapActivity.getMapView().getCurrentRotatedTileBox().getCenterLatLon();
  LatLon centerLatLon=clt;
  searchEditText.setHint(R.string.search_poi_category_hint);
  if (location != null) {
    double d=MapUtils.getDistance(clt,location.getLatitude(),location.getLongitude());
    if (d < DISTANCE_THRESHOLD) {
      centerLatLon=new LatLon(location.getLatitude(),location.getLongitude());
    }
 else {
      useMapCenter=true;
    }
  }
  SearchSettings settings=searchUICore.getSearchSettings().setOriginalLocation(new LatLon(centerLatLon.getLatitude(),centerLatLon.getLongitude()));
  settings=settings.setLang(locale);
  searchUICore.updateSettings(settings);
  searchUICore.setOnResultsComplete(new Runnable(){
    @Override public void run(){
      app.runInUIThread(new Runnable(){
        @Override public void run(){
          hideProgressBar();
          addMoreButton();
        }
      }
);
    }
  }
);
}
