{
  final OsmandApplication app=mapActivity.getMyApplication();
  String locale=app.getSettings().MAP_PREFERRED_LOCALE.get();
  Collection<RegionAddressRepository> regionAddressRepositories=app.getResourceManager().getAddressRepositories();
  BinaryMapIndexReader[] binaryMapIndexReaderArray=new BinaryMapIndexReader[regionAddressRepositories.size()];
  int i=0;
  for (  RegionAddressRepository rep : regionAddressRepositories) {
    binaryMapIndexReaderArray[i++]=rep.getFile();
  }
  searchUICore=new SearchUICore(app.getPoiTypes(),locale,binaryMapIndexReaderArray);
  LatLon centerLatLon;
  if (location != null) {
    centerLatLon=new LatLon(location.getLatitude(),location.getLongitude());
  }
 else {
    centerLatLon=mapActivity.getMapView().getCurrentRotatedTileBox().getCenterLatLon();
  }
  SearchSettings settings=searchUICore.getPhrase().getSettings().setOriginalLocation(new LatLon(centerLatLon.getLatitude(),centerLatLon.getLongitude()));
  settings=settings.setLang(locale);
  searchUICore.updateSettings(settings);
  searchUICore.setOnResultsComplete(new Runnable(){
    @Override public void run(){
      app.runInUIThread(new Runnable(){
        @Override public void run(){
          hideProgressBar();
          addMoreButton();
        }
      }
);
    }
  }
);
  searchUICore.registerAPI(new SearchBaseAPI(){
    @Override public boolean search(    SearchPhrase phrase,    SearchResultMatcher resultMatcher){
      List<FavouritePoint> favList=getMyApplication().getFavorites().getFavouritePoints();
      for (      FavouritePoint point : favList) {
        SearchResult sr=new SearchResult(phrase);
        sr.localeName=point.getName();
        sr.object=point;
        sr.priority=SEARCH_FAVORITE_OBJECT_PRIORITY;
        sr.objectType=ObjectType.FAVORITE;
        sr.location=new LatLon(point.getLatitude(),point.getLongitude());
        sr.preferredZoom=17;
        if (phrase.getUnknownSearchWordLength() <= 1 && phrase.isNoSelectedType()) {
          resultMatcher.publish(sr);
        }
 else         if (phrase.getNameStringMatcher().matches(sr.localeName)) {
          resultMatcher.publish(sr);
        }
      }
      return true;
    }
    @Override public int getSearchPriority(    SearchPhrase p){
      if (!p.isNoSelectedType() || !p.isUnknownSearchWordPresent()) {
        return -1;
      }
      return SEARCH_FAVORITE_API_PRIORITY;
    }
  }
);
  searchUICore.registerAPI(new SearchWptAPI(app));
}
