{
  updateBoundaries(chain);
  int ind=0;
  while (ind < chain.size() - 1) {
    List<Node> subChain=new ArrayList<Node>();
    Node first=chain.get(ind);
    boolean directionToRight=chain.get(ind + 1).getLongitude() > first.getLongitude();
    int nextLonMaximum=ind + 1;
    double lonEnd=first.getLongitude();
    double latPeek=first.getLatitude();
    int latPeekInd=ind;
    int latLocPeekInd=ind;
    for (int j=ind + 1; j < chain.size(); j++) {
      if (directionToRight) {
        if (chain.get(j).getLatitude() <= latPeek) {
          latPeek=chain.get(j).getLatitude();
          latPeekInd=j;
        }
        if (chain.get(j).getLongitude() >= lonEnd) {
          nextLonMaximum=j;
          lonEnd=chain.get(j).getLongitude();
          latLocPeekInd=latPeekInd;
        }
 else         if (chain.get(j).getLongitude() < first.getLongitude()) {
          break;
        }
      }
 else {
        if (chain.get(j).getLatitude() >= latPeek) {
          latPeek=chain.get(j).getLatitude();
          latPeekInd=j;
        }
        if (chain.get(j).getLongitude() <= lonEnd) {
          nextLonMaximum=j;
          lonEnd=chain.get(j).getLongitude();
          latLocPeekInd=latPeekInd;
        }
 else         if (chain.get(j).getLongitude() > first.getLongitude()) {
          break;
        }
      }
    }
    if (latLocPeekInd > ind) {
      for (int i=ind; i <= latLocPeekInd; i++) {
        subChain.add(chain.get(i));
      }
      Node ned=new Node(chain.get(latLocPeekInd).getLatitude(),first.getLongitude(),nodeId++);
      subChain.add(ned);
      subChain.add(first);
      chains.add(subChain);
      subChain=new ArrayList<Node>();
    }
    for (int i=latLocPeekInd; i <= nextLonMaximum; i++) {
      subChain.add(chain.get(i));
    }
    Node ned=new Node(chain.get(latLocPeekInd).getLatitude(),lonEnd,nodeId++);
    subChain.add(ned);
    ind=nextLonMaximum;
    subChain.add(chain.get(latLocPeekInd));
    chains.add(subChain);
  }
}
