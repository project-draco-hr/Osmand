{
  final boolean[] selectionChangeLoop=new boolean[]{false};
  if (buttons[i] != null) {
    final int ind=i;
    ToggleButton b=buttons[i];
    final ApplicationMode buttonAppMode=visible.get(i);
    b.setChecked(selected.contains(buttonAppMode));
    b.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener(){
      @Override public void onCheckedChanged(      CompoundButton buttonView,      boolean isChecked){
        if (selectionChangeLoop[0]) {
          return;
        }
        selectionChangeLoop[0]=true;
        try {
          handleSelection(visible,selected,singleChoise,buttons,ind,buttonAppMode,isChecked);
          if (onClickListener != null) {
            onClickListener.onClick(null);
          }
        }
  finally {
          selectionChangeLoop[0]=false;
        }
      }
    }
);
  }
}
