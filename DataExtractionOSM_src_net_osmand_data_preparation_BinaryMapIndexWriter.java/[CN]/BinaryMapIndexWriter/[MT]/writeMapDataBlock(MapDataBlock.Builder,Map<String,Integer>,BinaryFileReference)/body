{
  checkPeekState(MAP_INDEX_INIT);
  StringTable.Builder bs=OsmandOdb.StringTable.newBuilder();
  for (  String s : stringTable.keySet()) {
    bs.addS(s);
  }
  StringTable st=bs.build();
  builder.setStringTable(st);
  int size=st.getSerializedSize();
  STRING_TABLE_SIZE+=CodedOutputStream.computeTagSize(OsmandOdb.MapDataBlock.STRINGTABLE_FIELD_NUMBER) + CodedOutputStream.computeRawVarint32Size(size) + size;
  ref.writeReference(raf,getFilePointer());
  MapDataBlock block=builder.build();
  MAP_DATA_SIZE+=block.getSerializedSize();
  codedOutStream.writeMessage(OsmAndMapIndex.BLOCKS_FIELD_NUMBER,block);
}
