{
  checkPeekState(ROUTE_INDEX_INIT);
  StringTable.Builder bs=OsmandOdb.StringTable.newBuilder();
  if (stringTable != null) {
    for (    String s : stringTable.keySet()) {
      bs.addS(s);
    }
  }
  StringTable st=bs.build();
  builder.setStringTable(st);
  int size=st.getSerializedSize();
  STRING_TABLE_SIZE+=CodedOutputStream.computeTagSize(OsmandOdb.MapDataBlock.STRINGTABLE_FIELD_NUMBER) + CodedOutputStream.computeRawVarint32Size(size) + size;
  codedOutStream.writeTag(OsmAndMapIndex.MapRootLevel.BLOCKS_FIELD_NUMBER,FieldType.MESSAGE.getWireType());
  codedOutStream.flush();
  ref.writeReference(raf,getFilePointer());
  RouteDataBlock block=builder.build();
  ROUTE_DATA_SIZE+=block.getSerializedSize();
  codedOutStream.writeMessageNoTag(block);
}
