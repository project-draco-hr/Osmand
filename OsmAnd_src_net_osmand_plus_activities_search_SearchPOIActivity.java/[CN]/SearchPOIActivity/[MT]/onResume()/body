{
  super.onResume();
  Bundle bundle=this.getIntent().getExtras();
  if (bundle.containsKey(SEARCH_LAT) && bundle.containsKey(SEARCH_LON)) {
    location=new net.osmand.Location("internal");
    location.setLatitude(bundle.getDouble(SEARCH_LAT));
    location.setLongitude(bundle.getDouble(SEARCH_LON));
    searchNearBy=false;
  }
 else {
    location=null;
    searchNearBy=true;
  }
  String filterId=bundle.getString(AMENITY_FILTER);
  PoiFilter filter=app.getPoiFilters().getFilterById(filterId);
  if (filter != this.filter) {
    this.filter=filter;
    if (filter != null) {
      filter.clearPreviousZoom();
    }
 else {
      amenityAdapter.setNewModel(Collections.<Amenity>emptyList(),"");
      searchPOILevel.setText(R.string.search_POI_level_btn);
      searchPOILevel.setEnabled(false);
    }
    clearSearchQuery();
  }
  if (filter != null) {
    filter.clearNameFilter();
  }
  updateSubtitle();
  showFilterItem.setVisible(filter != null);
  if (filter != null) {
    updateSearchPoiTextButton();
    if (searchNearBy) {
      app.getLocationProvider().addLocationListener(this);
      location=app.getLocationProvider().getLastKnownLocation();
      app.getLocationProvider().resumeAllUpdates();
    }
    updateLocation(location);
  }
  app.getLocationProvider().addCompassListener(this);
  app.getLocationProvider().registerOrUnregisterCompassListener(true);
}
