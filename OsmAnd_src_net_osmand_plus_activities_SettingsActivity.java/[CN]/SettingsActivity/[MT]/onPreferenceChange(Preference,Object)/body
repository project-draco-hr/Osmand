{
  OsmandPreference<Boolean> boolPref=booleanPreferences.get(preference.getKey());
  OsmandPreference<Object> listPref=(OsmandPreference<Object>)listPreferences.get(preference.getKey());
  OsmandPreference<String> editPref=editTextPreferences.get(preference.getKey());
  if (boolPref != null) {
    boolPref.set((Boolean)newValue);
  }
 else   if (editPref != null) {
    editPref.set((String)newValue);
  }
 else   if (listPref != null) {
    CharSequence entry=((ListPreference)preference).getEntry();
    Map<String,?> map=listPrefValues.get(preference.getKey());
    Object obj=map.get(entry);
    listPref.set(obj);
    if (listPref.getId().equals(osmandSettings.DAYNIGHT_MODE.getId())) {
      getMyApplication().getDaynightHelper().setDayNightMode(osmandSettings.DAYNIGHT_MODE.get());
    }
 else     if (listPref.getId().equals(osmandSettings.VOICE_PROVIDER.getId())) {
      getMyApplication().initCommandPlayer();
    }
 else     if (listPref.getId().equals(osmandSettings.PREFERRED_LOCALE.getId())) {
      getMyApplication().checkPrefferedLocale();
      Intent intent=getIntent();
      finish();
      startActivity(intent);
    }
  }
 else   if (preference == applicationMode) {
    boolean changed=osmandSettings.setApplicationMode(ApplicationMode.valueOf(newValue.toString()),getMyApplication());
    if (changed) {
      updateAllSettings();
    }
  }
 else   if (preference == applicationDir) {
    warnAboutChangingStorage((String)newValue);
    return false;
  }
 else   if (preference == routeServiceEnabled) {
    Intent serviceIntent=new Intent(this,NavigationService.class);
    if ((Boolean)newValue) {
      ComponentName name=startService(serviceIntent);
      if (name == null) {
        routeServiceEnabled.setChecked(getMyApplication().getNavigationService() != null);
      }
    }
 else {
      if (!stopService(serviceIntent)) {
        routeServiceEnabled.setChecked(getMyApplication().getNavigationService() != null);
      }
    }
  }
 else   if (preference == rendererPreference) {
    BaseOsmandRender loaded=RendererRegistry.getRegistry().getRenderer((String)newValue);
    if (loaded == null) {
      Toast.makeText(this,R.string.renderer_load_exception,Toast.LENGTH_SHORT).show();
    }
 else {
      RendererRegistry.getRegistry().setCurrentSelectedRender(loaded);
      osmandSettings.RENDERER.set((String)newValue);
      Toast.makeText(this,R.string.renderer_load_sucess,Toast.LENGTH_SHORT).show();
      getMyApplication().getResourceManager().getRenderer().clearCache();
    }
  }
 else   if (preference == tileSourcePreference) {
    if (VECTOR_MAP.equals((String)newValue)) {
      osmandSettings.setUsingMapVectorData(true);
    }
 else {
      osmandSettings.setUsingMapVectorData(true);
      osmandSettings.setMapTileSource((String)newValue);
    }
    String summary=tileSourcePreference.getSummary().toString();
    if (summary.lastIndexOf(':') != -1) {
      summary=summary.substring(0,summary.lastIndexOf(':') + 1);
    }
    summary+=" " + (osmandSettings.isUsingMapVectorData() ? getString(R.string.vector_data) : osmandSettings.getMapTileSourceName());
    tileSourcePreference.setSummary(summary);
  }
  return true;
}
