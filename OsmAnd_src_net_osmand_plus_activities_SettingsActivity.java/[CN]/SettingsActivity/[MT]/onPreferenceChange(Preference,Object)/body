{
  OsmandPreference<Boolean> boolPref=booleanPreferences.get(preference.getKey());
  OsmandPreference<Object> listPref=(OsmandPreference<Object>)listPreferences.get(preference.getKey());
  OsmandPreference<String> editPref=editTextPreferences.get(preference.getKey());
  if (boolPref != null) {
    boolPref.set((Boolean)newValue);
  }
 else   if (editPref != null) {
    editPref.set((String)newValue);
  }
 else   if (listPref != null) {
    int ind=((ListPreference)preference).findIndexOfValue((String)newValue);
    CharSequence entry=((ListPreference)preference).getEntries()[ind];
    Map<String,?> map=listPrefValues.get(preference.getKey());
    Object obj=map.get(entry);
    boolean changed=listPref.set(obj);
    if (changed) {
      if (listPref.getId().equals(osmandSettings.VOICE_PROVIDER.getId())) {
        getMyApplication().initCommandPlayer();
      }
 else       if (listPref.getId().equals(osmandSettings.APPLICATION_MODE.getId())) {
        updateAllSettings();
      }
 else       if (listPref.getId().equals(osmandSettings.PREFERRED_LOCALE.getId())) {
        getMyApplication().checkPrefferedLocale();
        Intent intent=getIntent();
        finish();
        startActivity(intent);
      }
    }
    if (listPref.getId().equals(osmandSettings.RENDERER.getId())) {
      if (changed) {
        Toast.makeText(this,R.string.renderer_load_sucess,Toast.LENGTH_SHORT).show();
      }
 else {
        Toast.makeText(this,R.string.renderer_load_exception,Toast.LENGTH_SHORT).show();
      }
    }
  }
 else   if (preference == applicationDir) {
    warnAboutChangingStorage((String)newValue);
    return false;
  }
 else   if (preference == routeServiceEnabled) {
    Intent serviceIntent=new Intent(this,NavigationService.class);
    if ((Boolean)newValue) {
      ComponentName name=startService(serviceIntent);
      if (name == null) {
        routeServiceEnabled.setChecked(getMyApplication().getNavigationService() != null);
      }
    }
 else {
      if (!stopService(serviceIntent)) {
        routeServiceEnabled.setChecked(getMyApplication().getNavigationService() != null);
      }
    }
  }
 else   if (preference == tileSourcePreference) {
    if (VECTOR_MAP.equals((String)newValue)) {
      osmandSettings.setUsingMapVectorData(true);
    }
 else {
      osmandSettings.setUsingMapVectorData(true);
      osmandSettings.setMapTileSource((String)newValue);
    }
    updateTileSourceSummary();
  }
  return true;
}
