{
  String title="";
  if (preference.getKey() != null && preference instanceof PreferenceScreen && SettingsActivity.SCREEN_ID_NAVIGATION_SETTINGS.equals(preference.getKey())) {
    final ApplicationMode appMode=osmandSettings.getApplicationMode();
    PreferenceScreen scr=(PreferenceScreen)preference;
    title=scr.getTitle().toString();
    if (title.startsWith("-")) {
      title=title.substring(1);
    }
    Builder builder=new AlertDialog.Builder(this);
    View view=getLayoutInflater().inflate(R.layout.navigate_mode,null);
    builder.setView(view);
    final AlertDialog dlg=builder.show();
    final View[] buttons=new View[ApplicationMode.values().length];
    buttons[ApplicationMode.CAR.ordinal()]=view.findViewById(R.id.CarButton);
    buttons[ApplicationMode.BICYCLE.ordinal()]=view.findViewById(R.id.BicycleButton);
    buttons[ApplicationMode.PEDESTRIAN.ordinal()]=view.findViewById(R.id.PedestrianButton);
    final Dialog scrDialog=scr.getDialog();
    final String tlt="   " + title;
    for (int i=0; i < buttons.length; i++) {
      if (buttons[i] != null) {
        final int ind=i;
        final View b=buttons[i];
        b.setOnClickListener(new View.OnClickListener(){
          @Override public void onClick(          View v){
            ApplicationMode selected=ApplicationMode.values()[ind];
            osmandSettings.APPLICATION_MODE.set(selected);
            updateAllSettings();
            scrDialog.setTitle(tlt + " [" + selected.toHumanString(getMyApplication())+ "]");
            dlg.dismiss();
          }
        }
);
      }
    }
    scrDialog.setTitle(tlt + " [" + appMode+ "] ");
    scr.getDialog().setOnDismissListener(new OnDismissListener(){
      @Override public void onDismiss(      DialogInterface dialog){
        osmandSettings.APPLICATION_MODE.set(appMode);
        updateAllSettings();
      }
    }
);
  }
 else   if (preference instanceof PreferenceScreen) {
    final PreferenceScreen scr=(PreferenceScreen)preference;
    title=scr.getTitle().toString();
    scr.getDialog().setTitle("   " + title);
  }
  if (preference instanceof PreferenceScreen) {
    final PreferenceScreen scr=(PreferenceScreen)preference;
    CustomTitleBarView titleBar=new CustomTitleBarView(title,R.drawable.tab_settings_screen_icon,null){
      @Override public void backPressed(){
        scr.getDialog().dismiss();
      }
    }
;
    View titleView=getLayoutInflater().inflate(titleBar.getTitleBarLayout(),null);
    titleBar.init(titleView);
    View dv=scr.getDialog().getWindow().getDecorView();
    ListView ls=(ListView)dv.findViewById(android.R.id.list);
    if (ls != null) {
      ls.addFooterView(titleView);
    }
  }
  if (preference == applicationDir) {
    return true;
  }
  return super.onPreferenceTreeClick(preferenceScreen,preference);
}
