{
  int next;
  EntityValueTokenizer tokenizer=new EntityValueTokenizer();
  tokenizer.tokenize(value);
  int currentInd=0;
  while ((next=tokenizer.next()) != END) {
    if (next == ELEMENT) {
      assertEquals(comments[currentInd],tokenizer.value(),value + " " + currentInd);
    }
 else     if (next == START_ARRAY) {
      assertEquals(comments[currentInd],"[",value + " " + currentInd);
    }
 else     if (next == END_ARRAY) {
      assertEquals(comments[currentInd],"]",value + " " + currentInd);
    }
    currentInd++;
  }
  StringBuilder builder=new StringBuilder();
  boolean first=true;
  for (  String st : comments) {
    if (st.equals("[")) {
      startArray(builder,first);
      first=true;
    }
 else     if (st.equals("]")) {
      endArray(builder);
    }
 else {
      value(builder,st,first);
      first=false;
    }
  }
  String res=builder.toString().replace("\\\\","\\");
  if (!res.equals(value) && !builder.toString().equals(value)) {
    System.err.println("Serialization of value is probably wrong : " + res + " original "+ value);
  }
}
