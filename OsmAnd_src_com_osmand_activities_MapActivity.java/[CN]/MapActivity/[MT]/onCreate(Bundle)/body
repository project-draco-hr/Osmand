{
  super.onCreate(savedInstanceState);
  requestWindowFeature(Window.FEATURE_NO_TITLE);
  setContentView(R.layout.main);
  mapView=(OsmandMapTileView)findViewById(R.id.MapView);
  MapTileDownloader.getInstance().addDownloaderCallback(mapView);
  mapView.setMapLocationListener(this);
  poiMapLayer=new POIMapLayer();
  mapView.addLayer(poiMapLayer);
  navigationLayer=new PointNavigationLayer();
  mapView.addLayer(navigationLayer);
  locationLayer=new PointLocationLayer();
  mapView.addLayer(locationLayer);
  mapInfoLayer=new MapInfoLayer(this);
  mapView.addLayer(mapInfoLayer);
  SharedPreferences lprefs=getPreferences(MODE_WORLD_READABLE);
  if (lprefs.contains(POINT_NAVIGATE_LAT)) {
    navigationLayer.setPointToNavigate(new LatLon(lprefs.getFloat(POINT_NAVIGATE_LAT,0),lprefs.getFloat(POINT_NAVIGATE_LON,0)));
  }
  SharedPreferences prefs=getSharedPreferences(OsmandSettings.SHARED_PREFERENCES_NAME,MODE_WORLD_READABLE);
  if (prefs != null && prefs.contains(OsmandSettings.LAST_KNOWN_MAP_LAT)) {
    LatLon l=OsmandSettings.getLastKnownMapLocation(this);
    mapView.setLatLon(l.getLatitude(),l.getLongitude());
    mapView.setZoom(OsmandSettings.getLastKnownMapZoom(this));
  }
 else {
    LocationManager service=(LocationManager)getSystemService(LOCATION_SERVICE);
    Location location=service.getLastKnownLocation(LocationManager.GPS_PROVIDER);
    if (location != null) {
      mapView.setLatLon(location.getLatitude(),location.getLongitude());
      mapView.setZoom(14);
    }
  }
  ZoomControls zoomControls=(ZoomControls)findViewById(R.id.ZoomControls01);
  zoomControls.setOnZoomInClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      mapView.setZoom(mapView.getZoom() + 1);
    }
  }
);
  zoomControls.setOnZoomOutClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      mapView.setZoom(mapView.getZoom() - 1);
    }
  }
);
  backToLocation=(ImageButton)findViewById(R.id.BackToLocation);
  backToLocation.setVisibility(View.INVISIBLE);
  backToLocation.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      if (!isMapLinkedToLocation()) {
        getPreferences(MODE_WORLD_READABLE).edit().putBoolean(BACK_TO_LOCATION,true).commit();
        backToLocation.setVisibility(View.INVISIBLE);
        if (locationLayer.getLastKnownLocation() != null) {
          Location lastKnownLocation=locationLayer.getLastKnownLocation();
          mapView.setLatLon(lastKnownLocation.getLatitude(),lastKnownLocation.getLongitude());
        }
      }
    }
  }
);
  backToMenu=(ImageButton)findViewById(R.id.BackToMenu);
  backToMenu.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      Intent intent=new Intent();
      setResult(RESULT_OK,intent);
      finish();
    }
  }
);
}
