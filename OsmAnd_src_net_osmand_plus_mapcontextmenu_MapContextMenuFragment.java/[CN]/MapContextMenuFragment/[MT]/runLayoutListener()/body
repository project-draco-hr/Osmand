{
  ViewTreeObserver vto=view.getViewTreeObserver();
  vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener(){
    @Override public void onGlobalLayout(){
      menuTopShadowHeight=view.findViewById(R.id.context_menu_top_shadow).getHeight();
      menuTopShadowAllHeight=view.findViewById(R.id.context_menu_top_shadow_all).getHeight();
      menuFullHeight=view.findViewById(R.id.context_menu_main).getHeight();
      menuTitleHeight=menuTopShadowHeight + menuTopShadowAllHeight;
      menuBottomViewHeight=view.findViewById(R.id.context_menu_bottom_view).getHeight();
      recalculateFullHeightMax();
      ViewTreeObserver obs=view.getViewTreeObserver();
      if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
        obs.removeOnGlobalLayoutListener(this);
      }
 else {
        obs.removeGlobalOnLayoutListener(this);
      }
      if (origMarkerX == 0 && origMarkerY == 0) {
        origMarkerX=view.getWidth() / 2;
        origMarkerY=view.getHeight() / 2;
      }
      doLayoutMenu();
    }
  }
);
}
