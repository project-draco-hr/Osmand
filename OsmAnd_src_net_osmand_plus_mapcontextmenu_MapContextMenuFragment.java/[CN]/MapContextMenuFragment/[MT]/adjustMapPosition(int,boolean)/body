{
  double markerLat=menu.getLatLon().getLatitude();
  double markerLon=menu.getLatLon().getLongitude();
  RotatedTileBox box=map.getCurrentRotatedTileBox().copy();
  LatLon latlon=mapCenter;
  if (menu.isLandscapeLayout()) {
    int markerX=(int)box.getPixXFromLatLon(markerLat,markerLon);
    int x=dpToPx(menu.getLandscapeWidthDp());
    if (markerX - markerPaddingXPx < x || markerX > origMarkerX) {
      int dx=(x + markerPaddingXPx) - markerX;
      if (markerX - dx <= origMarkerX) {
        QuadPoint cp=box.getCenterPixelPoint();
        latlon=box.getLatLonFromPixel(cp.x - dx,cp.y);
      }
 else {
        latlon=box.getCenterLatLon();
      }
    }
  }
 else {
    int markerY=(int)box.getPixYFromLatLon(markerLat,markerLon);
    if (markerY + markerPaddingPx > y || markerY < origMarkerY) {
      int dy=markerY - (y - markerPaddingPx);
      if (markerY - dy <= origMarkerY) {
        QuadPoint cp=box.getCenterPixelPoint();
        latlon=box.getLatLonFromPixel(cp.x + 0,cp.y + dy);
      }
    }
  }
  if (map.getLatitude() == latlon.getLatitude() && map.getLongitude() == latlon.getLongitude()) {
    return;
  }
  if (animated) {
    showOnMap(latlon,false,true,true);
  }
 else {
    map.setLatLon(latlon.getLatitude(),latlon.getLongitude());
  }
}
