{
  try {
    Image img=null;
    File en=new File(fileWithTiles,getFile(zoom,x,y));
    URL url=new URL("http://tile.openstreetmap.org/" + zoom + "/"+ x+ "/"+ y+ ".png");
    en.getParentFile().mkdirs();
    try {
      ImageIO.setUseCache(true);
      javax.imageio.ImageIO.setCacheDirectory(en.getParentFile());
    }
 catch (    Exception e) {
      log.warn("cannot set ImageIO cache-directory to " + en.getParent(),e);
    }
    try {
      URLConnection connection=url.openConnection();
      connection.setRequestProperty("User-Agent","osmand TilePainter/0.1");
      img=javax.imageio.ImageIO.read(connection.getInputStream());
    }
 catch (    UnknownHostException e) {
      log.info("UnknownHostException, cannot download tile " + url.toExternalForm());
    }
catch (    IIOException e) {
      if (e.getCause() != null && e.getCause() instanceof UnknownHostException) {
        log.info("UnknownHostException, cannot download tile " + url.toExternalForm(),e);
      }
 else {
        log.warn("cannot download tile " + url.toExternalForm(),e);
      }
    }
    cache.put(getFile(zoom,x,y),img);
    if (img != null) {
      try {
        ImageIO.write((RenderedImage)img,"png",en);
      }
 catch (      IOException e) {
        log.warn("cannot save img to " + en.getAbsolutePath(),e);
      }
    }
  }
 catch (  IOException e) {
    log.warn("cannot download pre-rendered tile [" + e.getClass().getSimpleName() + "]",e);
  }
}
