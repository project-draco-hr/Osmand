{
  ((OsmandApplication)getApplication()).applyTheme(this);
  super.onCreate(savedInstanceState);
  long t=System.currentTimeMillis();
  getSherlock().setUiOptions(ActivityInfo.UIOPTION_SPLIT_ACTION_BAR_WHEN_NARROW);
  getSupportActionBar().setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);
  setContentView(R.layout.search_main);
  settings=((OsmandApplication)getApplication()).getSettings();
  getSupportActionBar().setDisplayHomeAsUpEnabled(true);
  getSupportActionBar().setTitle("");
  final TextView tabinfo=(TextView)findViewById(R.id.textViewADesc);
  TabWidget tabs=(TabWidget)findViewById(android.R.id.tabs);
  tabs.setBackgroundResource(R.drawable.tab_icon_background);
  TabHost tabHost=(TabHost)findViewById(android.R.id.tabhost);
  tabHost.setup();
  ViewPager mViewPager=(ViewPager)findViewById(R.id.pager);
  mTabsAdapter=new TabsAdapter(this,tabHost,tabinfo,mViewPager);
  TabSpec poiTab=tabHost.newTabSpec(SEARCH_POI).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_poi_icon,R.string.poi));
  mTabsAdapter.addTab(poiTab,SearchPoiFilterActivity.class,null);
  TabSpec addressSpec=tabHost.newTabSpec(SEARCH_ADDRESS).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_address_icon,R.string.address));
  mTabsAdapter.addTab(addressSpec,searchOnLine ? SearchAddressOnlineFragment.class : SearchAddressFragment.class,null);
  TabSpec locationTab=tabHost.newTabSpec(SEARCH_LOCATION).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_location_icon,R.string.search_tabs_location));
  mTabsAdapter.addTab(locationTab,NavigatePointFragment.class,null);
  TabSpec favoriteTab=tabHost.newTabSpec(SEARCH_FAVORITES).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_favorites_icon,R.string.favorite));
  mTabsAdapter.addTab(favoriteTab,FavouritesListFragment.class,null);
  TabSpec historyTab=tabHost.newTabSpec(SEARCH_HISTORY).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_history_icon,R.string.history));
  mTabsAdapter.addTab(historyTab,SearchHistoryFragment.class,null);
  TabSpec transportTab=tabHost.newTabSpec(SEARCH_TRANSPORT).setIndicator(getTabIndicator(tabHost,R.drawable.tab_search_transport_icon,R.string.transport));
  mTabsAdapter.addTab(transportTab,SearchTransportFragment.class,null);
  tabHost.setCurrentTab(POI_TAB_INDEX);
  if (savedInstanceState != null) {
    tabHost.setCurrentTabByTag(savedInstanceState.getString("tab"));
  }
  setTopSpinner();
  Log.i("net.osmand","Start on create " + (System.currentTimeMillis() - t));
  Intent intent=getIntent();
  int tabIndex=0;
  if (intent != null) {
    if (intent.hasExtra(TAB_INDEX_EXTRA)) {
      tabIndex=intent.getIntExtra(TAB_INDEX_EXTRA,POI_TAB_INDEX);
      mTabsAdapter.mTabHost.setCurrentTab(tabIndex);
    }
    double lat=intent.getDoubleExtra(SEARCH_LAT,0);
    double lon=intent.getDoubleExtra(SEARCH_LON,0);
    if (lat != 0 || lon != 0) {
      LatLon l=new LatLon(lat,lon);
      if (!Algorithms.objectEquals(reqSearchPoint,l)) {
        reqSearchPoint=l;
        updateSearchPoint(reqSearchPoint,getString(R.string.search_position_fixed),true);
      }
    }
  }
  if (searchPoint == null) {
    LatLon last=settings.getLastKnownMapLocation();
    if (!Algorithms.objectEquals(reqSearchPoint,last)) {
      reqSearchPoint=last;
      updateSearchPoint(last,getString(R.string.select_search_position),true);
    }
  }
}
