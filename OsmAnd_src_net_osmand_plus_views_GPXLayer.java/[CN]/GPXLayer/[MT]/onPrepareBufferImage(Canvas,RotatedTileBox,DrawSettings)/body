{
  List<SelectedGpxFile> selectedGPXFiles=selectedGpxHelper.getSelectedGPXFiles();
  int clr=getColor(settings);
  cache.clear();
  int pointColor=view.getResources().getColor(R.color.gpx_track);
  if (!selectedGPXFiles.isEmpty()) {
    for (    SelectedGpxFile g : selectedGPXFiles) {
      List<List<WptPt>> points=g.getPointsToDisplay();
      int fcolor=g.getColor() == 0 ? clr : g.getColor();
      paint.setColor(fcolor);
      drawSegments(canvas,tileBox,points);
    }
    canvas.rotate(-tileBox.getRotate(),tileBox.getCenterPixelX(),tileBox.getCenterPixelY());
    if (tileBox.getZoom() >= startZoom) {
      final QuadRect latLonBounds=tileBox.getLatLonBounds();
      for (      SelectedGpxFile g : selectedGPXFiles) {
        List<WptPt> pts=g.getGpxFile().points;
        int fcolor=g.getColor() == 0 ? pointColor : g.getColor();
        FavoriteImageDrawable fid=FavoriteImageDrawable.getOrCreate(view.getContext(),fcolor);
        for (        WptPt o : pts) {
          if (o.lat >= latLonBounds.bottom && o.lat <= latLonBounds.top && o.lon >= latLonBounds.left && o.lon <= latLonBounds.right) {
            cache.add(o);
            int x=(int)tileBox.getPixXFromLatLon(o.lat,o.lon);
            int y=(int)tileBox.getPixYFromLatLon(o.lat,o.lon);
            fid.drawBitmapInCenter(canvas,x,y,tileBox.getDensity());
          }
        }
      }
    }
  }
  if (textLayer.isVisible()) {
    textLayer.putData(this,cache);
  }
}
