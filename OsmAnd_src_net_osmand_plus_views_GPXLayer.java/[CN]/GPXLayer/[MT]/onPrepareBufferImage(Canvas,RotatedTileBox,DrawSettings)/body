{
  List<SelectedGpxFile> selectedGPXFiles=selectedGpxHelper.getSelectedGPXFiles();
  int clr=getColor(settings);
  cache.clear();
  int defPointColor=view.getResources().getColor(R.color.gpx_color_point);
  int visitedColor=view.getContext().getResources().getColor(R.color.color_ok);
  if (!selectedGPXFiles.isEmpty()) {
    for (    SelectedGpxFile g : selectedGPXFiles) {
      List<List<WptPt>> points=g.getPointsToDisplay();
      boolean routePoints=g.isRoutePoints();
      int fcolor=g.getColor() == 0 ? clr : g.getColor();
      paint.setColor(fcolor);
      paint.setPathEffect(routePoints ? pathEffect : null);
      drawSegments(canvas,tileBox,points);
    }
    canvas.rotate(-tileBox.getRotate(),tileBox.getCenterPixelX(),tileBox.getCenterPixelY());
    if (tileBox.getZoom() >= startZoom) {
      final QuadRect latLonBounds=tileBox.getLatLonBounds();
      for (      SelectedGpxFile g : selectedGPXFiles) {
        List<WptPt> pts=getListStarPoints(g);
        int fcolor=g.getColor() == 0 ? defPointColor : g.getColor();
        for (        WptPt o : pts) {
          boolean visit=isPointVisited(o);
          int pointColor=visit ? visitedColor : o.getColor(fcolor);
          FavoriteImageDrawable fid=FavoriteImageDrawable.getOrCreate(view.getContext(),pointColor);
          if (o.lat >= latLonBounds.bottom && o.lat <= latLonBounds.top && o.lon >= latLonBounds.left && o.lon <= latLonBounds.right) {
            cache.add(o);
            int x=(int)tileBox.getPixXFromLatLon(o.lat,o.lon);
            int y=(int)tileBox.getPixYFromLatLon(o.lat,o.lon);
            fid.drawBitmapInCenter(canvas,x,y,tileBox.getDensity());
          }
        }
      }
    }
  }
  if (textLayer.isVisible()) {
    textLayer.putData(this,cache);
  }
}
