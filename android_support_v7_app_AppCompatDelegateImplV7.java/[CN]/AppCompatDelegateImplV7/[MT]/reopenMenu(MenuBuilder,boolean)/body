{
  if (mDecorContentParent != null && mDecorContentParent.canShowOverflowMenu() && (!ViewConfigurationCompat.hasPermanentMenuKey(ViewConfiguration.get(mContext)) || mDecorContentParent.isOverflowMenuShowPending())) {
    final Window.Callback cb=getWindowCallback();
    if (!mDecorContentParent.isOverflowMenuShowing() || !toggleMenuMode) {
      if (cb != null && !isDestroyed()) {
        if (mInvalidatePanelMenuPosted && (mInvalidatePanelMenuFeatures & (1 << FEATURE_OPTIONS_PANEL)) != 0) {
          mWindowDecor.removeCallbacks(mInvalidatePanelMenuRunnable);
          mInvalidatePanelMenuRunnable.run();
        }
        final PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
        if (st.menu != null && !st.refreshMenuContent && cb.onPreparePanel(FEATURE_OPTIONS_PANEL,st.createdPanelView,st.menu)) {
          cb.onMenuOpened(FEATURE_ACTION_BAR,st.menu);
          mDecorContentParent.showOverflowMenu();
        }
      }
    }
 else {
      mDecorContentParent.hideOverflowMenu();
      if (!isDestroyed()) {
        final PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
        cb.onPanelClosed(FEATURE_ACTION_BAR,st.menu);
      }
    }
    return;
  }
  PanelFeatureState st=getPanelState(FEATURE_OPTIONS_PANEL,true);
  st.refreshDecorView=true;
  closePanel(st,false);
  openPanel(st,null);
}
