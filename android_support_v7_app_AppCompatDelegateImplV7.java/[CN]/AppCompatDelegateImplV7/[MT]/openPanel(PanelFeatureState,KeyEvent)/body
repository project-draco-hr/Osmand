{
  if (st.isOpen || isDestroyed()) {
    return;
  }
  if (st.featureId == FEATURE_OPTIONS_PANEL) {
    Context context=mContext;
    Configuration config=context.getResources().getConfiguration();
    boolean isXLarge=(config.screenLayout & Configuration.SCREENLAYOUT_SIZE_MASK) == Configuration.SCREENLAYOUT_SIZE_XLARGE;
    boolean isHoneycombApp=context.getApplicationInfo().targetSdkVersion >= android.os.Build.VERSION_CODES.HONEYCOMB;
    if (isXLarge && isHoneycombApp) {
      return;
    }
  }
  Window.Callback cb=getWindowCallback();
  if ((cb != null) && (!cb.onMenuOpened(st.featureId,st.menu))) {
    closePanel(st,true);
    return;
  }
  final WindowManager wm=(WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
  if (wm == null) {
    return;
  }
  if (!preparePanel(st,event)) {
    return;
  }
  int width=WRAP_CONTENT;
  if (st.decorView == null || st.refreshDecorView) {
    if (st.decorView == null) {
      if (!initializePanelDecor(st) || (st.decorView == null))       return;
    }
 else     if (st.refreshDecorView && (st.decorView.getChildCount() > 0)) {
      st.decorView.removeAllViews();
    }
    if (!initializePanelContent(st) || !st.hasPanelItems()) {
      return;
    }
    ViewGroup.LayoutParams lp=st.shownPanelView.getLayoutParams();
    if (lp == null) {
      lp=new ViewGroup.LayoutParams(WRAP_CONTENT,WRAP_CONTENT);
    }
    int backgroundResId=st.background;
    st.decorView.setBackgroundResource(backgroundResId);
    ViewParent shownPanelParent=st.shownPanelView.getParent();
    if (shownPanelParent != null && shownPanelParent instanceof ViewGroup) {
      ((ViewGroup)shownPanelParent).removeView(st.shownPanelView);
    }
    st.decorView.addView(st.shownPanelView,lp);
    if (!st.shownPanelView.hasFocus()) {
      st.shownPanelView.requestFocus();
    }
  }
 else   if (st.createdPanelView != null) {
    ViewGroup.LayoutParams lp=st.createdPanelView.getLayoutParams();
    if (lp != null && lp.width == ViewGroup.LayoutParams.MATCH_PARENT) {
      width=MATCH_PARENT;
    }
  }
  st.isHandled=false;
  WindowManager.LayoutParams lp=new WindowManager.LayoutParams(width,WRAP_CONTENT,st.x,st.y,WindowManager.LayoutParams.TYPE_APPLICATION_SUB_PANEL,WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM | WindowManager.LayoutParams.FLAG_SPLIT_TOUCH,PixelFormat.TRANSLUCENT);
  lp.gravity=st.gravity;
  lp.windowAnimations=st.windowAnimations;
  wm.addView(st.decorView,lp);
  st.isOpen=true;
}
