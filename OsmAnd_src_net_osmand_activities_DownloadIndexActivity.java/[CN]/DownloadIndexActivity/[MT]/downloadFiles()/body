{
  Builder builder=new AlertDialog.Builder(this);
  double sz=0;
  for (  DownloadEntry es : entriesToDownload.values()) {
    sz+=es.sizeMB;
  }
  builder.setMessage(MessageFormat.format(getString(R.string.download_files_question),entriesToDownload.size(),sz));
  builder.setPositiveButton(R.string.default_buttons_yes,new DialogInterface.OnClickListener(){
    @Override public void onClick(    DialogInterface dialog,    int which){
      progressFileDlg=ProgressDialog.show(DownloadIndexActivity.this,getString(R.string.downloading),getString(R.string.downloading_file),true,true);
      interruptDownloading=false;
      progressFileDlg.show();
      final ProgressDialogImplementation impl=new ProgressDialogImplementation(progressFileDlg,true);
      progressFileDlg.setOnCancelListener(new DialogInterface.OnCancelListener(){
        @Override public void onCancel(        DialogInterface dialog){
          interruptDownloading=true;
        }
      }
);
      impl.setRunnable("DownloadIndex",new Runnable(){
        @Override public void run(){
          try {
            for (            String s : new ArrayList<String>(entriesToDownload.keySet())) {
              DownloadEntry entry=entriesToDownload.get(s);
              if (entry != null) {
                if (downloadFile(s,entry.fileToSave,entry.fileToUnzip,entry.unzip,impl,entry.dateModified,entry.parts)) {
                  entriesToDownload.remove(s);
                  runOnUiThread(new Runnable(){
                    @Override public void run(){
                      ((DownloadIndexAdapter)getListAdapter()).notifyDataSetChanged();
                      findViewById(R.id.DownloadButton).setVisibility(entriesToDownload.isEmpty() ? View.GONE : View.VISIBLE);
                    }
                  }
);
                }
              }
            }
          }
 catch (          InterruptedException e) {
            progressFileDlg=null;
          }
 finally {
            if (progressFileDlg != null) {
              progressFileDlg.dismiss();
              progressFileDlg=null;
            }
          }
        }
      }
);
      impl.run();
    }
  }
);
  builder.setNegativeButton(R.string.default_buttons_no,null);
  builder.show();
}
